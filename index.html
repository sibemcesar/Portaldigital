<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Portal Digital</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <script>
    function isWebView() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      if (/wv/.test(ua)) return true;
      if (/iPhone|iPod|iPad/.test(ua) && !/Safari/.test(ua)) return true;
      return false;
    }

    if (!isWebView()) {
      window.location.href = "https://portaldigital.vercel.app/web.html";
    } else {
      console.log("Rodando dentro do WebView");
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInAnonymously, onAuthStateChanged, signOut, sendPasswordResetEmail, updateProfile, sendEmailVerification } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getDatabase, ref, set, get, update, remove, onValue, push } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    import { getFirestore, collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, addDoc, query, where, orderBy, limit, onSnapshot, increment } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBgEfuLNpU5j9EIcvQ9Qs_reEvtXGPIbO0",
      authDomain: "gameplus-59458.firebaseapp.com",
      databaseURL: "https://gameplus-59458-default-rtdb.firebaseio.com",
      projectId: "gameplus-59458",
      storageBucket: "gameplus-59458.firebasestorage.app",
      messagingSenderId: "450449493424",
      appId: "1:450449493424:web:c8ffa9fee810330761da75",
      measurementId: "G-8J63PTNPZ5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const firestore = getFirestore(app);

    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDatabase = database;  // Realtime Database - for real-time updates
    window.firebaseFirestore = firestore; // Firestore - for cached/static data
    window.firebaseModules = {
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendEmailVerification,
      signInAnonymously,
      onAuthStateChanged,
      signOut,
      sendPasswordResetEmail,
      updateProfile,
      ref,
      set,
      get,
      update,
      remove,
      onValue,
      push,
      collection,
      doc,
      getDoc,
      getDocs,
      setDoc,
      updateDoc,
      deleteDoc,
      addDoc,
      query,
      where,
      orderBy,
      limit,
      onSnapshot,
      increment
    };
  </script>

  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --bg-card: #ffffff;
      --text-primary: #000000;
      --text-secondary: #4a4a4a;
      --text-muted: #888888;
      --border-color: #e0e0e0;
      --accent-primary: #333333;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .dark {
      --bg-primary: #0f0f0f;
      --bg-secondary: #1a1a1a;
      --bg-card: #232323;
      --text-primary: #ffffff;
      --text-secondary: #c4c4c4;
      --text-muted: #888888;
      --border-color: rgba(255, 255, 255, 0.15);
      --accent-primary: #f5f5f5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      height: 100vh;
      line-height: 1.6;
      opacity: 0;
      animation: fadeInBody 0.6s ease forwards;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    @keyframes fadeInBody {
      to { opacity: 1; }
    }

    .header {
      background: var(--bg-secondary);
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 12px 16px;
      gap: 12px;
      flex-shrink: 0;
      border-bottom: 1px solid var(--border-color);
    }

    .app-name {
      font-size: 14px;
      font-weight: bold;
      color: var(--text-primary);
    }

    .menu-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-primary);
    }
    .menu-btn svg {
      width: 24px;
      height: 24px;
      fill: var(--text-primary);
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 260px;
      height: 100%;
      background: var(--bg-secondary);
      box-shadow: 2px 0 8px rgba(0,0,0,0.3);
      transition: left 0.3s ease;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 100;
      overflow-y: auto;
      border-right: 1px solid var(--border-color);
    }
    .sidebar.open { left: 0; }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 4px;
    }

    .sidebar-header h2 {
      margin: 0;
      font-size: 18px;
      color: var(--text-primary);
      flex: 1;
    }

    .sidebar-header .theme-toggle-btn {
      width: 36px;
      height: 36px;
    }

    .sidebar-header .theme-toggle-btn svg {
      width: 18px;
      height: 18px;
    }

    .btn {
      display: flex;
      align-items: center;
      gap: 12px;
      background: transparent;
      border: none;
      border-radius: 10px;
      padding: 12px 14px;
      min-height: 44px;
      color: var(--text-primary);
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover {
      background: var(--bg-card);
      box-shadow: var(--shadow-sm);
    }
    .btn svg {
      width: 22px;
      height: 22px;
      fill: var(--text-primary);
      flex-shrink: 0;
    }
    .btn:active { transform: scale(0.96); }

    .search-container {
      max-width: 600px;
      margin: 0 auto;
      position: relative;
      display: none;
      gap: 10px;
      align-items: center;
      padding: 16px 20px 12px;
      flex-shrink: 0;
    }

    .theme-toggle-btn {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: none;
      background: var(--bg-card);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
      flex-shrink: 0;
    }

    .theme-toggle-btn:hover {
      background: var(--bg-hover);
      transform: scale(1.05);
    }

    .theme-toggle-btn:active {
      transform: scale(0.95);
    }

    .theme-toggle-btn svg {
      width: 22px;
      height: 22px;
      fill: var(--text-primary);
      transition: transform 0.3s ease;
    }

    .theme-toggle-btn:hover svg {
      transform: rotate(15deg);
    }

    .theme-toggle-btn .sun-icon {
      display: block;
    }

    .theme-toggle-btn .moon-icon {
      display: none;
    }

    .dark .theme-toggle-btn .sun-icon {
      display: none;
    }

    .dark .theme-toggle-btn .moon-icon {
      display: block;
    }

    .search-wrapper {
      flex: 1;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 44px 12px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent-primary);
      font-size: 18px;
      pointer-events: none;
    }

    .filter-tabs {
      display: none;
      gap: 8px;
      padding: 8px 20px 16px;
      justify-content: center;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .filter-btn {
      padding: 8px 20px;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 20px;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-btn:hover {
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 16px;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
        padding: 12px;
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid var(--border-color);
      opacity: 0;
      animation: cardFadeIn 0.4s ease forwards;
    }

    @keyframes cardFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card:hover {
      transform: translateY(-4px);
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-md);
    }

    .card-img-container {
      position: relative;
      overflow: hidden;
      padding-top: 150%;
      background: var(--bg-secondary);
    }

    .card img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .card:hover img {
      transform: scale(1.05);
    }

    .card-type {
      position: absolute;
      top: 6px;
      right: 6px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      z-index: 2;
      backdrop-filter: blur(8px);
      background: var(--accent-primary);
      color: var(--bg-primary);
    }

    .card-info {
      padding: 10px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      line-height: 1.3;
      color: var(--text-primary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-meta {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-primary);
      display: none;
      z-index: 1000;
      overflow-y: auto;
    }

    .overlay.active {
      display: block;
    }

    .modal {
      background: var(--bg-secondary);
      min-height: 100vh;
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .content-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
      z-index: 100;
    }

    .modal > .content-header {
      position: sticky;
      top: 0;
    }

    .content-header-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .content-header-btn svg {
      fill: var(--text-primary);
    }

    .content-header-btn:hover {
      background: var(--bg-hover);
    }

    .content-header-btn:active {
      background: var(--bg-secondary);
    }

    .content-header-title {
      flex: 1;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 12px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .share-btn svg {
      fill: #2196F3;
    }

    .report-btn svg {
      fill: #9E9E9E;
    }

    .help-btn svg {
      fill: #2196F3;
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
      line-height: 1.2;
    }

    .modal-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .modal-meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .modal-meta-label {
      color: var(--text-secondary);
      font-weight: 600;
    }

    .modal-body {
      padding: 24px;
    }

    .video-container {
      position: relative;
      background: #000;
      overflow: hidden;
      aspect-ratio: 16 / 9;
      margin-bottom: 24px;
      border-radius: 8px;
    }

    .video-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .info-comments-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .toggle-btn {
      flex: 1;
      padding: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .toggle-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .modal-description {
      font-size: 15px;
      line-height: 1.7;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    .game-info {
      display: none;
    }

    .game-info.active {
      display: block;
    }

    .auth-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 3000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .auth-overlay.active {
      display: flex;
    }

    .auth-loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 4000;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 24px;
    }

    .auth-loading-overlay.active {
      display: flex;
      animation: fadeIn 0.2s ease;
    }

    .auth-loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: authSpin 0.8s linear infinite;
    }

    @keyframes authSpin {
      to { transform: rotate(360deg); }
    }

    .auth-loading-text {
      font-size: 18px;
      font-weight: 500;
      color: var(--text-primary);
      text-align: center;
    }

    .auth-loading-subtext {
      font-size: 14px;
      color: var(--text-muted);
      text-align: center;
      margin-top: -12px;
    }

    .auth-loading-icon {
      width: 80px;
      height: 80px;
      background: var(--accent-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      animation: authPulse 1.5s ease-in-out infinite;
    }

    .auth-loading-icon svg {
      width: 44px;
      height: 44px;
      fill: var(--bg-primary);
    }

    @keyframes authPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }

    .auth-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 500px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .auth-main {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
    }

    .auth-welcome {
      text-align: center;
      padding: 40px 20px;
    }

    .auth-welcome-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .auth-welcome-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .auth-welcome-icon svg {
      width: 44px;
      height: 44px;
      fill: var(--bg-primary);
    }

    .auth-welcome h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .auth-welcome p {
      font-size: 16px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .auth-options {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 20px 0;
    }

    .auth-option-btn {
      display: flex;
      align-items: center;
      gap: 16px;
      width: 100%;
      padding: 18px 20px;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 16px;
      color: var(--text-primary);
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      font-family: 'Inter', sans-serif;
    }

    .auth-option-btn:hover {
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .auth-option-btn:active {
      transform: scale(0.98);
    }

    .auth-option-btn svg {
      width: 28px;
      height: 28px;
      fill: var(--accent-primary);
      flex-shrink: 0;
    }

    .auth-option-btn.primary {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .auth-option-btn.primary svg {
      fill: var(--bg-primary);
    }

    .auth-option-btn.primary:hover {
      opacity: 0.9;
    }

    .auth-option-text {
      display: flex;
      flex-direction: column;
    }

    .auth-option-text small {
      font-size: 13px;
      font-weight: 400;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .auth-option-btn.primary .auth-option-text small {
      color: rgba(255, 255, 255, 0.7);
    }

    .dark .auth-option-btn.primary .auth-option-text small {
      color: rgba(0, 0, 0, 0.6);
    }

    .auth-form-container {
      display: none;
      flex-direction: column;
      flex: 1;
    }

    .auth-form-container.active {
      display: flex;
    }

    .auth-form-header {
      text-align: center;
      padding-bottom: 24px;
    }

    .auth-form-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .auth-form-header p {
      font-size: 15px;
      color: var(--text-muted);
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .auth-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .auth-input-group label {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .auth-input-group input {
      width: 100%;
      padding: 16px 18px;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 17px;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .auth-input-group input:focus {
      outline: none;
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .auth-input-group input::placeholder {
      color: var(--text-muted);
    }

    .auth-input-group small {
      font-size: 13px;
      color: var(--text-muted);
    }

    .auth-submit-btn {
      width: 100%;
      padding: 18px;
      background: var(--accent-primary);
      border: none;
      border-radius: 12px;
      color: var(--bg-primary);
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 8px;
      font-family: 'Inter', sans-serif;
    }

    .auth-submit-btn:hover {
      opacity: 0.9;
    }

    .auth-submit-btn:active {
      transform: scale(0.98);
    }

    .auth-form-footer {
      text-align: center;
      padding-top: 20px;
      margin-top: auto;
    }

    .auth-form-footer a {
      color: var(--accent-primary);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
    }

    .auth-form-footer a:hover {
      text-decoration: underline;
    }

    .auth-back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      margin-top: 24px;
      padding: 12px;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .auth-back-link:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .auth-back-link svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .comments-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .comments-overlay.active {
      display: flex;
    }

    .downloads-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .downloads-overlay.active {
      display: flex;
    }

    .downloads-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .reports-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .reports-overlay.active {
      display: flex;
    }

    .reports-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .reports-filter-container {
      display: flex;
      gap: 10px;
      padding: 16px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .reports-filter-btn {
      padding: 10px 20px;
      background: transparent;
      border: 1.5px solid var(--border-color);
      border-radius: 24px;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .reports-filter-btn:hover {
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .reports-filter-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .reports-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      -webkit-overflow-scrolling: touch;
    }

    .report-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .report-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .report-card-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }

    .report-card-date {
      font-size: 13px;
      color: var(--text-muted);
    }

    .report-card-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .report-card-email {
      font-size: 13px;
      color: var(--text-muted);
      word-break: break-all;
    }

    .report-status-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .report-status-badge.pending {
      background: rgba(255, 152, 0, 0.15);
      color: #FF9800;
    }

    .report-status-badge.resolved {
      background: rgba(33, 150, 243, 0.15);
      color: #2196F3;
    }

    .report-card-section {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .report-card-label {
      font-size: 13px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .report-card-link {
      color: #2196F3;
      font-size: 15px;
      word-break: break-all;
      text-decoration: none;
    }

    .report-card-link:hover {
      text-decoration: underline;
    }

    .report-card-description {
      color: var(--text-secondary);
      font-size: 15px;
      line-height: 1.6;
      margin: 0;
      white-space: pre-wrap;
    }

    .report-resolve-btn {
      background: #2196F3;
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .report-resolve-btn:hover {
      background: #1976D2;
      transform: translateY(-1px);
    }

    .report-resolve-btn:active {
      transform: translateY(0);
    }

    .report-resolved-info {
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
      padding: 8px 0;
    }

    .report-card-actions {
      display: flex;
      gap: 12px;
      margin-top: 4px;
    }

    .report-card-actions .report-resolve-btn,
    .report-card-actions .report-delete-btn {
      flex: 1;
    }

    .report-delete-btn {
      background: transparent;
      color: #f44336;
      border: 1.5px solid #f44336;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .report-delete-btn:hover {
      background: rgba(244, 67, 54, 0.1);
    }

    .report-delete-btn:active {
      transform: scale(0.98);
    }

    .report-delete-btn.full-width {
      width: 100%;
    }

    .reports-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
      color: var(--text-muted);
      gap: 12px;
    }

    .reports-empty svg {
      width: 64px;
      height: 64px;
      fill: var(--text-muted);
      opacity: 0.5;
    }

    .reports-empty-text {
      font-size: 16px;
    }

    .publish-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .publish-overlay.active {
      display: flex;
    }

    .publish-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 0;
    }

    .publish-overlay-content form {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    .publish-form-container {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .publish-form-container .form-group {
      margin-bottom: 0;
    }

    .publish-form-container .form-label {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .publish-form-container .form-input,
    .publish-form-container .form-textarea,
    .publish-form-container .form-select {
      font-size: 16px;
      padding: 14px 16px;
      border-radius: 12px;
    }

    .publish-form-container .form-textarea {
      min-height: 120px;
    }

    .publish-form-container .download-link-group {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .publish-form-container .download-link-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .publish-form-container .download-link-number {
      font-weight: 600;
      font-size: 15px;
      color: var(--accent-primary);
    }

    .publish-form-container .remove-link-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid #ff6b6b;
      background: transparent;
      color: #ff6b6b;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .publish-form-container .remove-link-btn:hover {
      background: rgba(255, 107, 107, 0.15);
    }

    .publish-form-container .add-link-btn {
      width: 100%;
      padding: 14px;
      background: var(--bg-card);
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      color: var(--accent-primary);
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    .publish-form-container .add-link-btn:hover {
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .publish-footer {
      display: flex;
      gap: 12px;
      padding: 16px 20px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .publish-footer .publish-btn {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .publish-footer .publish-btn.primary {
      background: var(--accent-primary);
      color: var(--bg-primary);
    }

    .publish-footer .publish-btn.secondary {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }

    .manage-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .manage-overlay.active {
      display: flex;
    }

    .manage-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .manage-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .manage-game-card {
      background: var(--bg-card);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .manage-game-card h3 {
      margin: 0 0 8px 0;
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .manage-game-card p {
      color: var(--text-muted);
      font-size: 14px;
      margin-bottom: 14px;
      line-height: 1.4;
    }

    .manage-game-actions {
      display: flex;
      gap: 10px;
    }

    .manage-game-actions .action-btn {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: 10px;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .manage-game-actions .action-btn.edit {
      background: var(--accent-primary);
      color: var(--bg-primary);
    }

    .manage-game-actions .action-btn.delete {
      background: transparent;
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
    }

    .manage-empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: 40px;
      text-align: center;
    }

    .manage-empty-state .icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .manage-empty-state p {
      color: var(--text-muted);
      font-size: 16px;
      line-height: 1.5;
    }

    .downloads-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .downloads-info-box {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 8px;
    }

    .downloads-info-box p {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }

    .downloads-info-box .cost-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent-primary);
      color: var(--bg-primary);
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 13px;
      margin-top: 12px;
    }

    .redeem-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .redeem-overlay.active {
      display: flex;
    }

    .redeem-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .redeem-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .redeem-header-box {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(100, 181, 246, 0.1) 100%);
      border: 1px solid rgba(33, 150, 243, 0.3);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
    }

    .redeem-header-box .icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .redeem-header-box h3 {
      font-size: 20px;
      color: var(--text-primary);
      margin: 0 0 8px 0;
      font-weight: 700;
    }

    .redeem-header-box p {
      font-size: 15px;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
    }

    .redeem-input-section {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
    }

    .redeem-input-section label {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .redeem-input-section input {
      width: 100%;
      padding: 16px 20px;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 18px;
      font-family: 'Inter', sans-serif;
      text-align: center;
      letter-spacing: 2px;
      text-transform: uppercase;
      transition: all 0.2s ease;
    }

    .redeem-input-section input:focus {
      outline: none;
      border-color: #2196F3;
      background: var(--bg-primary);
    }

    .redeem-input-section input::placeholder {
      color: var(--text-muted);
      text-transform: none;
      letter-spacing: normal;
    }

    .redeem-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #2196F3 0%, #64B5F6 100%);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 17px;
      font-weight: 700;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .redeem-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
    }

    .redeem-btn:active {
      transform: scale(0.98);
    }

    .redeem-btn svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    .buy-points-box {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.12) 0%, rgba(156, 39, 176, 0.1) 100%);
      border: 1px solid rgba(33, 150, 243, 0.3);
      border-radius: 16px;
      padding: 24px;
    }

    .buy-points-box .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .buy-points-box .header .icon {
      font-size: 32px;
    }

    .buy-points-box .header h4 {
      font-size: 18px;
      color: var(--text-primary);
      margin: 0;
      font-weight: 700;
    }

    .buy-points-box p {
      font-size: 15px;
      color: var(--text-secondary);
      margin: 0 0 20px 0;
      line-height: 1.6;
    }

    .contact-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.2s ease;
    }

    .contact-item:last-child {
      margin-bottom: 0;
    }

    .contact-item:hover {
      border-color: var(--accent-primary);
      transform: translateX(4px);
    }

    .contact-item .icon {
      font-size: 28px;
      flex-shrink: 0;
    }

    .contact-item .info {
      flex: 1;
    }

    .contact-item .info .label {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .contact-item .info .number {
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: 0.5px;
    }

    .contact-item a {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      background: var(--accent-primary);
      color: var(--bg-primary);
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .contact-item a:hover {
      opacity: 0.9;
    }
    
    .generate-code-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .generate-code-overlay.active {
      display: flex;
    }

    .generate-code-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .generate-code-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .generate-code-header-box {
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(129, 199, 132, 0.1) 100%);
      border: 1px solid rgba(76, 175, 80, 0.3);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
    }

    .generate-code-header-box .icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .generate-code-header-box h3 {
      font-size: 20px;
      color: var(--text-primary);
      margin: 0 0 8px 0;
      font-weight: 700;
    }

    .generate-code-header-box p {
      font-size: 15px;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
    }

    .generate-code-input-section {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
    }

    .generate-code-input-section label {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .generate-code-input-section input {
      width: 100%;
      padding: 16px 20px;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 18px;
      font-family: 'Inter', sans-serif;
      text-align: center;
      transition: all 0.2s ease;
    }

    .generate-code-input-section input:focus {
      outline: none;
      border-color: #2196F3;
      background: var(--bg-primary);
    }

    .generate-code-input-section input::placeholder {
      color: var(--text-muted);
    }

    .generate-code-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #2196F3 0%, #64B5F6 100%);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 17px;
      font-weight: 700;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .generate-code-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .generate-code-btn:active {
      transform: scale(0.98);
    }

    .generate-code-btn svg {
      width: 22px;
      height: 22px;
      fill: white;
    }

    .generated-code-result {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      display: none;
    }

    .generated-code-result.active {
      display: block;
    }

    .generated-code-result h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 16px 0;
    }

    .generated-code-display {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      border: 2px dashed rgba(33, 150, 243, 0.5);
      color: #2196F3;
      letter-spacing: 3px;
      word-break: break-all;
    }

    .generated-code-hint {
      margin-top: 16px;
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .generated-code-copy-btn {
      margin-top: 16px;
      padding: 14px 24px;
      background: transparent;
      border: 2px solid #2196F3;
      border-radius: 10px;
      color: #2196F3;
      font-size: 15px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .generated-code-copy-btn:hover {
      background: rgba(33, 150, 243, 0.1);
    }

    .generated-code-copy-btn svg {
      width: 18px;
      height: 18px;
      fill: #2196F3;
    }

    .comments-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .comments-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .comment-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 16px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .comment-btn-row {
      display: flex;
      justify-content: flex-end;
    }

    .comment-input {
      width: 100%;
      padding: 12px 18px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      resize: none;
      min-height: 48px;
      line-height: 22px;
      box-sizing: border-box;
    }

    .comment-input:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .comment-input::placeholder {
      color: var(--text-muted);
    }

    .comment-btn {
      width: 44px;
      height: 44px;
      min-width: 44px;
      padding: 0;
      background: var(--accent-primary);
      border: none;
      border-radius: 50%;
      color: var(--bg-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .comment-btn:hover {
      opacity: 0.9;
      transform: scale(1.05);
    }

    .comment-btn:active {
      transform: scale(0.95);
    }

    .comment-btn svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .comment-item {
      background: var(--bg-card);
      padding: 12px 16px;
      border-radius: 18px 18px 18px 4px;
      max-width: 85%;
      align-self: flex-start;
      border: 1px solid var(--border-color);
      animation: slideIn 0.2s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .comment-item.own-comment {
      align-self: flex-end;
      border-radius: 18px 18px 4px 18px;
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .comment-item.own-comment .comment-author {
      color: rgba(0, 0, 0, 0.8);
    }

    .comment-item.own-comment .comment-text {
      color: var(--bg-primary);
    }

    .comment-item.own-comment .comment-time {
      color: rgba(0, 0, 0, 0.6);
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .comment-author {
      font-weight: 600;
      font-size: 13px;
      color: var(--accent-primary);
    }

    .comment-delete-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      opacity: 0.6;
      transition: opacity 0.2s, background 0.2s;
    }

    .comment-delete-btn:hover {
      opacity: 1;
      background: rgba(244, 67, 54, 0.15);
    }

    .no-comments-msg {
      text-align: center;
      color: var(--text-muted);
      padding: 60px 20px;
      font-size: 14px;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .no-comments-msg svg {
      width: 56px;
      height: 56px;
      fill: var(--text-muted);
      opacity: 0.4;
      margin-bottom: 16px;
    }

    .notification-btn {
      position: relative;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #f44336;
      color: white;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
      animation: pulse-badge 2s infinite;
    }

    @keyframes pulse-badge {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .notification-item {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
    }

    .notification-item.unread {
      border-left: 4px solid #2196F3;
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.08) 0%, var(--bg-card) 100%);
      box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
    }

    .notification-item.read {
      opacity: 0.7;
      border-left: 4px solid var(--border-color);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .notification-title {
      font-weight: 700;
      font-size: 16px;
      color: var(--text-primary);
      line-height: 1.3;
    }

    .notification-time {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .notification-message {
      font-size: 15px;
      color: var(--text-secondary);
      margin-bottom: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .notification-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .notification-action-btn {
      background: none;
      border: 1px solid var(--border-color);
      cursor: pointer;
      font-size: 13px;
      padding: 8px 14px;
      border-radius: 8px;
      color: var(--text-primary);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .notification-action-btn:hover {
      background: var(--bg-hover);
    }

    .notification-action-btn.mark-read {
      background: rgba(33, 150, 243, 0.1);
      border-color: #2196F3;
      color: #2196F3;
    }

    .notification-action-btn.mark-read:hover {
      background: rgba(33, 150, 243, 0.2);
    }

    .notification-action-btn.delete {
      color: #f44336;
      border-color: #f44336;
    }

    .notification-action-btn.delete:hover {
      background: rgba(244, 67, 54, 0.1);
    }

    .notification-unread-indicator {
      width: 10px;
      height: 10px;
      background: #2196F3;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
      animation: pulse-indicator 1.5s infinite;
    }

    @keyframes pulse-indicator {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .toast-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      left: 20px;
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(33, 150, 243, 0.4);
      z-index: 10001;
      animation: slideInToast 0.4s ease, slideOutToast 0.4s ease 4.6s forwards;
      cursor: pointer;
    }

    .toast-notification .toast-title {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 4px;
    }

    .toast-notification .toast-message {
      font-size: 13px;
      opacity: 0.9;
    }

    @keyframes slideInToast {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes slideOutToast {
      from {
        transform: translateY(0);
        opacity: 1;
      }
      to {
        transform: translateY(-100%);
        opacity: 0;
      }
    }

    .skeleton-card {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .skeleton-poster {
      width: 100%;
      aspect-ratio: 3/4;
      background: linear-gradient(
        -45deg,
        #e0e0e0 25%,
        #f5f5f5 50%,
        #e0e0e0 75%
      );
      background-size: 400% 400%;
      animation: skeleton-wave 1.5s ease-in-out infinite;
    }

    :root.dark .skeleton-poster {
      background: linear-gradient(
        -45deg,
        #2a2a2a 25%,
        #3a3a3a 50%,
        #2a2a2a 75%
      );
      background-size: 400% 400%;
    }

    .skeleton-info {
      padding: 12px;
    }

    .skeleton-title {
      height: 16px;
      background: linear-gradient(
        -45deg,
        #e0e0e0 25%,
        #f5f5f5 50%,
        #e0e0e0 75%
      );
      background-size: 400% 400%;
      animation: skeleton-wave 1.5s ease-in-out infinite;
      border-radius: 4px;
      margin-bottom: 8px;
      width: 80%;
    }

    :root.dark .skeleton-title {
      background: linear-gradient(
        -45deg,
        #2a2a2a 25%,
        #3a3a3a 50%,
        #2a2a2a 75%
      );
      background-size: 400% 400%;
    }

    .skeleton-genre {
      height: 12px;
      background: linear-gradient(
        -45deg,
        #e0e0e0 25%,
        #f5f5f5 50%,
        #e0e0e0 75%
      );
      background-size: 400% 400%;
      animation: skeleton-wave 1.5s ease-in-out infinite;
      animation-delay: 0.1s;
      border-radius: 4px;
      width: 60%;
      margin-bottom: 8px;
    }

    :root.dark .skeleton-genre {
      background: linear-gradient(
        -45deg,
        #2a2a2a 25%,
        #3a3a3a 50%,
        #2a2a2a 75%
      );
      background-size: 400% 400%;
    }

    .skeleton-stats {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .skeleton-stat {
      height: 10px;
      background: linear-gradient(
        -45deg,
        #e0e0e0 25%,
        #f5f5f5 50%,
        #e0e0e0 75%
      );
      background-size: 400% 400%;
      animation: skeleton-wave 1.5s ease-in-out infinite;
      animation-delay: 0.2s;
      border-radius: 4px;
      width: 40px;
    }

    :root.dark .skeleton-stat {
      background: linear-gradient(
        -45deg,
        #2a2a2a 25%,
        #3a3a3a 50%,
        #2a2a2a 75%
      );
      background-size: 400% 400%;
    }

    @keyframes skeleton-wave {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .rating-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .rating-overlay.active {
      display: flex;
    }

    .rating-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .rating-main-container {
      flex: 1;
      overflow-y: auto;
      padding: 24px 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .rating-stars-container {
      display: flex;
      justify-content: center;
      gap: 12px;
      padding: 24px 0;
    }

    .rating-star {
      font-size: 48px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #ddd;
      -webkit-tap-highlight-color: transparent;
    }

    .rating-star:hover {
      transform: scale(1.15);
    }

    .rating-star.active {
      color: #FFD700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .rating-star.hover {
      color: #FFD700;
      opacity: 0.7;
    }

    .rating-header-stars {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      color: #FFD700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 193, 7, 0.2) 100%);
      padding: 6px 12px;
      border-radius: 20px;
      min-width: 60px;
      white-space: nowrap;
    }

    .rating-already-rated {
      text-align: center;
      padding: 28px 20px;
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(100, 181, 246, 0.15) 100%);
      border-radius: 16px;
      margin: 20px 0;
    }

    .rating-already-rated .check-icon {
      font-size: 56px;
      display: block;
      margin-bottom: 16px;
    }

    .rating-already-rated .message {
      font-size: 16px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .rating-already-rated .your-rating {
      font-size: 28px;
      margin-top: 16px;
    }

    .rating-action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 20px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .rating-action-btn {
      padding: 16px 24px;
      border: none;
      border-radius: 12px;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .rating-action-btn.primary {
      background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
      color: #000;
    }

    .rating-action-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }

    .rating-action-btn.primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .rating-action-btn.secondary {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }

    .rating-action-btn.secondary:hover {
      background: var(--bg-secondary);
    }

    .rating-instruction-text {
      text-align: center;
      color: var(--text-secondary);
      font-size: 16px;
      margin-bottom: 8px;
    }

    .comment-text {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .comment-time {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .main-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .btn-main {
      flex: 1;
      min-width: 150px;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      background: var(--accent-primary);
      color: var(--bg-primary);
    }

    .btn-main:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-close {
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-close:hover {
      border-color: var(--text-muted);
      color: var(--text-primary);
      background: var(--bg-card);
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
      font-size: 16px;
    }

    .pagination-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 20px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      position: sticky;
      bottom: 0;
    }

    .pagination-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .pagination-btn:hover:not(:disabled) svg {
      fill: var(--bg-primary);
    }

    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination-btn svg {
      fill: var(--text-primary);
      transition: fill 0.2s ease;
    }

    .pagination-btn:active:not(:disabled) {
      transform: scale(0.96);
    }

    .pagination-info {
      font-size: 14px;
      color: var(--text-muted);
      font-weight: 500;
      min-width: 100px;
      text-align: center;
    }

    @media (max-width: 480px) {
      .pagination-controls {
        gap: 8px;
        padding: 12px;
      }
      .pagination-btn {
        padding: 10px 14px;
        font-size: 13px;
      }
      .pagination-btn span {
        display: none;
      }
      .pagination-info {
        font-size: 12px;
        min-width: 80px;
      }
    }

    .custom-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }

    .custom-modal.active {
      display: flex;
    }

    .custom-modal-content {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 24px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .custom-modal h2 {
      margin-top: 0;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .custom-modal p {
      margin-bottom: 16px;
      color: var(--text-secondary);
    }

    .custom-modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 16px;
    }

    .custom-modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .custom-modal-btn.primary {
      background: var(--accent-primary);
      color: var(--bg-primary);
    }

    .custom-modal-btn.secondary {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }

    .transfer-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .transfer-overlay.active {
      display: flex;
    }

    .transfer-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 0;
    }

    .transfer-overlay-content form {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    .transfer-form-container {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .transfer-info-card {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .transfer-points-display {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .transfer-points-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00BCD4, #00838F);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .transfer-points-icon svg {
      fill: white;
      width: 28px;
      height: 28px;
    }

    .transfer-points-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .transfer-points-label {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .transfer-info-text {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 10px;
    }

    .transfer-type-selector {
      display: flex;
      gap: 12px;
    }

    .transfer-type-option {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 18px 14px;
      border-radius: 14px;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .transfer-type-option:hover {
      border-color: var(--text-muted);
    }

    .transfer-type-option.active {
      border-color: #00BCD4;
      background: rgba(0, 188, 212, 0.08);
    }

    .transfer-type-option input {
      display: none;
    }

    .transfer-type-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .transfer-type-option.active .transfer-type-icon {
      background: rgba(0, 188, 212, 0.2);
    }

    .transfer-type-icon svg {
      width: 24px;
      height: 24px;
      fill: var(--text-secondary);
      transition: fill 0.2s ease;
    }

    .transfer-type-option.active .transfer-type-icon svg {
      fill: #00BCD4;
    }

    .transfer-type-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      text-align: center;
    }

    .transfer-form-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .transfer-form-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .transfer-form-label-hint {
      font-weight: 400;
      color: var(--text-muted);
      font-size: 13px;
    }

    .transfer-form-input {
      padding: 16px 18px;
      border-radius: 14px;
      border: 1px solid var(--border-color);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .transfer-form-input:focus {
      outline: none;
      border-color: #00BCD4;
      background: var(--bg-secondary);
    }

    .transfer-form-input::placeholder {
      color: var(--text-muted);
    }

    .transfer-all-warning {
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 193, 7, 0.08));
      border: 1px solid rgba(255, 152, 0, 0.3);
      border-radius: 14px;
      padding: 16px;
    }

    .transfer-all-warning-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .transfer-all-warning-header svg {
      width: 22px;
      height: 22px;
      fill: #FF9800;
    }

    .transfer-all-warning-header strong {
      color: #FF9800;
      font-size: 15px;
    }

    .transfer-all-warning p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
    }

    .transfer-submit-footer {
      padding: 16px 20px;
      padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
      background: var(--bg-primary);
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
      flex-shrink: 0;
    }

    .transfer-submit-btn {
      flex: 1;
      padding: 16px 24px;
      border-radius: 14px;
      border: none;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .transfer-submit-btn.primary {
      background: linear-gradient(135deg, #00BCD4, #00838F);
      color: white;
    }

    .transfer-submit-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 188, 212, 0.4);
    }

    .transfer-submit-btn.primary:active {
      transform: scale(0.98);
    }

    .transfer-submit-btn.secondary {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }

    .transfer-submit-btn.secondary:hover {
      background: var(--bg-secondary);
    }

    .transfer-submit-btn svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .manage-users-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .manage-users-overlay.active {
      display: flex;
    }

    .manage-users-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .manage-users-filter-tabs {
      display: flex;
      gap: 8px;
      padding: 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .manage-users-filter-btn {
      flex: 1;
      padding: 14px 16px;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .manage-users-filter-btn:hover {
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .manage-users-filter-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .manage-users-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .manage-user-card {
      background: var(--bg-card);
      padding: 18px;
      border-radius: 16px;
      border: 1px solid var(--border-color);
      animation: slideIn 0.2s ease;
    }

    .manage-user-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .manage-user-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
      min-width: 0;
    }

    .manage-user-name {
      font-weight: 700;
      font-size: 17px;
      color: var(--text-primary);
      word-break: break-word;
    }

    .manage-user-email {
      font-size: 14px;
      color: var(--text-muted);
      word-break: break-all;
    }

    .manage-user-status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      flex-shrink: 0;
      margin-left: 12px;
    }

    .manage-user-status-badge.pending {
      background: rgba(255, 152, 0, 0.15);
      color: #ff9800;
    }

    .manage-user-status-badge.approved {
      background: rgba(33, 150, 243, 0.15);
      color: #2196F3;
    }

    .manage-user-status-badge.rejected {
      background: rgba(244, 67, 54, 0.15);
      color: #f44336;
    }

    .manage-user-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 16px;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 10px;
    }

    .manage-user-meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .manage-user-meta-item svg {
      width: 18px;
      height: 18px;
      fill: var(--text-muted);
    }

    .manage-user-actions {
      display: flex;
      gap: 10px;
    }

    .manage-user-action-btn {
      flex: 1;
      padding: 14px 18px;
      border: none;
      border-radius: 12px;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .manage-user-action-btn:active {
      transform: scale(0.97);
    }

    .manage-user-action-btn.approve {
      background: #2196F3;
      color: white;
    }

    .manage-user-action-btn.approve:hover {
      background: #1976D2;
    }

    .manage-user-action-btn.reject {
      background: rgba(244, 67, 54, 0.12);
      color: #f44336;
      border: 2px solid rgba(244, 67, 54, 0.3);
    }

    .manage-user-action-btn.reject:hover {
      background: rgba(244, 67, 54, 0.2);
      border-color: #f44336;
    }

    .manage-user-action-btn.restore {
      background: #2196F3;
      color: white;
    }

    .manage-user-action-btn.restore:hover {
      background: #1976D2;
    }

    .manage-user-action-btn svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .manage-users-empty {
      text-align: center;
      color: var(--text-muted);
      padding: 60px 20px;
      font-size: 15px;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .manage-users-empty svg {
      width: 64px;
      height: 64px;
      fill: var(--text-muted);
      opacity: 0.4;
      margin-bottom: 20px;
    }

    .manage-users-empty p {
      font-size: 16px;
      margin: 0;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--text-muted);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-primary);
    }

    .insufficient-points {
      background: #ff6b6b;
      color: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      text-align: center;
    }

    .redeem-section {
      background: var(--bg-card);
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
      border: 1px solid var(--border-color);
    }

    .redeem-input {
      width: 100%;
      padding: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      margin-bottom: 8px;
    }

    .code-display {
      background: var(--bg-secondary);
      padding: 12px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 18px;
      text-align: center;
      margin-top: 12px;
      border: 2px dashed var(--border-color);
    }

    .daily-reward-btn {
      background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
      color: white !important;
      border: none !important;
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
    }

    .daily-reward-btn:hover {
      background: linear-gradient(135deg, #F57C00 0%, #E65100 100%) !important;
      box-shadow: 0 6px 16px rgba(255, 152, 0, 0.5) !important;
    }

    .daily-reward-btn.claimed {
      background: linear-gradient(135deg, #9E9E9E 0%, #757575 100%);
      box-shadow: none;
      opacity: 0.7;
    }

    .favorite-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 24px;
      padding: 8px;
      transition: transform 0.2s ease;
    }

    .favorite-btn:hover {
      transform: scale(1.2);
    }

    .favorite-btn.active {
      animation: heartPulse 0.3s ease;
    }

    @keyframes heartPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .transfer-btn {
      background: transparent !important;
    }

    .transfer-btn:hover {
      background: var(--bg-card) !important;
      box-shadow: var(--shadow-sm);
    }

    .like-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .like-btn:hover {
      border-color: #e91e63;
      color: #e91e63;
    }

    .like-btn.liked {
      background: linear-gradient(135deg, rgba(233, 30, 99, 0.1) 0%, rgba(233, 30, 99, 0.15) 100%);
      border-color: #e91e63;
      color: #e91e63;
    }

    .like-btn .like-icon {
      font-size: 18px;
      transition: transform 0.2s ease;
    }

    .like-btn.liked .like-icon {
      animation: likeAnimation 0.3s ease;
    }

    .overlay-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-primary);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 12px 16px;
      padding-bottom: max(12px, env(safe-area-inset-bottom));
      z-index: 1001;
    }

    .footer-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 12px;
      transition: all 0.2s ease;
      color: var(--text-muted);
      min-width: 70px;
    }

    .footer-btn svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
      transition: all 0.2s ease;
    }

    .footer-btn span {
      font-size: 11px;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
    }

    .footer-btn:hover {
      color: var(--text-primary);
      background: var(--bg-secondary);
    }

    .footer-btn.active {
      color: var(--accent-primary);
    }

    .footer-btn.like-active {
      color: #e91e63;
    }

    .footer-btn.like-active svg {
      animation: likeAnimation 0.3s ease;
    }

    .modal-body {
      padding-bottom: 100px;
    }

    @keyframes likeAnimation {
      0% { transform: scale(1); }
      50% { transform: scale(1.4); }
      100% { transform: scale(1); }
    }

    .download-link-group {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .download-link-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .download-link-number {
      font-weight: 600;
      font-size: 14px;
      color: var(--accent-primary);
    }

    .remove-link-btn {
      background: rgba(244, 67, 54, 0.1);
      border: 1px solid rgba(244, 67, 54, 0.3);
      color: #f44336;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .remove-link-btn:hover {
      background: rgba(244, 67, 54, 0.2);
      border-color: #f44336;
    }

    .add-link-btn {
      width: 100%;
      padding: 12px;
      background: var(--bg-tertiary);
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      color: var(--accent-primary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    .add-link-btn:hover {
      border-color: var(--accent-primary);
      background: rgba(124, 77, 255, 0.1);
    }

    .download-section {
      background: var(--bg-tertiary);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .download-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }

    .download-section-buttons {
      display: flex;
      gap: 12px;
    }

    .download-section-buttons .btn-main {
      flex: 1;
    }

    .favorites-item {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg-card);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .favorites-item:hover {
      border-color: var(--accent-primary);
      transform: translateX(4px);
    }

    .favorites-item img {
      width: 50px;
      height: 70px;
      object-fit: cover;
      border-radius: 6px;
    }

    .favorites-item-info {
      flex: 1;
    }

    .favorites-item-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .favorites-item-meta {
      font-size: 12px;
      color: var(--text-muted);
    }

    .favorites-item-remove {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 8px;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .favorites-item-remove:hover {
      opacity: 1;
    }

    .profile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .profile-overlay.active {
      display: flex;
    }

    .profile-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .profile-container {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .profile-loading-skeleton {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 20px 0;
    }

    .skeleton-header {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
      border-radius: 20px;
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .skeleton-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      margin-bottom: 12px;
    }

    .skeleton-name {
      width: 150px;
      height: 24px;
      border-radius: 8px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      animation-delay: 0.1s;
      margin-bottom: 8px;
    }

    .skeleton-email {
      width: 200px;
      height: 16px;
      border-radius: 6px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      animation-delay: 0.2s;
      margin-bottom: 16px;
    }

    .skeleton-badge {
      width: 100px;
      height: 32px;
      border-radius: 16px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      animation-delay: 0.3s;
    }

    .skeleton-stats {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      justify-content: space-around;
    }

    .skeleton-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .skeleton-stat-value {
      width: 50px;
      height: 28px;
      border-radius: 6px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      animation-delay: 0.4s;
    }

    .skeleton-stat-label {
      width: 60px;
      height: 14px;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      animation-delay: 0.5s;
    }

    .skeleton-info-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow: hidden;
    }

    .skeleton-info-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .skeleton-info-item:last-child {
      border-bottom: none;
    }

    .skeleton-info-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      flex-shrink: 0;
    }

    .skeleton-info-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .skeleton-info-label {
      width: 60px;
      height: 12px;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
    }

    .skeleton-info-value {
      width: 140px;
      height: 16px;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
    }

    .skeleton-button {
      width: 100%;
      height: 54px;
      border-radius: 14px;
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeletonShimmer 1.5s infinite;
      animation-delay: 0.6s;
    }

    @keyframes skeletonShimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .profile-header-points {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .profile-header-points svg {
      fill: #FFD700;
    }

    .favorites-heart-btn {
      margin-right: 8px;
    }

    .favorites-heart-btn svg {
      fill: #ff4757;
    }

    .profile-avatar-svg {
      width: 80px;
      height: 80px;
      min-width: 80px;
      min-height: 80px;
      border-radius: 50%;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      border: 4px solid rgba(255,255,255,0.3);
      position: relative;
      z-index: 1;
      flex-shrink: 0;
      overflow: hidden;
      box-sizing: border-box;
    }

    .profile-avatar-svg.status-verified {
      border-color: #2196F3;
      box-shadow: 0 0 12px rgba(33, 150, 243, 0.4);
    }

    .profile-avatar-svg.status-pending {
      border-color: #FF9800;
      box-shadow: 0 0 12px rgba(255, 152, 0, 0.4);
    }

    .profile-avatar-svg.status-admin {
      border-color: #9C27B0;
      box-shadow: 0 0 12px rgba(156, 39, 176, 0.4);
    }

    .profile-avatar-svg.status-rejected {
      border-color: #f44336;
      box-shadow: 0 0 12px rgba(244, 67, 54, 0.4);
    }

    .profile-avatar-svg svg {
      width: 100%;
      height: 100%;
    }

    .profile-header-card {
      background: linear-gradient(135deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.4) 100%),
                  url('image.jpeg');
      background-size: cover;
      background-position: center;
      border-radius: 20px;
      padding: 24px 16px;
      text-align: center;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .profile-user-info-scroll {
      max-height: 80px;
      overflow-y: auto;
      width: 100%;
      position: relative;
      z-index: 1;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.4) transparent;
    }

    .profile-user-info-scroll::-webkit-scrollbar {
      width: 4px;
    }

    .profile-user-info-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .profile-user-info-scroll::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.4);
      border-radius: 2px;
    }

    .profile-user-info-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.6);
    }

    .profile-header-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      min-width: 80px;
      min-height: 80px;
      border-radius: 50%;
      background: var(--bg-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 36px;
      border: 3px solid rgba(255,255,255,0.3);
      position: relative;
      z-index: 1;
      flex-shrink: 0;
    }

    .profile-name {
      font-size: 20px;
      font-weight: 700;
      color: var(--bg-primary);
      margin: 0 0 6px 0;
      position: relative;
      z-index: 1;
      word-break: break-word;
      overflow-wrap: break-word;
      max-width: 100%;
      padding: 0 10px;
    }

    .dark .profile-name {
      color: white;
    }

    .profile-email {
      font-size: 13px;
      word-break: break-all;
      overflow-wrap: break-word;
      max-width: 100%;
      padding: 0 10px;
      color: rgba(255,255,255,0.8);
      margin: 0 0 16px 0;
      position: relative;
      z-index: 1;
    }

    .profile-status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .profile-status-badge.verified {
      background: rgba(33, 150, 243, 0.2);
      color: #2196F3;
      border: 1px solid rgba(33, 150, 243, 0.4);
    }

    .profile-status-badge.pending {
      background: rgba(255, 152, 0, 0.2);
      color: #FF9800;
      border: 1px solid rgba(255, 152, 0, 0.4);
    }

    .profile-status-badge.admin {
      background: rgba(156, 39, 176, 0.2);
      color: #ff00faff;
      border: 1px solid rgba(156, 39, 176, 0.4);
    }

    .profile-stats-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      justify-content: space-around;
    }

    .profile-stat {
      text-align: center;
      flex: 1;
    }

    .profile-stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .profile-stat-label {
      font-size: 13px;
      color: var(--text-muted);
    }

    .profile-stat-divider {
      width: 1px;
      background: var(--border-color);
      margin: 0 10px;
    }

    .profile-info-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow-y: auto;
      overflow-x: hidden;
      max-height: 280px;
      scrollbar-width: thin;
      scrollbar-color: var(--text-muted) transparent;
    }

    .profile-info-card::-webkit-scrollbar {
      width: 6px;
    }

    .profile-info-card::-webkit-scrollbar-track {
      background: transparent;
    }

    .profile-info-card::-webkit-scrollbar-thumb {
      background: var(--text-muted);
      border-radius: 3px;
    }

    .profile-info-card::-webkit-scrollbar-thumb:hover {
      background: var(--text-secondary);
    }

    .profile-info-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .profile-info-item:last-child {
      border-bottom: none;
    }

    .profile-info-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .profile-info-icon svg {
      width: 22px;
      height: 22px;
      fill: var(--accent-primary);
    }

    .profile-info-content {
      flex: 1;
      min-width: 0;
    }

    .profile-info-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .profile-info-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      word-break: break-word;
    }

    .profile-logout-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 18px;
      background: transparent;
      border: 2px solid #ef5350;
      border-radius: 14px;
      color: #ef5350;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 10px;
    }

    .profile-logout-btn:hover {
      background: rgba(239, 83, 80, 0.1);
    }

    .profile-logout-btn svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    .profile-not-logged {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      text-align: center;
    }

    .profile-not-logged-icon {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: var(--bg-card);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      border: 2px solid var(--border-color);
    }

    .profile-not-logged-icon svg {
      width: 50px;
      height: 50px;
      fill: var(--text-muted);
    }

    .profile-not-logged h3 {
      font-size: 22px;
      color: var(--text-primary);
      margin: 0 0 10px 0;
    }

    .profile-not-logged p {
      font-size: 15px;
      color: var(--text-muted);
      margin: 0 0 28px 0;
      line-height: 1.5;
    }

    .profile-login-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 18px 48px;
      background: var(--accent-primary);
      border: none;
      border-radius: 14px;
      color: var(--bg-primary);
      font-family: 'Inter', sans-serif;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .profile-login-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .profile-login-btn svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    .about-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .about-overlay.active {
      display: flex;
    }

    .about-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .about-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .about-header-card {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(156, 39, 176, 0.1) 100%);
      border: 1px solid rgba(33, 150, 243, 0.2);
      border-radius: 20px;
      padding: 32px 24px;
      text-align: center;
    }

    .about-logo {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      background: var(--accent-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 40px;
    }

    .about-title {
      font-size: 26px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 8px 0;
    }

    .about-subtitle {
      font-size: 15px;
      color: var(--text-secondary);
      margin: 0 0 12px 0;
    }

    .about-version {
      display: inline-block;
      padding: 6px 16px;
      background: var(--bg-card);
      border-radius: 20px;
      font-size: 13px;
      color: var(--text-muted);
      border: 1px solid var(--border-color);
    }

    .about-faq-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow: hidden;
    }

    .about-faq-item {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .about-faq-item:last-child {
      border-bottom: none;
    }

    .about-faq-question {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 10px 0;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .about-faq-question span {
      font-size: 18px;
    }

    .about-faq-answer {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin: 0;
      padding-left: 28px;
    }

    .about-contact-card {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(100, 181, 246, 0.08) 100%);
      border: 1px solid rgba(33, 150, 243, 0.2);
      border-radius: 16px;
      padding: 24px;
    }

    .about-contact-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .about-contact-title span {
      font-size: 24px;
    }

    .about-contact-email {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-card);
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .about-contact-email svg {
      width: 24px;
      height: 24px;
      fill: var(--accent-primary);
      flex-shrink: 0;
    }

    .about-contact-email a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      font-size: 15px;
      word-break: break-all;
    }

    .about-contact-email a:hover {
      text-decoration: underline;
    }

    .history-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .history-overlay.active {
      display: flex;
    }

    .history-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .history-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .history-item {
      background: var(--bg-card);
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--border-color);
      display: flex;
      gap: 16px;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .history-item:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .history-item:active {
      transform: scale(0.98);
    }

    .history-item img {
      width: 70px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      flex-shrink: 0;
    }

    .history-item-info {
      flex: 1;
      min-width: 0;
    }

    .history-item-title {
      margin: 0 0 6px 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .history-item-time {
      color: var(--text-muted);
      font-size: 14px;
      margin: 0;
    }

    .history-footer {
      padding: 16px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: center;
    }

    .history-footer-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      background: transparent;
      border: 1px solid #ef5350;
      border-radius: 12px;
      color: #ef5350;
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      max-width: 300px;
    }

    .history-footer-btn:hover {
      background: rgba(239, 83, 80, 0.1);
    }

    .history-footer-btn svg {
      fill: currentColor;
    }

    .history-empty {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      text-align: center;
    }

    .history-empty svg {
      width: 80px;
      height: 80px;
      fill: var(--text-muted);
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .history-empty p {
      color: var(--text-muted);
      font-size: 16px;
      margin: 0;
    }

    .report-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .report-overlay.active {
      display: flex;
    }

    .report-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .report-form-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .report-info-box {
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 87, 34, 0.1) 100%);
      padding: 20px;
      border-radius: 16px;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }

    .report-info-box p {
      color: var(--text-secondary);
      font-size: 15px;
      line-height: 1.6;
      margin: 0;
    }

    .report-form-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .report-form-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .report-form-input {
      width: 100%;
      padding: 16px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .report-form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .report-form-input::placeholder {
      color: var(--text-muted);
    }

    .report-form-textarea {
      min-height: 150px;
      resize: vertical;
      line-height: 1.6;
    }

    .report-form-hint {
      color: var(--text-muted);
      font-size: 13px;
    }

    .report-footer {
      padding: 16px 20px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
    }

    .report-submit-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px 24px;
      background: var(--accent-primary);
      border: none;
      border-radius: 12px;
      color: var(--bg-primary);
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .report-submit-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .report-submit-btn:active {
      transform: scale(0.98);
    }

    .report-submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .report-submit-btn svg {
      fill: currentColor;
    }

    .notifications-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .notifications-overlay.active {
      display: flex;
    }

    .notifications-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .notifications-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .notifications-footer {
      padding: 16px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .notifications-footer-btn {
      width: 100%;
      padding: 14px 20px;
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .notifications-footer-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
    }

    .notifications-footer-btn:active {
      transform: translateY(0);
    }

    .favorites-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .favorites-overlay.active {
      display: flex;
    }

    .favorites-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .favorites-list-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .notifications-overlay .notification-item {
      padding: 18px;
      margin-bottom: 0;
      border-radius: 16px;
    }

    .notifications-overlay .notification-title {
      font-size: 17px;
      font-weight: 700;
    }

    .notifications-overlay .notification-message {
      font-size: 16px;
      margin-bottom: 16px;
    }

    .notifications-overlay .notification-time {
      font-size: 13px;
    }

    .notifications-overlay .notification-action-btn {
      font-size: 14px;
      padding: 10px 16px;
      border-radius: 10px;
    }

    .send-notification-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 2000;
      flex-direction: column;
      animation: fadeIn 0.25s ease;
    }

    .send-notification-overlay.active {
      display: flex;
    }

    .send-notification-overlay-content {
      width: 100%;
      height: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 0;
    }

    .send-notification-overlay-content form {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    .send-notification-form-container {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .send-notification-form-container .form-group {
      margin-bottom: 0;
    }

    .send-notification-form-container .form-label {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
      display: block;
    }

    .send-notification-form-container .form-input,
    .send-notification-form-container .form-textarea,
    .send-notification-form-container .form-select {
      font-size: 16px;
      padding: 16px 18px;
      border-radius: 14px;
      width: 100%;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .send-notification-form-container .form-input:focus,
    .send-notification-form-container .form-textarea:focus,
    .send-notification-form-container .form-select:focus {
      outline: none;
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .send-notification-form-container .form-input::placeholder,
    .send-notification-form-container .form-textarea::placeholder {
      color: var(--text-muted);
    }

    .send-notification-form-container .form-textarea {
      min-height: 140px;
      resize: vertical;
      line-height: 1.6;
    }

    .send-notification-target-options {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .send-notification-target-btn {
      flex: 1;
      padding: 16px;
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 14px;
      color: var(--text-secondary);
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .send-notification-target-btn svg {
      width: 28px;
      height: 28px;
      fill: var(--text-muted);
      transition: fill 0.2s ease;
    }

    .send-notification-target-btn:hover {
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .send-notification-target-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--bg-primary);
    }

    .send-notification-target-btn.active svg {
      fill: var(--bg-primary);
    }

    .send-notification-user-selector {
      display: none;
      margin-top: 8px;
    }

    .send-notification-user-selector.active {
      display: block;
    }

    .send-notification-footer {
      display: flex;
      gap: 12px;
      padding: 16px 20px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .send-notification-footer .send-notification-btn {
      flex: 1;
      padding: 16px 20px;
      border: none;
      border-radius: 14px;
      font-family: 'Inter', sans-serif;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .send-notification-footer .send-notification-btn.primary {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: white;
    }

    .send-notification-footer .send-notification-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
    }

    .send-notification-footer .send-notification-btn.primary:active {
      transform: translateY(0);
    }

    .send-notification-footer .send-notification-btn.secondary {
      background: transparent;
      border: 2px solid var(--border-color);
      color: var(--text-secondary);
    }

    .send-notification-footer .send-notification-btn.secondary:hover {
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .send-notification-footer .send-notification-btn svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    .favorites-overlay .favorites-item {
      padding: 16px;
      border-radius: 14px;
      gap: 16px;
      margin-bottom: 0;
    }

    .favorites-overlay .favorites-item img {
      width: 60px;
      height: 84px;
      border-radius: 10px;
    }

    .favorites-overlay .favorites-item-title {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .favorites-overlay .favorites-item-meta {
      font-size: 14px;
    }

    .favorites-overlay .favorites-item-remove {
      font-size: 22px;
      padding: 12px;
    }

    .overlay-empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }

    .overlay-empty-state svg {
      width: 80px;
      height: 80px;
      fill: var(--text-muted);
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .overlay-empty-state h3 {
      font-size: 20px;
      color: var(--text-primary);
      margin: 0 0 10px 0;
      font-weight: 600;
    }

    .overlay-empty-state p {
      font-size: 16px;
      color: var(--text-muted);
      margin: 0;
      max-width: 280px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="header">
    <button class="menu-btn" onclick="toggleSidebar()">
      <svg viewBox="0 0 24 24"><path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/></svg>
    </button>
    <div class="app-name">Portal Digital</div>
    <button onclick="toggleSearch()" style="margin-left: auto; display: flex; align-items: center; background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 4px; cursor: pointer;">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
        <path d="M10 2a8 8 0 105.293 14.293l4.707 4.707 1.414-1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"/>
      </svg>
      Buscar
    </button>
    <button onclick="toggleCatalogs()" style="display: flex; align-items: center; background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 4px; cursor: pointer;">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
      Ver
    </button>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h2>Portal Digital</h2>
      <button class="theme-toggle-btn" onclick="toggleTheme()" title="Alternar tema">
        <svg class="sun-icon" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>
        <svg class="moon-icon" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
      </button>
    </div>

    <button class="btn" id="myProfileBtn" onclick="openProfileOverlay()" style="margin-bottom: 8px;">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
      Meu Perfil
    </button>

    <button class="btn" id="loginBtn" onclick="openLoginModal()">
      <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
      Entrar
    </button>

    <button class="btn" id="registerBtn" onclick="openRegisterModal()">
      <svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
      Criar Conta
    </button>

    <button class="btn" id="publishBtn" onclick="openPublishModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
      Publicar
    </button>

    <button class="btn" id="manageBtn" onclick="openManageModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>
      Meus Jogos
    </button>

    <button class="btn" id="generateCodeBtn" onclick="openGenerateCodeModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      Gerar Cdigo de Pontos
    </button>

    <button class="btn" id="manageUsersBtn" onclick="openManageUsersModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
      Gerenciar Usurios
    </button>

    <button class="btn" id="sendNotificationBtn" onclick="openSendNotificationModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M20 17H4V10l8 5 8-5v7zm0-8l-8 5-8-5V7h16v2zm0-4H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2z"/></svg>
      Enviar Notificao
    </button>

    <button class="btn notification-btn" id="viewNotificationsBtn" onclick="openNotificationsModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
      Notificaes
      <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
    </button>

    <button class="btn daily-reward-btn" id="dailyRewardBtn" onclick="claimDailyReward()" style="display: none;">
      <svg viewBox="0 0 24 24" style="fill: white;"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"/></svg>
      <span id="dailyRewardText">Recompensa Diria</span>
    </button>

    <button class="btn transfer-btn" id="transferBtn" onclick="openTransferModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/></svg>
      Transferir Pontos
    </button>

    <button class="btn" id="redeemCodeBtn" onclick="openRedeemCodeModal()">
      <svg viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 00-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/></svg>
      Resgatar Cdigo
    </button>

    <button class="btn" onclick="openHistoryModal()">
      <svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
      Histrico
    </button>

    <button class="btn" id="reportProblemBtn" onclick="openReportProblemModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>
      Reportar Problema
    </button>

    <button class="btn notification-btn" id="viewReportsBtn" onclick="openViewReportsModal()" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H6v-2h6v2zm3-4H6v-2h9v2zm0-4H6V7h9v2z"/></svg>
      Ver Reports
      <span class="notification-badge" id="reportsBadge" style="display: none;">0</span>
    </button>

    <div style="border-top: 1px solid var(--border-color); margin: 12px 0; padding-top: 12px;">
      <button class="btn" onclick="openAboutOverlay()">
        <svg viewBox="0 0 24 24"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
        Sobre Ns
      </button>
      <button class="btn" onclick="openRatingModal()">
        <svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
        Avaliar o Aplicativo
      </button>
    </div>
  </div>

  <div id="search-container" class="search-container">
    <div class="search-wrapper">
      <input type="text" id="searchInput" class="search-input" placeholder="Pesquisar jogo ou app...">
      <span class="search-icon"></span>
    </div>
  </div>

  <div id="filter-tabs" class="filter-tabs">
    <button class="filter-btn active" data-filter="all">Todos</button>
    <button class="filter-btn" data-filter="aplicativos">APLICATIVOS</button>
    <button class="filter-btn" data-filter="jogos">JOGOS</button>
    <button class="filter-btn" data-filter="tutoriais">TUTORIAIS</button>
    <button class="filter-btn" data-filter="pc">PC</button>
    <button class="filter-btn" data-filter="outros">OUTROS</button>
  </div>

  <div class="content-wrapper">
    <div class="grid" id="contentGrid">
      
      <div class="skeleton-card">
        <div class="skeleton-poster"></div>
        <div class="skeleton-info">
          <div class="skeleton-title"></div>
          <div class="skeleton-genre"></div>
          <div class="skeleton-stats">
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
          </div>
        </div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton-poster"></div>
        <div class="skeleton-info">
          <div class="skeleton-title"></div>
          <div class="skeleton-genre"></div>
          <div class="skeleton-stats">
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
          </div>
        </div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton-poster"></div>
        <div class="skeleton-info">
          <div class="skeleton-title"></div>
          <div class="skeleton-genre"></div>
          <div class="skeleton-stats">
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
          </div>
        </div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton-poster"></div>
        <div class="skeleton-info">
          <div class="skeleton-title"></div>
          <div class="skeleton-genre"></div>
          <div class="skeleton-stats">
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="pagination-controls" id="paginationControls" style="display: none;">
      <button class="pagination-btn prev-btn" id="prevPageBtn" onclick="goToPrevPage()">
        <svg viewBox="0 0 24 24" width="20" height="20"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
        <span>Anterior</span>
      </button>
      <div class="pagination-info">
        <span id="paginationText">1 - 10 de 100</span>
      </div>
      <button class="pagination-btn next-btn" id="nextPageBtn" onclick="goToNextPage()">
        <span>Prximo</span>
        <svg viewBox="0 0 24 24" width="20" height="20"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
      </button>
    </div>

    <div id="noResults" class="no-results" style="display: none;">
      Nenhum resultado encontrado
    </div>
  </div>

  <div id="overlay" class="overlay">
    <div class="modal">
      
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title" id="contentHeaderTitle">Carregando...</h1>
        <button class="favorite-btn" id="favoriteBtn" onclick="toggleFavorite()" title="Adicionar aos favoritos" style="padding: 8px;">
          <svg id="favoriteIcon" viewBox="0 0 24 24" width="24" height="24" style="fill: #9e9e9e; transition: all 0.2s ease;"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </button>
        <button class="content-header-btn share-btn" onclick="shareContent()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
        </button>
        <button class="content-header-btn report-btn" onclick="openReportFromGame()" title="Reportar Problema">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>
        </button>
      </div>
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Ttulo</h2>
        <div class="modal-meta" id="modalMeta"></div>
      </div>
      <div class="modal-body">
        <div id="videoContainer" class="video-container" style="display: none;"></div>

        <div class="game-info active" id="gameInfo">
          <div class="modal-description" id="modalDescription"></div>
        </div>

      </div>

      <div class="overlay-footer">
        <button class="footer-btn" id="footerDownloadsBtn" onclick="showDownloads(); updateFooterActive('downloads')">
          <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
          <span>Downloads</span>
        </button>
        <button class="footer-btn active" id="footerInfoBtn" onclick="showGameInfo(); updateFooterActive('info')">
          <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
          <span>Informaes</span>
        </button>
        <button class="footer-btn" id="footerLikeBtn" onclick="toggleLike()">
          <svg id="footerLikeIcon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
          <span>Curtir</span>
        </button>
        <button class="footer-btn" id="footerCommentsBtn" onclick="showComments(); updateFooterActive('comments')">
          <svg viewBox="0 0 24 24"><path d="M21 6h-2V3c0-.55-.45-1-1-1H2c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1v-2h2c.55 0 1-.45 1-1V7c0-.55-.45-1-1-1zm-4 6H6.83L5 13.83V4h12v8zm4-2h-2V7h-9v-.5c0-.28.22-.5.5-.5h9c.28 0 .5.22.5.5V10z"/></svg>
          <span>Comentrios</span>
        </button>
      </div>
    </div>
  </div>

  <div id="commentsOverlay" class="comments-overlay">
    <div class="comments-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeCommentsOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Comentrios</h1>
        <button class="content-header-btn help-btn" onclick="openCommentsHelpModal()" title="Dvidas">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
        </button>
      </div>
      <div id="commentsList" class="comments-list-container"></div>
      <div id="commentInputWrapper" class="comment-input-wrapper" style="display: none;">
        <div id="commentBtnRow" class="comment-btn-row" style="display: none;">
          <button id="commentSendBtn" class="comment-btn" onclick="postComment()" title="Enviar">
            <svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>
          </button>
        </div>
        <textarea id="commentInput" class="comment-input" placeholder="Escreva um comentrio..." rows="1"></textarea>
      </div>
    </div>
  </div>

  <div id="downloadsOverlay" class="downloads-overlay">
    <div class="downloads-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeDownloadsOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Downloads</h1>
        <div style="width: 40px;"></div>
      </div>
      <div class="downloads-list-container">
        <div id="downloadsInsufficientWarning" style="display: none;" class="insufficient-points">
           Voc no tem pontos suficientes para baixar este contedo!
        </div>
        <div class="downloads-info-box">
          <p>Escolha uma das opes abaixo para baixar o contedo. Cada download ir descontar os pontos indicados.</p>
          <div class="cost-badge" id="downloadsCostBadge">
            <svg viewBox="0 0 24 24" width="16" height="16" style="fill: currentColor;"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
            <span id="downloadsCostValue">0 pontos</span>
          </div>
        </div>
        
        <div id="downloadSectionsContainer"></div>
      </div>
    </div>
  </div>

  <div id="authLoadingOverlay" class="auth-loading-overlay">
    <div class="auth-loading-icon">
     <img src="logo.png" alt="Logo do aplicativo" style="width: 80px; height: auto;"> </div>
    <div class="auth-loading-spinner"></div>
    <div class="auth-loading-text" id="authLoadingText">A entrar...</div>
    <div class="auth-loading-subtext" id="authLoadingSubtext">Por favor aguarde</div>
  </div>

  <div id="authOverlay" class="auth-overlay">
    <div class="auth-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="authGoBack()" id="authBackBtn" style="visibility: hidden;">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h3 class="content-header-title" id="authHeaderTitle">Bem-vindo</h3>
        <div style="width: 40px;"></div>
      </div>

      <div class="auth-main">
        
        <div id="authWelcomeScreen" class="auth-form-container active">
          <div class="auth-welcome">
            <div class="auth-welcome-icon">
              <img src="logo.png" alt="Portal Digital Logo">
            </div>
            <h1>Portal Digital</h1>
            <p>Baixe jogos, apps e tutoriais exclusivos. Escolha como deseja continuar.</p>
          </div>

          <div class="auth-options">
            <button class="auth-option-btn primary" onclick="showLoginForm()">
              <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
              <div class="auth-option-text">
                Entrar
                <small>Acesse sua conta existente</small>
              </div>
            </button>

            <button class="auth-option-btn" onclick="showRegisterForm()">
              <svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
              <div class="auth-option-text">
                Criar Conta
                <small>Registre-se para baixar contedo</small>
              </div>
            </button>

            <button class="auth-option-btn" onclick="enterAsVisitor()">
              <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              <div class="auth-option-text">
                Modo Visitante
                <small>Explore sem criar conta</small>
              </div>
            </button>
          </div>
        </div>

        <div id="authLoginForm" class="auth-form-container">
          <div class="auth-form-header">
            <h2>Entrar na Conta</h2>
            <p>Insira seus dados para acessar</p>
          </div>

          <form class="auth-form" onsubmit="handleLogin(event)">
            <div class="auth-input-group">
              <label>Email</label>
              <input type="email" id="loginEmail" placeholder="seu@email.com" required>
            </div>

            <div class="auth-input-group">
              <label>Senha</label>
              <input type="password" id="loginPassword" placeholder="Sua senha" required>
            </div>

            <button type="submit" class="auth-submit-btn">Entrar</button>

            <div class="auth-form-footer">
              <a href="#" onclick="showResetPasswordForm(); return false;">Esqueceu a senha?</a>
            </div>
          </form>

          <div style="text-align: center;">
            <a href="#" class="auth-back-link" onclick="authShowWelcome(); return false;">
              <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
              Voltar s opes
            </a>
          </div>
        </div>

        <div id="authRegisterForm" class="auth-form-container">
          <div class="auth-form-header">
            <h2>Criar Conta</h2>
            <p>Preencha seus dados para se registrar</p>
          </div>

          <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
            <div class="auth-input-group">
              <label>Nome Completo</label>
              <input type="text" id="registerName" placeholder="Seu nome" required>
            </div>

            <div class="auth-input-group">
              <label>Email (Gmail)</label>
              <input type="email" id="registerEmail" placeholder="seuemail@gmail.com" pattern="[a-zA-Z0-9._%+-]+@gmail\.com$" title="Por favor, use um email do Gmail" required>
              <small>Apenas emails @gmail.com so aceitos</small>
            </div>

            <div class="auth-input-group">
              <label>Senha</label>
              <input type="password" id="registerPassword" placeholder="Mnimo 6 caracteres" minlength="6" required>
            </div>

            <div class="auth-input-group">
              <label>Confirmar Senha</label>
              <input type="password" id="registerPasswordConfirm" placeholder="Repita a senha" minlength="6" required>
            </div>

            <button type="submit" class="auth-submit-btn">Criar Conta</button>
          </form>

          <div style="text-align: center;">
            <a href="#" class="auth-back-link" onclick="authShowWelcome(); return false;">
              <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
              Voltar s opes
            </a>
          </div>
        </div>

        <div id="authResetForm" class="auth-form-container">
          <div class="auth-form-header">
            <h2>Redefinir Senha</h2>
            <p>Digite seu email para receber o link de redefinio</p>
          </div>

          <form class="auth-form" onsubmit="handleResetPasswordFromOverlay(event)">
            <div class="auth-input-group">
              <label>Email</label>
              <input type="email" id="resetEmailOverlay" placeholder="seu@email.com" required>
            </div>

            <button type="submit" class="auth-submit-btn">Enviar Link</button>
          </form>

          <div style="text-align: center;">
            <a href="#" class="auth-back-link" onclick="showLoginForm(); return false;">
              <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
              Voltar ao login
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="emailVerificationModal" class="custom-modal">
    <div class="custom-modal-content" style="max-width: 450px;">
      <h2> Verificar Email</h2>

      <div id="emailVerificationContent">
        
      </div>
    </div>
  </div>

  <div id="resetPasswordModal" class="custom-modal">
    <div class="custom-modal-content">
      <h2>Redefinir Senha</h2>
      <p>Digite seu email para receber o link de redefinio de senha.</p>
      <form id="resetPasswordForm" onsubmit="handleResetPassword(event)">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="resetEmail" required>
        </div>
        <div class="custom-modal-buttons">
          <button type="button" class="custom-modal-btn secondary" onclick="closeResetPasswordModal()">Cancelar</button>
          <button type="submit" class="custom-modal-btn primary">Enviar Link</button>
        </div>
      </form>
    </div>
  </div>

  <div id="publishOverlay" class="publish-overlay">
    <div class="publish-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closePublishModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title" id="publishModalTitle">Publicar Jogo</h1>
        <div style="width: 40px;"></div>
      </div>
      <form id="publishForm" onsubmit="handlePublish(event)">
        <input type="hidden" id="editGameId">
        <div class="publish-form-container">
          <div class="form-group">
            <label class="form-label">Categoria</label>
            <select class="form-select" id="gameType" required>
              <option value="aplicativos">APLICATIVOS</option>
              <option value="jogos">JOGOS</option>
              <option value="tutoriais">TUTORIAIS</option>
              <option value="pc">PC</option>
              <option value="outros">OUTROS</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Ttulo</label>
            <input type="text" class="form-input" id="gameTitle" required>
          </div>

          <div class="form-group">
            <label class="form-label">Gnero</label>
            <input type="text" class="form-input" id="gameGenre" placeholder="Ex: Ao, Aventura" required>
          </div>

          <div class="form-group">
            <label class="form-label">Tamanho</label>
            <input type="text" class="form-input" id="gameSize" placeholder="Ex: 1.5 GB" required>
          </div>

          <div class="form-group">
            <label class="form-label">Descrio</label>
            <textarea class="form-textarea" id="gameDescription" required></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">URL da Capa (imagem)</label>
            <input type="url" class="form-input" id="gamePoster" required>
          </div>

          <div class="form-group">
            <label class="form-label">Link do Vdeo YouTube (opcional)</label>
            <input type="url" class="form-input" id="gameVideo" placeholder="https://www.youtube.com/watch?v=...">
          </div>

          <div class="form-group">
            <label class="form-label">Links de Download</label>
            <div id="downloadLinksContainer">
              
              <div class="download-link-group" data-link-index="1">
                <div class="download-link-header">
                  <span class="download-link-number">Link 1</span>
                  <button type="button" class="remove-link-btn" onclick="removeDownloadLink(1)" style="display: none;"></button>
                </div>
                <input type="text" class="form-input" placeholder="Descrio (ex: Jogo Principal, Emulador, ISO...)" id="linkDesc1" required>
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                  <input type="url" class="form-input" placeholder="Link G.A" id="linkGA1" required style="flex: 1;">
                  <input type="url" class="form-input" placeholder="Link ADM" id="linkADM1" required style="flex: 1;">
                </div>
              </div>
            </div>
            <button type="button" class="add-link-btn" onclick="addDownloadLink()">
              + Adicionar mais um link de download
            </button>
          </div>

          <div class="form-group">
            <label class="form-label">Custo em Pontos</label>
            <input type="number" class="form-input" id="gameCost" min="0" required>
          </div>
        </div>

        <div class="publish-footer">
          <button type="button" class="publish-btn secondary" onclick="closePublishModal()">Cancelar</button>
          <button type="submit" class="publish-btn primary">Publicar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="manageOverlay" class="manage-overlay">
    <div class="manage-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeManageModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Meus Jogos</h1>
        <div style="width: 40px;"></div>
      </div>
      <div id="manageGamesList" class="manage-list-container">
        <div class="manage-empty-state">
          <div class="icon"></div>
          <p>Carregando...</p>
        </div>
      </div>
    </div>
  </div>

  <div id="generateCodeOverlay" class="generate-code-overlay">
    <div class="generate-code-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeGenerateCodeModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Gerar Cdigo de Pontos</h1>
        <div style="width: 40px;"></div>
      </div>

      <div class="generate-code-container">
        
        <div class="generate-code-header-box">
          <div class="icon"></div>
          <h3>Criar Cdigo de Resgate</h3>
          <p>Gere um cdigo nico para que seus usurios possam resgatar pontos na plataforma</p>
        </div>

        <div class="generate-code-input-section">
          <label>Quantidade de Pontos</label>
          <input type="number" id="codePoints" min="1" value="50" placeholder="Digite a quantidade" required>
          <button class="generate-code-btn" onclick="generateCode()">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            Gerar Cdigo
          </button>
        </div>

        <div id="generatedCodeResult" class="generated-code-result">
          <h4> Cdigo Gerado com Sucesso!</h4>
          <div id="codeDisplay" class="generated-code-display"></div>
          <p class="generated-code-hint">
            Compartilhe este cdigo com seus usurios. Cada cdigo pode ser usado apenas uma vez.
          </p>
          <button class="generated-code-copy-btn" onclick="copyGeneratedCode()">
            <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            Copiar Cdigo
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="redeemOverlay" class="redeem-overlay">
    <div class="redeem-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeRedeemCodeModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Resgatar Pontos</h1>
        <div style="width: 40px;"></div>
      </div>

      <div class="redeem-container">
        
        <div class="redeem-header-box">
          <div class="icon"></div>
          <h3>Resgate seu Cdigo</h3>
          <p>Insira o cdigo de resgate abaixo para adicionar pontos  sua conta</p>
        </div>

        <div class="redeem-input-section">
          <label>Cdigo de Resgate</label>
          <input type="text" id="redeemCodeInput" placeholder="Digite o cdigo aqui" required>
          <button class="redeem-btn" onclick="redeemCode()">
            <svg viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 00-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/></svg>
            Resgatar Cdigo
          </button>
        </div>

        <div class="buy-points-box">
          <div class="header">
            <span class="icon"></span>
            <h4>Comprar Pontos</h4>
          </div>
          <p> possvel comprar pontos por um preo acessvel! Para mais informaes, entre em contacto connosco:</p>

          <div class="contact-item">
            <span class="icon"></span>
            <div class="info">
              <div class="label">Unitel</div>
              <div class="number">932 535 389</div>
            </div>
            
          </div>

          <div class="contact-item">
            <span class="icon"></span>
            <div class="info">
              <div class="label">WhatsApp</div>
              <div class="number">955 597 211</div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="historyOverlay" class="history-overlay">
    <div class="history-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeHistoryOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Histrico</h1>
        <div style="width: 40px;"></div>
      </div>
      <div id="historyList" class="history-list-container"></div>
      <div id="historyFooter" class="history-footer" style="display: none;">
        <button class="history-footer-btn" onclick="clearHistory()">
          <svg viewBox="0 0 24 24" width="20" height="20"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
          Limpar Histrico
        </button>
      </div>
    </div>
  </div>

  <div id="profileOverlay" class="profile-overlay">
    <div class="profile-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeProfileOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Meu Perfil</h1>
        <button id="profileFavoritesBtn" class="content-header-btn favorites-heart-btn" onclick="closeProfileOverlay(); openFavoritesModal();" style="display: none;">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </button>
        <div id="profileHeaderPoints" class="profile-header-points">
          <svg viewBox="0 0 24 24" width="16" height="16"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>
          <span id="profileHeaderPointsValue">0</span>
        </div>
      </div>
      <div id="profileContainer" class="profile-container">
        
      </div>
    </div>
  </div>

  <div id="aboutOverlay" class="about-overlay">
    <div class="about-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeAboutOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Sobre </h1>
        <button class="content-header-btn help-btn" onclick="openAboutHelpModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
        </button>
      </div>
      <div class="about-container">
        
        <div class="about-header-card">
          <div class="about-logo"><img src="logo.png" alt="Logo do aplicativo" style="width: 80px; height: auto;"></div>
          <h1 class="about-title">Portal Digital</h1>
          <p class="about-subtitle">Sua plataforma de aplicativos, jogos e tutoriais</p>
          <span class="about-version">Verso 1.0</span>
        </div>

        <div class="about-contact-card">
          <h4 class="about-contact-title"><span></span> Contato e Suporte</h4>
          <div class="about-contact-email">
            <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
            <a href="/cdn-cgi/l/email-ion#0c7c637e786d606b6d61697c60797f4c6b616d6560226f6361"><span class="__cf_email__" data-cfemail="98e8f7eaecf9f4fff9f5fde8f4edebd8fff5f9f1f4b6fbf7f5"><span class="__cf_email__" data-cfemail="99e9f6ebedf8f5fdf0fef0edf8f5f8f6d9fef4f8f0f5b7faf6f4">portaldigitalao@gmail.com</span></span></a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="aboutHelpModal" class="custom-modal">
    <div class="custom-modal-content" style="max-width: 550px; max-height: 85vh; overflow-y: auto;">
      <h2 style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 28px;"></span> Guia Completo do App
      </h2>

      <div class="about-faq-card" style="margin-top: 16px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px;">
        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> O que  o Portal Digital?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">O Portal Digital  uma plataforma onde voc pode encontrar e baixar aplicativos, jogos, tutoriais e muito mais. Nosso objetivo  oferecer contedo de qualidade para todos os usurios.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> Como criar uma conta?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Clique em "Criar Conta" no menu lateral, preencha seu nome, email (apenas Gmail) e senha. Sua conta ficar pendente at ser aprovada por um administrador.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> O que so os pontos?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Pontos so a moeda virtual do Portal Digital. Voc pode ganhar pontos dirios, comprar pontos ou resgatando cdigos. Use os pontos para desbloquear downloads de contedos premium.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> Como baixar um jogo/app?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Clique no card do jogo/app desejado para ver os detalhes. Se tiver pontos suficientes, clique no boto de download. Voc ser redirecionado para o link de download.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> Como funcionam as notificaes?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Voc receber notificaes sobre novos contedos, atualizaes e mensagens importantes. Pode marcar como lida ou apagar as notificaes a qualquer momento.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> Posso comentar nos jogos?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Sim! Usurios com conta verificada podem deixar comentrios em qualquer jogo ou aplicativo. Voc tambm pode apagar seus prprios comentrios.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> Como avaliar um contedo?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Ao abrir um jogo ou aplicativo, voc pode deixar uma avaliao de 1 a 5 estrelas. Sua avaliao ajuda outros usurios a descobrirem os melhores contedos.</p>
        </div>

        <div class="about-faq-item" style="padding: 16px;">
          <h4 class="about-faq-question" style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;"><span></span> Minha conta  segura?</h4>
          <p class="about-faq-answer" style="font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin: 0;">Sim! Utilizamos autenticao segura. Seus dados so protegidos e voc pode alterar sua senha a qualquer momento atravs da opo "Esqueci a senha".</p>
        </div>
      </div>

      <div class="custom-modal-buttons" style="margin-top: 20px;">
        <button class="custom-modal-btn primary" onclick="closeAboutHelpModal()">Entendi</button>
      </div>
    </div>
  </div>

  <div id="manageUsersOverlay" class="manage-users-overlay">
    <div class="manage-users-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeManageUsersModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Gerenciar Usurios</h1>
        <div style="width: 40px;"></div>
      </div>
      <div class="manage-users-filter-tabs">
        <button class="manage-users-filter-btn active" id="filterPending" onclick="filterUsers('pending')">Pendentes</button>
        <button class="manage-users-filter-btn" id="filterApproved" onclick="filterUsers('approved')">Aprovados</button>
        <button class="manage-users-filter-btn" id="filterRejected" onclick="filterUsers('rejected')">Rejeitados</button>
      </div>
      <div id="manageUsersList" class="manage-users-list-container">
        <div class="manage-users-empty">
          <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
          <p>Carregando usurios...</p>
        </div>
      </div>
    </div>
  </div>

  <div id="sendNotificationOverlay" class="send-notification-overlay">
    <div class="send-notification-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeSendNotificationOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Enviar Notificao</h1>
        <div style="width: 40px;"></div>
      </div>
      <form id="sendNotificationForm" onsubmit="handleSendNotification(event)">
        <div class="send-notification-form-container">
          <div class="form-group">
            <label class="form-label">Destinatrio</label>
            <div class="send-notification-target-options">
              <button type="button" class="send-notification-target-btn active" id="targetAllBtn" onclick="selectNotificationTarget('all')">
                <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                Todos
              </button>
              <button type="button" class="send-notification-target-btn" id="targetIndividualBtn" onclick="selectNotificationTarget('individual')">
                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                Usurio
              </button>
            </div>
            <input type="hidden" name="notificationTarget" id="notificationTargetInput" value="all">
            <div id="userSelectorContainer" class="send-notification-user-selector">
              <select class="form-input form-select" id="notificationTargetUser">
                <option value="">Selecione um usurio...</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Ttulo</label>
            <input type="text" class="form-input" id="notificationTitle" placeholder="Digite o ttulo da notificao..." required maxlength="100">
          </div>
          <div class="form-group">
            <label class="form-label">Mensagem</label>
            <textarea class="form-textarea" id="notificationMessage" placeholder="Escreva a mensagem da notificao aqui..." required maxlength="500" rows="5"></textarea>
          </div>
        </div>
        <div class="send-notification-footer">
          <button type="submit" class="send-notification-btn primary" id="sendNotificationSubmitBtn">
            <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            <span id="sendNotificationBtnText">Enviar para Todos</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="notificationsOverlay" class="notifications-overlay">
    <div class="notifications-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeNotificationsOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Notificaes</h1>
        <div style="width: 40px;"></div>
      </div>
      <div id="notificationsList" class="notifications-list-container"></div>
      <div id="notificationsFooter" class="notifications-footer" style="display: none;">
        <button class="notifications-footer-btn" onclick="markAllNotificationsAsRead()" id="markAllReadBtn">
          <svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
          Marcar todas como lidas
        </button>
      </div>
    </div>
  </div>

  <div id="faqModal" class="custom-modal">
    <div class="custom-modal-content" style="max-width: 550px;">
      <h2> Sobre o Portal Digital</h2>
      <div style="max-height: 65vh; overflow-y: auto; padding: 8px 0;">

        <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(156, 39, 176, 0.1) 100%); padding: 16px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
          <h3 style="margin: 0 0 8px 0; color: var(--text-primary);"> Portal Digital</h3>
          <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">Sua plataforma de aplicativos, jogos e tutoriais</p>
          <p style="margin: 8px 0 0 0; font-size: 12px; color: var(--text-muted);">Verso 1.0</p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> O que  o Portal Digital?</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            O Portal Digital  uma plataforma onde voc pode encontrar e baixar aplicativos, jogos, tutoriais e muito mais. Nosso objetivo  oferecer contedo de qualidade para todos os usurios.
          </p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> Como criar uma conta?</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            Clique em "Criar Conta" no menu lateral, preencha seu nome, email (apenas Gmail) e senha. Sua conta ficar pendente at ser aprovada por um administrador.
          </p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> O que so os pontos?</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            Pontos so a moeda virtual do Portal Digital. Voc pode ganhar pontos assistindo anncios ou resgatando cdigos. Use os pontos para desbloquear downloads de contedos premium.
          </p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> Como baixar um jogo/app?</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            Clique no card do jogo/app desejado para ver os detalhes. Se tiver pontos suficientes, clique no boto de download. Voc ser redirecionado para o link de download.
          </p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> Como funcionam as notificaes?</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            Voc receber notificaes sobre novos contedos, atualizaes e mensagens importantes. Pode marcar como lida ou apagar as notificaes a qualquer momento.
          </p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> Posso comentar nos jogos?</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            Sim! Usurios com conta verificada podem deixar comentrios em qualquer jogo ou aplicativo. Voc tambm pode apagar seus prprios comentrios.
          </p>
        </div>

        <div class="faq-item" style="margin-bottom: 16px;">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> Contato e Suporte</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.5;">
            Para dvidas, sugestes ou problemas, entre em contato com os administradores atravs do nosso gmail <strong><a href="/cdn-cgi/l/email-
                ion" class="__cf_email__" data-cfemail="50203f2224313c3439373924313c313f10373d31393c7e333f3d">[<span class="__cf_email__" data-cfemail="d5a5baa7a1b4b9b1bcb2bca1b4b9b4ba95b2b8b4bcb9fbb6bab8">[email&#160;protected]</span>]</a> </strong>  ou aguarde uma notificao com informaes de contato.
          </p>
        </div>

      </div>
      <div class="custom-modal-buttons" style="margin-top: 16px;">
        <button class="custom-modal-btn primary" onclick="closeFaqModal()">Entendi!</button>
      </div>
    </div>
  </div>

  <div id="ratingOverlay" class="rating-overlay">
    <div class="rating-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeRatingOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Avaliar o Aplicativo</h1>
        <div id="ratingHeaderStars" class="rating-header-stars"> 0</div>
      </div>
      <div id="ratingContent" class="rating-main-container">
        
      </div>
    </div>
  </div>

  <div id="ratingConfirmModal" class="custom-modal">
    <div class="custom-modal-content" style="max-width: 400px;">
      <h2> Confirmar Avaliao</h2>
      <p style="color: var(--text-secondary); font-size: 15px; line-height: 1.6; margin: 16px 0;">
        Voc confirma sua avaliao de <strong id="confirmStarsText">0 estrelas</strong> para o aplicativo?
      </p>
      <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 20px;">
         Essa avaliao no poder ser alterada depois.
      </p>
      <div id="bonusPointsInfo" style="display: none; background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(100, 181, 246, 0.15) 100%); padding: 12px; border-radius: 8px; margin-bottom: 16px; text-align: center;">
        <span style="font-size: 14px; color: #2196F3; font-weight: 600;"> Voc receber <span id="bonusPointsAmount">0</span> pontos de bnus!</span>
      </div>
      <div class="custom-modal-buttons">
        <button class="custom-modal-btn primary" onclick="confirmRating()">Confirmar</button>
        <button class="custom-modal-btn secondary" onclick="cancelRatingConfirm()">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="favoritesOverlay" class="favorites-overlay">
    <div class="favorites-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeFavoritesOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Meus Favoritos</h1>
        <div style="width: 40px;"></div>
      </div>
      <div id="favoritesList" class="favorites-list-container"></div>
    </div>
  </div>

  <div id="commentsHelpModal" class="custom-modal">
    <div class="custom-modal-content" style="max-width: 500px;">
      <h2>
        <svg viewBox="0 0 24 24" width="24" height="24" style="fill: #2196F3; vertical-align: middle; margin-right: 8px;"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
     Por Favor
      </h2>
      <div style="max-height: 55vh; overflow-y: auto; padding: 8px 0;">

        <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(100, 181, 246, 0.1) 100%); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
          <h4 style="color: #2196F3; margin: 0 0 12px 0; font-size: 15px;"> O que voc PODE fazer:</h4>
          <ul style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.8;">
            <li>Compartilhar suas opinies sobre o jogo/app</li>
            <li>Ajudar outros usurios com dicas e sugestes</li>
            <li>Fazer perguntas sobre o jogo/aplicativo</li>
            <li>Elogiar ou criticar construtivamente</li>
            <li>Interagir de forma respeitosa com a comunidade</li>
          </ul>
        </div>

        <div style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(233, 30, 99, 0.1) 100%); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
          <h4 style="color: #f44336; margin: 0 0 12px 0; font-size: 15px;"> O que voc NO deve fazer:</h4>
          <ul style="color: var(--text-secondary); margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.8;">
            <li>Spam ou mensagens repetitivas</li>
            <li>Linguagem ofensiva ou palavres</li>
            <li>Contedo discriminatrio ou preconceituoso</li>
            <li>Divulgar links externos ou propaganda</li>
            <li>Informaes pessoais (suas ou de outros)</li>
            <li>Discusses polticas ou religiosas</li>
            <li>Ameaas ou assdio a outros usurios</li>
            <li>Spoilers sem aviso prvio</li>
          </ul>
        </div>

        <div style="background: var(--bg-card); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color);">
          <h4 style="color: var(--text-primary); margin: 0 0 8px 0; font-size: 15px;"> Ateno</h4>
          <p style="color: var(--text-secondary); margin: 0; font-size: 14px; line-height: 1.6;">
            Comentrios que violam estas regras podem ser removidos e o usurio pode ter sua conta suspensa. Mantenha um ambiente saudvel para todos!
          </p>
        </div>

      </div>
      <div class="custom-modal-buttons" style="margin-top: 16px;">
        <button class="custom-modal-btn primary" onclick="closeCommentsHelpModal()">Entendi!</button>
      </div>
    </div>
  </div>

  <div id="reportProblemOverlay" class="report-overlay">
    <div class="report-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeReportProblemOverlay()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Reportar Problema</h1>
        <div style="width: 40px;"></div>
      </div>
      <div class="report-form-container">
        <div class="report-info-box">
          <p>Encontrou um problema em algum jogo ou aplicativo? Nos informe aqui! Cole o link do contedo e descreva o problema detalhadamente.</p>
        </div>
        <form id="reportProblemForm" onsubmit="handleReportProblem(event)">
          <div class="report-form-group">
            <label class="report-form-label">Link do contedo <span style="color: var(--text-muted); font-weight: 400;">(opcional)</span></label>
            <input type="url" class="report-form-input" id="reportLink" placeholder="https://exemplo.com/link-do-jogo">
            <span class="report-form-hint">Cole aqui o link onde voc encontrou o problema (deixe vazio se no for relacionado a um jogo)</span>
          </div>
          <div class="report-form-group" style="margin-top: 20px;">
            <label class="report-form-label">Descrio do problema</label>
            <textarea class="report-form-input report-form-textarea" id="reportDescription" placeholder="Descreva o problema encontrado em detalhes..." required maxlength="1000"></textarea>
            <span class="report-form-hint"><span id="reportCharCount">0</span>/1000 caracteres</span>
          </div>
        </form>
      </div>
      <div class="report-footer">
        <button type="button" class="report-submit-btn" id="submitReportBtn" onclick="document.getElementById('reportProblemForm').requestSubmit()">
          <svg viewBox="0 0 24 24" width="20" height="20"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
          Enviar Report
        </button>
      </div>
    </div>
  </div>

  <div id="reportsOverlay" class="reports-overlay">
    <div class="reports-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeViewReportsModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Reports de Problemas</h1>
        <div style="width: 40px;"></div>
      </div>
      <div class="reports-filter-container">
        <button class="reports-filter-btn active" onclick="filterReports('all')" id="reportFilterAll">Todos</button>
        <button class="reports-filter-btn" onclick="filterReports('pending')" id="reportFilterPending">Pendentes</button>
        <button class="reports-filter-btn" onclick="filterReports('resolved')" id="reportFilterResolved">Resolvidos</button>
      </div>
      <div id="reportsList" class="reports-list-container">
        <div class="reports-empty">
          <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H6v-2h6v2zm3-4H6v-2h9v2zm0-4H6V7h9v2z"/></svg>
          <span class="reports-empty-text">Carregando reports...</span>
        </div>
      </div>
    </div>
  </div>

  <div id="transferOverlay" class="transfer-overlay">
    <div class="transfer-overlay-content">
      <div class="content-header">
        <button class="content-header-btn back-btn" onclick="closeTransferModal()">
          <svg viewBox="0 0 24 24" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <h1 class="content-header-title">Transferir Pontos</h1>
        <div style="width: 40px;"></div>
      </div>

      <form id="transferForm" onsubmit="handleTransfer(event)">
        <div class="transfer-form-container">
          
          <div class="transfer-info-card">
            <div class="transfer-points-display">
              <div class="transfer-points-icon">
                <svg viewBox="0 0 24 24"><path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/></svg>
              </div>
              <div>
                <div class="transfer-points-value" id="transferCurrentPoints">0</div>
                <div class="transfer-points-label">Seus pontos disponveis</div>
              </div>
            </div>
            <div class="transfer-info-text" id="transferMinInfo">
              Como ADM, voc pode transferir pontos para qualquer usurio.
            </div>
          </div>

          <div class="transfer-form-group">
            <label class="transfer-form-label">Tipo de Transferncia</label>
            <div class="transfer-type-selector">
              <label class="transfer-type-option active" id="transferTypeIndividual" onclick="selectTransferType('individual')">
                <input type="radio" name="transferType" value="individual" checked>
                <div class="transfer-type-icon">
                  <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
                <span class="transfer-type-label">Usurio<br>Especfico</span>
              </label>
              <label class="transfer-type-option" id="transferTypeAll" onclick="selectTransferType('all')">
                <input type="radio" name="transferType" value="all">
                <div class="transfer-type-icon">
                  <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                </div>
                <span class="transfer-type-label">Todos os<br>Usurios</span>
              </label>
            </div>
          </div>

          <div id="transferEmailGroup" class="transfer-form-group">
            <label class="transfer-form-label">Email do destinatrio</label>
            <input type="email" class="transfer-form-input" id="transferEmail" placeholder="email@gmail.com">
          </div>

          <div id="transferAllInfo" class="transfer-form-group" style="display: none;">
            <div class="transfer-all-warning">
              <div class="transfer-all-warning-header">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                <strong>Transferncia em Massa</strong>
              </div>
              <p>Os pontos sero enviados para <strong id="totalUsersCount">todos os usurios</strong> registrados no sistema. Esta ao pode levar alguns segundos.</p>
            </div>
          </div>

          <div class="transfer-form-group">
            <label class="transfer-form-label">
              Quantidade de pontos
              <span class="transfer-form-label-hint" id="perUserLabel">(por usurio)</span>
            </label>
            <input type="number" class="transfer-form-input" id="transferAmount" min="1" placeholder="Ex: 50" required>
          </div>
        </div>

        <div class="transfer-submit-footer">
          <button type="button" class="transfer-submit-btn secondary" onclick="closeTransferModal()">
            Cancelar
          </button>
          <button type="submit" class="transfer-submit-btn primary" id="transferSubmitBtn">
            <svg viewBox="0 0 24 24"><path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/></svg>
            Transferir
          </button>
        </div>
      </form>
    </div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    let manualThemeOverride = false;

    function applyTheme() {
      if (manualThemeOverride) return;
      const hour = new Date().getHours();
      if (hour >= 18 || hour < 6) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    }

    function toggleTheme() {
      manualThemeOverride = true;
      document.documentElement.classList.toggle('dark');
    }

    applyTheme();
    setInterval(applyTheme, 60000);

    const PUBLISHER_EMAILS = ['sibemcesar@gmail.com', 'portaldigitalao@gmail.com'];
    let currentUser = null;
    let isPublisher = false;
    let allGames = {};
    let currentFilter = 'all';
    let searchTerm = '';
    let currentPage = 0;
    const gamesPerPage = 8;
    let userPoints = 0;
    let userStatus = 'pending';
    let gamesLoaded = false;
    let userName = '';
    let currentGameData = null;
    let historyData = [];

    function checkUrlForAuth() {
      const urlParams = new URLSearchParams(window.location.search);
      const authParam = urlParams.get('auth');

      if (authParam) {
        showAuthOverlay();
        switch (authParam) {
          case 'login':
            showLoginForm();
            break;
          case 'register':
            showRegisterForm();
            break;
          case 'reset':
            showResetPasswordForm();
            break;
          default:
            authShowWelcome();
            break;
        }
        return true;
      }
      return false;
    }

    window.addEventListener('load', () => {
      const { onAuthStateChanged } = window.firebaseModules;
      const auth = window.firebaseAuth;

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUser = user;
          isPublisher = PUBLISHER_EMAILS.includes(user.email);

          if (!user.isAnonymous) {
            await loadUserData();
          }

          const hasAuthParam = checkUrlForAuth();

          if (!hasAuthParam) {
            closeAuthOverlay();
          }

          updateUIForUser();
          loadGames();
          loadHistory();
        } else {
          const hasAuthParam = checkUrlForAuth();

          if (!hasAuthParam) {
            showAuthOverlay();
          }
        }
      });
    });

    async function loadUserData() {
      if (!currentUser) return;

      const { ref, get, set, update } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const userRef = ref(database, `users/${currentUser.uid}`);
      const snapshot = await get(userRef);

      if (snapshot.exists()) {
        const userData = snapshot.val();
        userPoints = userData.points || 0;
        userStatus = userData.status || 'pending';
        userName = userData.name || '';

        if (!userName && currentUser.displayName) {
          userName = currentUser.displayName;
          await update(userRef, { name: userName });
        }
      } else {
        userPoints = 0;
        userStatus = 'pending';
        userName = currentUser.displayName || '';
        await set(userRef, {
          points: 0,
          status: 'pending',
          name: userName,
          email: currentUser.email,
          createdAt: Date.now()
        });
      }

      if (userStatus === 'rejected') {
        const { signOut } = window.firebaseModules;
        await signOut(window.firebaseAuth);
        showCustomAlert(' Sua conta foi marcada como fraude e foi bloqueada. Entre em contato com o administrador se acredita que isso  um erro.');
        showAuthOverlay();
        return false;
      }

      updatePointsDisplay();
      updateUserInfoDisplay();
      return true;
    }

    function updateUserInfoDisplay() {
    }

    async function loadUserPoints() {
      return await loadUserData();
    }

    async function updateUserPoints(newPoints) {
      if (!currentUser) return;
      console.warn('[SEGURANA] Tentativa de atualizao direta de pontos bloqueada');
      throw new Error('Operao no permitida: Use as funes de transao apropriadas');
    }

    function _syncPointsDisplay(newPoints) {
      userPoints = newPoints;
      updatePointsDisplay();
    }

    function updatePointsDisplay() {
    }

    function updateUIForUser() {
      const loginBtn = document.getElementById('loginBtn');
      const registerBtn = document.getElementById('registerBtn');
      const publishBtn = document.getElementById('publishBtn');
      const manageBtn = document.getElementById('manageBtn');
      const generateCodeBtn = document.getElementById('generateCodeBtn');
      const manageUsersBtn = document.getElementById('manageUsersBtn');
      const sendNotificationBtn = document.getElementById('sendNotificationBtn');
      const viewNotificationsBtn = document.getElementById('viewNotificationsBtn');
      const dailyRewardBtn = document.getElementById('dailyRewardBtn');
      const profileFavoritesBtn = document.getElementById('profileFavoritesBtn');
      const transferBtn = document.getElementById('transferBtn');
      const reportProblemBtn = document.getElementById('reportProblemBtn');
      const viewReportsBtn = document.getElementById('viewReportsBtn');

      if (!currentUser || currentUser.isAnonymous) {
        loginBtn.style.display = 'flex';
        registerBtn.style.display = 'flex';
        publishBtn.style.display = 'none';
        manageBtn.style.display = 'none';
        generateCodeBtn.style.display = 'none';
        manageUsersBtn.style.display = 'none';
        sendNotificationBtn.style.display = 'none';
        viewNotificationsBtn.style.display = 'none';
        dailyRewardBtn.style.display = 'none';
        profileFavoritesBtn.style.display = 'none';
        transferBtn.style.display = 'none';
        reportProblemBtn.style.display = 'none';
        viewReportsBtn.style.display = 'none';
      } else {
        loginBtn.style.display = 'none';
        registerBtn.style.display = 'none';

        if (userStatus === 'approved' || isPublisher) {
          dailyRewardBtn.style.display = 'flex';
          profileFavoritesBtn.style.display = 'flex';
          loadUserFavorites();
          loadUserLikes();
          checkDailyReward();
        } else {
          dailyRewardBtn.style.display = 'none';
          profileFavoritesBtn.style.display = 'none';
        }

        if (isPublisher) {
          transferBtn.style.display = 'flex';
        } else {
          transferBtn.style.display = 'none';
        }

        viewNotificationsBtn.style.display = 'flex';

        if (isPublisher) {
          publishBtn.style.display = 'flex';
          manageBtn.style.display = 'flex';
          generateCodeBtn.style.display = 'flex';
          manageUsersBtn.style.display = 'flex';
          sendNotificationBtn.style.display = 'flex';
          viewReportsBtn.style.display = 'flex';
          reportProblemBtn.style.display = 'none'; // ADMs no precisam reportar
        } else {
          publishBtn.style.display = 'none';
          manageBtn.style.display = 'none';
          generateCodeBtn.style.display = 'none';
          manageUsersBtn.style.display = 'none';
          sendNotificationBtn.style.display = 'none';
          if (userStatus === 'approved') {
            reportProblemBtn.style.display = 'flex';
            viewReportsBtn.style.display = 'flex';
          } else {
            reportProblemBtn.style.display = 'none';
            viewReportsBtn.style.display = 'none';
          }
        }

        updateUserInfoDisplay();
        loadNotifications();

        if (isPublisher || userStatus === 'approved') {
          updateReportsBadge();
        }
      }
    }

    async function loadGames() {
      const { collection, getDocs, onSnapshot, query, orderBy } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      renderSkeletonLoading();

      const gamesRef = collection(firestore, 'games');
      const gamesQuery = query(gamesRef, orderBy('downloads', 'desc'));

      onSnapshot(gamesQuery, async (snapshot) => {
        allGames = {};
        snapshot.forEach((doc) => {
          allGames[doc.id] = doc.data();
        });

        await loadDownloadCounts();

        gamesLoaded = true;
        renderGrid();
        checkUrlForGameId();
      }, (error) => {
        console.error('Erro ao carregar jogos:', error);
        loadGamesOnce();
      });
    }

    async function loadDownloadCounts() {
      try {
        const { collection, getDocs } = window.firebaseModules;
        const firestore = window.firebaseFirestore;
        const downloadsRef = collection(firestore, 'gameDownloads');
        const snapshot = await getDocs(downloadsRef);

        snapshot.forEach((doc) => {
          const gameId = doc.id;
          const downloadCount = doc.data().count || 0;
          if (allGames[gameId]) {
            const existingDownloads = allGames[gameId].downloads || 0;
            allGames[gameId].downloads = Math.max(existingDownloads, downloadCount);
          }
        });
      } catch (error) {
        console.error('Erro ao carregar contagem de downloads:', error);
      }
    }

    async function loadGamesOnce() {
      const { collection, getDocs, query, orderBy } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        const gamesRef = collection(firestore, 'games');
        const gamesQuery = query(gamesRef, orderBy('downloads', 'desc'));
        const snapshot = await getDocs(gamesQuery);

        allGames = {};
        snapshot.forEach((doc) => {
          allGames[doc.id] = doc.data();
        });

        await loadDownloadCounts();

        gamesLoaded = true;
        renderGrid();
        checkUrlForGameId();
      } catch (error) {
        console.error('Erro ao carregar jogos (fallback):', error);
      }
    }

    function loadHistory() {
      try {
        const storage = window['localStorage'];
        const saved = storage.getItem('gamePlusHistory');
        if (saved) {
          historyData = JSON.parse(saved);
        }
      } catch (e) {
        console.error('Erro ao carregar histrico:', e);
        historyData = [];
      }
    }

    function saveHistory() {
      try {
        const storage = window['localStorage'];
        storage.setItem('gamePlusHistory', JSON.stringify(historyData));
      } catch (e) {
        console.error('Erro ao salvar histrico:', e);
      }
    }

    function addToHistory(id) {
      const game = allGames[id];
      if (!game) return;

      historyData = historyData.filter(h => h.id !== id);
      historyData.unshift({
        id: id,
        titulo: game.titulo,
        type: game.type,
        poster: game.poster,
        timestamp: Date.now()
      });

      if (historyData.length > 20) {
        historyData = historyData.slice(0, 20);
      }

      saveHistory();
    }

    function renderSkeletonLoading() {
      const grid = document.getElementById('contentGrid');
      grid.style.display = 'grid';
      grid.innerHTML = '';

      for (let i = 0; i < 4; i++) {
        const skeleton = document.createElement('div');
        skeleton.className = 'skeleton-card';
        skeleton.style.animationDelay = `${i * 0.1}s`;
        skeleton.innerHTML = `
          <div class="skeleton-poster"></div>
          <div class="skeleton-info">
            <div class="skeleton-title"></div>
            <div class="skeleton-genre"></div>
            <div class="skeleton-stats">
              <div class="skeleton-stat"></div>
              <div class="skeleton-stat"></div>
            </div>
          </div>
        `;
        grid.appendChild(skeleton);
      }
    }

    function renderGrid() {
      const grid = document.getElementById('contentGrid');
      const noResults = document.getElementById('noResults');
      const paginationControls = document.getElementById('paginationControls');

      if (!gamesLoaded) {
        renderSkeletonLoading();
        noResults.style.display = 'none';
        paginationControls.style.display = 'none';
        return;
      }

      grid.innerHTML = '';

      let gamesArray = Object.entries(allGames).map(([id, game]) => ({
        id,
        ...game
      }));

      gamesArray.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));

      const filtered = gamesArray.filter((game) => {
        const matchFilter = currentFilter === 'all' || game.type === currentFilter;
        const matchSearch = game.titulo.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           game.genero.toLowerCase().includes(searchTerm.toLowerCase());
        return matchFilter && matchSearch;
      });

      if (filtered.length === 0) {
        grid.style.display = 'none';
        noResults.style.display = 'block';
        paginationControls.style.display = 'none';
        return;
      }

      const totalGames = filtered.length;
      const totalPages = Math.ceil(totalGames / gamesPerPage);

      if (currentPage >= totalPages) {
        currentPage = totalPages - 1;
      }
      if (currentPage < 0) {
        currentPage = 0;
      }

      const startIndex = currentPage * gamesPerPage;
      const endIndex = Math.min(startIndex + gamesPerPage, totalGames);
      const paginatedGames = filtered.slice(startIndex, endIndex);

      updatePaginationUI(startIndex, endIndex, totalGames, totalPages);

      grid.style.display = 'grid';
      noResults.style.display = 'none';

      paginatedGames.forEach((game, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.animationDelay = `${index * 0.05}s`;

        card.addEventListener('click', function() {
          openGameDetail(game.id);
        });

        const typeLabels = {
          aplicativos: 'APLICATIVOS',
          jogos: 'JOGOS',
          tutoriais: 'TUTORIAIS',
          pc: 'PC',
          outros: 'OUTROS'
        };

        card.innerHTML = `
          <div class="card-img-container">
            <img src="${game.poster}" alt="${game.titulo}">
            <div class="card-type">${typeLabels[game.type] || game.type}</div>
          </div>
          <div class="card-info">
            <div class="card-title">${game.titulo}</div>
            <div class="card-meta">
              <span>${game.size || 'N/A'}</span>
              <span></span>
              <span>${game.downloads || 0} downloads</span>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    function updatePaginationUI(startIndex, endIndex, totalGames, totalPages) {
      const paginationControls = document.getElementById('paginationControls');
      const paginationText = document.getElementById('paginationText');
      const prevBtn = document.getElementById('prevPageBtn');
      const nextBtn = document.getElementById('nextPageBtn');

      if (totalGames > gamesPerPage) {
        paginationControls.style.display = 'flex';
        paginationText.textContent = `${startIndex + 1} - ${endIndex} de ${totalGames}`;

        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = currentPage >= totalPages - 1;
      } else {
        paginationControls.style.display = 'none';
      }
    }

    function goToPrevPage() {
      if (currentPage > 0) {
        currentPage--;
        renderGrid();
        document.querySelector('.content-wrapper').scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function goToNextPage() {
      currentPage++;
      renderGrid();
      document.querySelector('.content-wrapper').scrollTo({ top: 0, behavior: 'smooth' });
    }

    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        currentPage = 0; // Reset to first page on filter change
        renderGrid();
      });
    });

    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchTerm = e.target.value;
      currentPage = 0; // Reset to first page on search
      renderGrid();
    });

    document.getElementById('commentInput').addEventListener('input', (e) => {
      const commentBtnRow = document.getElementById('commentBtnRow');
      if (e.target.value.trim().length > 0) {
        commentBtnRow.style.display = 'flex';
      } else {
        commentBtnRow.style.display = 'none';
      }
    });

    async function openGameDetail(id) {
      const game = allGames[id];
      if (!game) return;

      addToHistory(id);
      currentGameData = { ...game, id: id };

      const newUrl = window.location.pathname + '?id=' + id;
      window.history.pushState({ gameId: id }, game.titulo, newUrl);

      document.getElementById('contentHeaderTitle').textContent = game.titulo;
      document.getElementById('modalTitle').textContent = game.titulo;
      document.getElementById('modalMeta').innerHTML = `
        <div class="modal-meta-item">
          <span class="modal-meta-label">Tamanho:</span>
          <span>${game.size}</span>
        </div>
        <div class="modal-meta-item">
          <span class="modal-meta-label">Gnero:</span>
          <span>${game.genero}</span>
        </div>
        <div class="modal-meta-item">
          <span class="modal-meta-label">Downloads:</span>
          <span>${game.downloads || 0}</span>
        </div>
        <div class="modal-meta-item">
          <span class="modal-meta-label">Curtidas:</span>
          <span id="likeCountMeta">0</span>
        </div>
        <div class="modal-meta-item">
          <span class="modal-meta-label">Custo:</span>
          <span>${game.cost || 0} pontos</span>
        </div>
      `;

      document.getElementById('modalDescription').textContent = game.descricao;

      const videoContainer = document.getElementById('videoContainer');
      if (game.videoUrl) {
        const videoId = extractYoutubeId(game.videoUrl);
        if (videoId) {
          videoContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe>`;
          videoContainer.style.display = 'block';
        } else {
          videoContainer.style.display = 'none';
        }
      } else {
        videoContainer.style.display = 'none';
      }

      const cost = game.cost || 0;
      const downloadsInsufficientWarning = document.getElementById('downloadsInsufficientWarning');
      if (currentUser && userPoints < cost) {
        downloadsInsufficientWarning.style.display = 'block';
      } else {
        downloadsInsufficientWarning.style.display = 'none';
      }

      document.getElementById('downloadsCostValue').textContent = cost + ' pontos';

      const downloadContainer = document.getElementById('downloadSectionsContainer');
      let links = [];

      if (game.downloadLinks && game.downloadLinks.length > 0) {
        links = game.downloadLinks;
      } else {
        links = [{
          desc: 'Download',
          linkGA: game.linkGA || '',
          linkADM: game.linkADM || ''
        }];
      }

      downloadContainer.innerHTML = links.map((link, index) => {
        const hasGA = link.linkGA && link.linkGA.trim() !== '';
        const hasADM = link.linkADM && link.linkADM.trim() !== '';

        if (!hasGA && !hasADM) {
          return `
            <div class="download-section">
              <div class="download-section-title">${link.desc || 'Download'}</div>
              <div class="download-section-buttons">
                <span style="color: var(--text-muted); font-size: 14px;">Links no disponveis</span>
              </div>
            </div>
          `;
        }

        return `
          <div class="download-section">
            <div class="download-section-title">${link.desc || 'Download'}</div>
            <div class="download-section-buttons">
              ${hasGA ? `<button class="btn-main download-btn" data-game-id="${id}" data-app-type="GA" data-link-index="${index}" data-cost="${cost}">Baixar </button>` : ''}
              ${hasADM ? `<button class="btn-main download-btn" data-game-id="${id}" data-app-type="ADM" data-link-index="${index}" data-cost="${cost}">Baixar no ADM</button>` : ''}
            </div>
          </div>
        `;
      }).join('');

      window.currentDownloadLinks = links;

      downloadContainer.querySelectorAll('.download-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const gameId = this.dataset.gameId;
          const appType = this.dataset.appType;
          const linkIndex = parseInt(this.dataset.linkIndex);
          const cost = parseInt(this.dataset.cost);
          const linkData = window.currentDownloadLinks[linkIndex];
          const url = appType === 'GA' ? linkData.linkGA : linkData.linkADM;
          downloadGame(gameId, appType, url, cost);
        });
      });

      loadComments(id);

      const commentInputWrapper = document.getElementById('commentInputWrapper');
      if (currentUser && !currentUser.isAnonymous) {
        commentInputWrapper.style.display = 'block';
      } else {
        commentInputWrapper.style.display = 'none';
      }

      await loadGameLikes(id);
      updateLikeButton();
      updateFavoriteButton();

      showGameInfo();
      document.getElementById('overlay').classList.add('active');
    }

    function extractYoutubeId(url) {
      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    async function downloadGame(gameId, appType, url, cost) {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login com uma conta para baixar jogos.');
        return;
      }

      if (userStatus === 'pending') {
        showCustomAlert('Sua conta ainda est aguardando aprovao do administrador. Por favor, aguarde.');
        return;
      }

      if (userPoints < cost) {
        showCustomAlert('Voc no tem pontos suficientes! Resgate um cdigo para obter mais pontos.');
        return;
      }

      if (!url || url.trim() === '') {
        showCustomAlert('Erro: Link de download no disponvel. Por favor, tente o outro boto ou entre em contato com o administrador.');
        return;
      }

      try {
        const { ref, get, update } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const userRef = ref(database, `users/${currentUser.uid}`);
        const userSnapshot = await get(userRef);
        const userData = userSnapshot.val() || {};
        const currentPoints = userData.points || 0;

        if (currentPoints < cost) {
          showCustomAlert('Voc no tem pontos suficientes! Resgate um cdigo para obter mais pontos.');
          return;
        }

        const newPointsTotal = currentPoints - cost;

        const serverTime = await getServerTimestamp();

        const downloadId = `${gameId}_${Date.now()}`;

        const updates = {};
        updates[`users/${currentUser.uid}/points`] = newPointsTotal;
        updates[`downloadClaims/${currentUser.uid}/${downloadId}`] = {
          gameId: gameId,
          appType: appType,
          cost: cost,
          previousPoints: currentPoints,
          newPoints: newPointsTotal,
          downloadedAt: serverTime
        };

        await update(ref(database), updates);

        _syncPointsDisplay(newPointsTotal);

        try {
          const { doc: firestoreDoc, getDoc: fsGetDoc, setDoc } = window.firebaseModules;
          const firestore = window.firebaseFirestore;
          const downloadDocRef = firestoreDoc(firestore, 'gameDownloads', gameId);

          const downloadSnap = await fsGetDoc(downloadDocRef);
          const currentDownloads = downloadSnap.exists() ? (downloadSnap.data().count || 0) : 0;
          await setDoc(downloadDocRef, { count: currentDownloads + 1 }, { merge: true });
          console.log('Download count incrementado para:', gameId, '- Novo valor:', currentDownloads + 1);

          if (allGames[gameId]) {
            allGames[gameId].downloads = currentDownloads + 1;
          }
        } catch (error) {
          console.error('Erro ao incrementar downloads:', error.message || error);
        }

        const downloadWindow = window.open(url, '_blank');

        if (!downloadWindow || downloadWindow.closed || typeof downloadWindow.closed === 'undefined') {
          const tempLink = document.createElement('a');
          tempLink.href = url;
          tempLink.target = '_blank';
          tempLink.rel = 'noopener noreferrer';
          document.body.appendChild(tempLink);
          tempLink.click();
          document.body.removeChild(tempLink);
        }

        setTimeout(function(){
          if (typeof Android !== "undefined" && Android.openApp) {
            Android.openApp(appType);
          }
        }, 200);

        showCustomAlert(`Download iniciado! ${cost} pontos deduzidos. Pontos restantes: ${newPointsTotal}`);

      } catch (error) {
        console.error('[SEGURANA] Erro na transao de download:', error);
        showCustomAlert('Erro ao processar download. Tente novamente.');
      }
    }

    function closeOverlay() {
      document.getElementById('overlay').classList.remove('active');
      document.getElementById('commentsOverlay').classList.remove('active');
      document.getElementById('downloadsOverlay').classList.remove('active');
      document.body.style.overflow = '';
      currentGameData = null;

      const videoContainer = document.getElementById('videoContainer');
      if (videoContainer) {
        videoContainer.innerHTML = '';
        videoContainer.style.display = 'none';
      }

      const newUrl = window.location.pathname;
      window.history.pushState({}, document.title, newUrl);
    }

    function closeModal() {
      closeOverlay();
    }

    function shareContent() {
      if (!currentGameData) return;

      const shareUrl = window.location.href;

      if (navigator.share) {
        navigator.share({
          title: currentGameData.titulo,
          text: `Confira ${currentGameData.titulo} no Portal Digital!`,
          url: shareUrl
        }).catch(err => {
          copyToClipboard(shareUrl);
        });
      } else {
        copyToClipboard(shareUrl);
      }
    }

    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showCustomAlert('Link copiado! Agora voc pode compartilhar.');
        }).catch(() => {
          fallbackCopyToClipboard(text);
        });
      } else {
        fallbackCopyToClipboard(text);
      }
    }

    function fallbackCopyToClipboard(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-9999px';
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        showCustomAlert('Link copiado! Agora voc pode compartilhar.');
      } catch (err) {
        showCustomAlert('Erro ao copiar link.');
      }
      document.body.removeChild(textArea);
    }

    function checkUrlForGameId() {
      const urlParams = new URLSearchParams(window.location.search);
      const gameId = urlParams.get('id');

      if (gameId && allGames[gameId]) {
        openGameDetail(gameId);
      }
    }

    function showGameInfo() {
      document.getElementById('gameInfo').classList.add('active');
      updateFooterActive('info');
    }

    function showComments() {
      document.getElementById('commentsOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      updateFooterActive('comments');
    }

    function closeCommentsOverlay(event) {
      if (event && event.target !== event.currentTarget) return;
      document.getElementById('commentsOverlay').classList.remove('active');
      document.body.style.overflow = '';
      updateFooterActive('info');
    }

    function showDownloads() {
      document.getElementById('downloadsOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      updateFooterActive('downloads');
    }

    function closeDownloadsOverlay(event) {
      if (event && event.target !== event.currentTarget) return;
      document.getElementById('downloadsOverlay').classList.remove('active');
      document.body.style.overflow = '';
      updateFooterActive('info');
    }

    async function loadComments(gameId) {
      const { ref, onValue } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const commentsRef = ref(database, `comments/${gameId}`);
      onValue(commentsRef, (snapshot) => {
        const comments = snapshot.val() || {};
        renderComments(comments);
      });
    }

    function renderComments(comments) {
      const commentsList = document.getElementById('commentsList');

      const commentsArray = Object.entries(comments).map(([id, comment]) => ({
        id,
        ...comment
      })).sort((a, b) => a.timestamp - b.timestamp);

      if (commentsArray.length === 0) {
        commentsList.innerHTML = `
          <div class="no-comments-msg">
            <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
            <p>Nenhum comentrio ainda.</p>
            <p style="font-size: 12px; opacity: 0.7;">Seja o primeiro a comentar!</p>
          </div>
        `;
        return;
      }

      const currentUserId = currentUser ? currentUser.uid : null;

      commentsList.innerHTML = commentsArray.map(comment => {
        const authorDisplayName = comment.authorName || comment.authorEmail.split('@')[0];
        const isAuthor = currentUserId && comment.authorId === currentUserId;
        const ownCommentClass = isAuthor ? ' own-comment' : '';
        const deleteBtn = isAuthor ? `<button class="comment-delete-btn" onclick="deleteComment('${currentGameData.id}', '${comment.id}')" title="Apagar"><svg viewBox="0 0 24 24" width="24" height="24">
  <path fill="#808080" d="M3 6h18v2H3V6zm2 3h14l-1.5 12.5c-.1.8-.8 1.5-1.6 1.5H8.1c-.8 0-1.5-.7-1.6-1.5L5 9zm5 2v9h2v-9h-2zm4 0v9h2v-9h-2zM9 4V2h6v2h5v2H4V4h5z"/>
</svg></button>` : '';

        return `
          <div class="comment-item${ownCommentClass}">
            <div class="comment-header">
              <div class="comment-author">${authorDisplayName}</div>
              ${deleteBtn}
            </div>
            <div class="comment-text">${comment.text}</div>
            <div class="comment-time">${formatTimeAgo(comment.timestamp)}</div>
          </div>
        `;
      }).join('');

      commentsList.scrollTop = commentsList.scrollHeight;
    }

    async function deleteComment(gameId, commentId) {
      showCustomConfirm('Deseja apagar este comentrio?', async () => {
        try {
          const { ref, remove } = window.firebaseModules;
          const database = window.firebaseDatabase;

          await remove(ref(database, `comments/${gameId}/${commentId}`));
          showCustomAlert('Comentrio apagado!');
        } catch (error) {
          showCustomAlert('Erro ao apagar comentrio: ' + error.message);
        }
      });
    }

    async function postComment() {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login com uma conta para comentar.');
        return;
      }

      if (userStatus === 'pending') {
        showCustomAlert('Sua conta ainda est aguardando aprovao do administrador. Por favor, aguarde.');
        return;
      }

      if (!currentGameData) return;

      const commentInput = document.getElementById('commentInput');
      const text = commentInput.value.trim();

      if (!text) {
        showCustomAlert('Digite um comentrio antes de enviar.');
        return;
      }

      const { ref, push, set } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const commentData = {
        text: text,
        authorName: userName || currentUser.email.split('@')[0],
        authorEmail: currentUser.email,
        authorId: currentUser.uid,
        timestamp: Date.now()
      };

      const commentsRef = ref(database, `comments/${currentGameData.id}`);
      const newCommentRef = push(commentsRef);
      await set(newCommentRef, commentData);

      commentInput.value = '';
      document.getElementById('commentBtnRow').style.display = 'none';
      showCustomAlert('Comentrio publicado!');
    }

    function formatTimeAgo(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);

      if (minutes < 1) return 'Agora mesmo';
      if (minutes < 60) return `${minutes} min atrs`;
      if (hours < 24) return `${hours}h atrs`;
      return `${days}d atrs`;
    }

    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      showAuthLoading('A entrar...', 'Verificando credenciais');

      try {
        const { signInWithEmailAndPassword } = window.firebaseModules;
        await signInWithEmailAndPassword(window.firebaseAuth, email, password);

        document.getElementById('authLoadingText').textContent = 'Bem-vindo!';
        document.getElementById('authLoadingSubtext').textContent = 'Carregando seus dados...';

        await new Promise(resolve => setTimeout(resolve, 800));

        hideAuthLoading();
        closeLoginModal();
        closeAuthOverlay();
      } catch (error) {
        hideAuthLoading();
        showCustomAlert('Erro ao fazer login: ' + error.message);
      }
    }

    async function logout() {
      showCustomConfirm('Deseja realmente sair?', async () => {
        try {
          const { signOut } = window.firebaseModules;
          await signOut(window.firebaseAuth);

          currentUser = null;
          isPublisher = false;
          userPoints = 0;
          userStatus = 'pending';
          userName = '';

          showAuthOverlay();
        } catch (error) {
          showCustomAlert('Erro ao sair: ' + error.message);
        }
      });
    }

    async function handlePublish(e) {
      e.preventDefault();

      if (!isPublisher) {
        showCustomAlert('Apenas publicadores autorizados podem publicar jogos.');
        return;
      }

      const downloadLinks = getDownloadLinksData();

      if (downloadLinks.length === 0) {
        showCustomAlert('Por favor, adicione pelo menos um link de download.');
        return;
      }

      const editId = document.getElementById('editGameId').value;
      const gameData = {
        type: document.getElementById('gameType').value,
        titulo: document.getElementById('gameTitle').value,
        genero: document.getElementById('gameGenre').value,
        size: document.getElementById('gameSize').value,
        descricao: document.getElementById('gameDescription').value,
        poster: document.getElementById('gamePoster').value,
        videoUrl: document.getElementById('gameVideo').value || '',
        downloadLinks: downloadLinks, // New: Array of download links
        linkGA: downloadLinks[0]?.linkGA || '',
        linkADM: downloadLinks[0]?.linkADM || '',
        cost: parseInt(document.getElementById('gameCost').value),
        authorId: currentUser.uid,
        authorEmail: currentUser.email,
        createdAt: Date.now(),
        downloads: 0
      };

      try {
        const { collection, doc, setDoc, addDoc } = window.firebaseModules;
        const firestore = window.firebaseFirestore;

        if (editId) {
          const existingGame = allGames[editId];
          gameData.downloads = existingGame.downloads || 0;
          await setDoc(doc(firestore, 'games', editId), gameData);
          showCustomAlert('Jogo atualizado com sucesso!');
        } else {
          await addDoc(collection(firestore, 'games'), gameData);
          showCustomAlert('Jogo publicado com sucesso!');
        }

        closePublishModal();
        document.getElementById('publishForm').reset();
        document.getElementById('editGameId').value = '';
      } catch (error) {
        console.error('Erro completo:', error);
        showCustomAlert('Erro ao publicar: ' + error.message);
      }
    }

    async function openManageModal() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem gerenciar jogos.');
        return;
      }

      const manageList = document.getElementById('manageGamesList');
      manageList.innerHTML = '<div class="manage-empty-state"><div class="icon"></div><p>Carregando...</p></div>';

      document.getElementById('manageOverlay').classList.add('active');

      const userGames = Object.entries(allGames).filter(([id, game]) => game.authorId === currentUser.uid);

      if (userGames.length === 0) {
        manageList.innerHTML = '<div class="manage-empty-state"><div class="icon"></div><p>Voc ainda no publicou nenhum jogo.</p></div>';
        return;
      }

      manageList.innerHTML = userGames.map(([id, game]) => `
        <div class="manage-game-card">
          <h3>${game.titulo}</h3>
          <p>${game.genero}  ${game.size}  ${game.downloads || 0} downloads</p>
          <div class="manage-game-actions">
            <button class="action-btn edit" onclick="editGame('${id}')">Editar</button>
            <button class="action-btn delete" onclick="deleteGame('${id}')">Apagar</button>
          </div>
        </div>
      `).join('');
    }

    function editGame(id) {
      const game = allGames[id];
      if (!game) return;

      closeManageModal();

      document.getElementById('publishModalTitle').textContent = 'Editar Jogo';
      document.getElementById('editGameId').value = id;
      document.getElementById('gameType').value = game.type;
      document.getElementById('gameTitle').value = game.titulo;
      document.getElementById('gameGenre').value = game.genero;
      document.getElementById('gameSize').value = game.size;
      document.getElementById('gameDescription').value = game.descricao;
      document.getElementById('gamePoster').value = game.poster;
      document.getElementById('gameVideo').value = game.videoUrl || '';
      document.getElementById('gameCost').value = game.cost;

      if (game.downloadLinks && game.downloadLinks.length > 0) {
        setDownloadLinksData(game.downloadLinks);
      } else {
        setDownloadLinksData([{
          desc: 'Download Principal',
          linkGA: game.linkGA || '',
          linkADM: game.linkADM || ''
        }]);
      }

      document.getElementById('publishOverlay').classList.add('active');
    }

    async function deleteGame(id) {
      showCustomConfirm('Deseja realmente apagar este jogo?', async () => {
        try {
          const { doc, deleteDoc } = window.firebaseModules;
          const firestore = window.firebaseFirestore;
          await deleteDoc(doc(firestore, 'games', id));
          showCustomAlert('Jogo apagado com sucesso!');
          openManageModal();
        } catch (error) {
          showCustomAlert('Erro ao apagar: ' + error.message);
        }
      });
    }

    async function generateCode() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem gerar cdigos.');
        return;
      }

      const points = parseInt(document.getElementById('codePoints').value);
      if (points < 1) {
        showCustomAlert('Digite uma quantidade vlida de pontos.');
        return;
      }

      const { ref, set, push } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const codeData = {
        points: points,
        createdBy: currentUser.uid,
        createdAt: Date.now(),
        used: false
      };

      const codesRef = ref(database, 'codes');
      const newCodeRef = push(codesRef);
      await set(newCodeRef, codeData);

      const codeId = newCodeRef.key;
      document.getElementById('codeDisplay').textContent = codeId;
      document.getElementById('generatedCodeResult').classList.add('active');
    }

    async function redeemCode() {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login com uma conta para resgatar cdigos.');
        return;
      }

      if (userStatus === 'pending') {
        showCustomAlert('Sua conta ainda est aguardando aprovao do administrador. Por favor, aguarde.');
        return;
      }

      const code = document.getElementById('redeemCodeInput').value.trim();
      if (!code) {
        showCustomAlert('Digite um cdigo.');
        return;
      }

      const { ref, get, update } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const codeRef = ref(database, `codes/${code}`);
        const codeSnapshot = await get(codeRef);

        if (!codeSnapshot.exists()) {
          showCustomAlert('Cdigo invlido.');
          return;
        }

        const codeData = codeSnapshot.val();
        if (codeData.used) {
          showCustomAlert('Este cdigo j foi usado.');
          return;
        }

        const redemptionRef = ref(database, `codeRedemptions/${currentUser.uid}/${code}`);
        const redemptionSnapshot = await get(redemptionRef);
        if (redemptionSnapshot.exists()) {
          showCustomAlert('Voc j resgatou este cdigo.');
          return;
        }

        const userRef = ref(database, `users/${currentUser.uid}`);
        const userSnapshot = await get(userRef);
        const userData = userSnapshot.val() || {};
        const currentPoints = userData.points || 0;
        const codePoints = codeData.points;
        const newPointsTotal = currentPoints + codePoints;

        const serverTime = await getServerTimestamp();

        const updates = {};
        updates[`codeRedemptions/${currentUser.uid}/${code}`] = {
          redeemedAt: serverTime,
          pointsAwarded: codePoints,
          newPointsTotal: newPointsTotal
        };
        updates[`codes/${code}/used`] = true;
        updates[`codes/${code}/usedBy`] = currentUser.uid;
        updates[`codes/${code}/usedAt`] = serverTime;
        updates[`users/${currentUser.uid}/points`] = newPointsTotal;

        await update(ref(database), updates);

        _syncPointsDisplay(newPointsTotal);

        document.getElementById('redeemCodeInput').value = '';
        showCustomAlert(`Cdigo resgatado! Voc ganhou ${codePoints} pontos.`);
        closeRedeemCodeModal();

      } catch (error) {
        console.error('[SEGURANA] Erro na transao de resgate de cdigo:', error);
        showCustomAlert('Erro ao resgatar cdigo. Tente novamente.');
      }
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
    }

    document.addEventListener('click', function(event) {
      const sidebar = document.getElementById('sidebar');
      const menuBtn = document.querySelector('.menu-btn');

      if (sidebar.classList.contains('open')) {
        if (!sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
          closeSidebar();
        }
      }
    });

    function toggleSearch() {
      const box = document.getElementById('search-container');
      box.style.display = box.style.display === 'none' || box.style.display === '' ? 'flex' : 'none';
    }

    function toggleCatalogs() {
      const box = document.getElementById('filter-tabs');
      box.style.display = box.style.display === 'none' || box.style.display === '' ? 'flex' : 'none';
    }

    function showAuthLoading(text = 'A entrar...', subtext = 'Por favor aguarde') {
      document.getElementById('authLoadingText').textContent = text;
      document.getElementById('authLoadingSubtext').textContent = subtext;
      document.getElementById('authLoadingOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function hideAuthLoading() {
      document.getElementById('authLoadingOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function showAuthOverlay() {
      document.getElementById('authOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      authShowWelcome();
    }

    function closeAuthOverlay() {
      document.getElementById('authOverlay').classList.remove('active');
      document.body.style.overflow = '';
      clearAuthUrlParam();
    }

    function clearAuthUrlParam() {
      const url = new URL(window.location.href);
      if (url.searchParams.has('auth')) {
        url.searchParams.delete('auth');
        window.history.replaceState({}, '', url.pathname + (url.search || ''));
      }
    }

    function authShowWelcome() {
      hideAllAuthForms();
      document.getElementById('authWelcomeScreen').classList.add('active');
      document.getElementById('authHeaderTitle').textContent = 'Bem-vindo';
      document.getElementById('authBackBtn').style.visibility = 'hidden';
    }

    function hideAllAuthForms() {
      document.getElementById('authWelcomeScreen').classList.remove('active');
      document.getElementById('authLoginForm').classList.remove('active');
      document.getElementById('authRegisterForm').classList.remove('active');
      document.getElementById('authResetForm').classList.remove('active');
    }

    function showLoginForm() {
      hideAllAuthForms();
      document.getElementById('authLoginForm').classList.add('active');
      document.getElementById('authHeaderTitle').textContent = 'Entrar';
      document.getElementById('authBackBtn').style.visibility = 'visible';
    }

    function showRegisterForm() {
      hideAllAuthForms();
      document.getElementById('authRegisterForm').classList.add('active');
      document.getElementById('authHeaderTitle').textContent = 'Criar Conta';
      document.getElementById('authBackBtn').style.visibility = 'visible';
    }

    function showResetPasswordForm() {
      hideAllAuthForms();
      document.getElementById('authResetForm').classList.add('active');
      document.getElementById('authHeaderTitle').textContent = 'Redefinir Senha';
      document.getElementById('authBackBtn').style.visibility = 'visible';
    }

    function authGoBack() {
      const resetForm = document.getElementById('authResetForm');
      if (resetForm.classList.contains('active')) {
        showLoginForm();
      } else {
        authShowWelcome();
      }
    }

    async function enterAsVisitor() {
      showAuthLoading('Modo Visitante', 'A preparar o catlogo...');

      try {
        const { signInAnonymously } = window.firebaseModules;
        await signInAnonymously(window.firebaseAuth);

        await new Promise(resolve => setTimeout(resolve, 500));

        hideAuthLoading();
        closeAuthOverlay();
      } catch (error) {
        hideAuthLoading();
        console.error('Erro no login annimo:', error);
        showCustomAlert('Erro ao conectar. Tente novamente.');
      }
    }

    async function handleResetPasswordFromOverlay(e) {
      e.preventDefault();
      const email = document.getElementById('resetEmailOverlay').value;

      try {
        const { sendPasswordResetEmail } = window.firebaseModules;
        await sendPasswordResetEmail(window.firebaseAuth, email);
        showCustomAlert('Link de redefinio enviado para seu email!');
        showLoginForm();
      } catch (error) {
        showCustomAlert('Erro ao enviar email: ' + error.message);
      }
    }

    function openLoginModal() {
      closeSidebar();
      showAuthOverlay();
      showLoginForm();
    }

    function closeLoginModal() {
      closeAuthOverlay();
    }

    function openRegisterModal() {
      closeSidebar();
      showAuthOverlay();
      showRegisterForm();
    }

    function closeRegisterModal() {
      closeAuthOverlay();
    }

    let verificationCheckInterval = null;

    function showEmailVerificationOptions(email) {
      const container = document.getElementById('emailVerificationContent');
      container.innerHTML = `
        <div style="text-align: center; padding: 16px 0;">
          <div style="font-size: 48px; margin-bottom: 16px;"></div>
          <p style="color: var(--text-primary); font-size: 16px; font-weight: 600; margin-bottom: 8px;">
            Conta criada com sucesso!
          </p>
          <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
            Sua conta est aguardando aprovao do administrador.
          </p>

          <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(33, 150, 243, 0.15) 100%); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
            <p style="color: var(--text-primary); font-size: 14px; margin-bottom: 12px;">
              <strong> Quer verificar sua conta agora?</strong>
            </p>
            <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 8px;">
              Enviaremos um link de verificao para seu email.
            </p>
            <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 16px;">
               Verificao por email: +10 pontos<br>
               Aprovao pelo ADM: +100 pontos
            </p>
            <button class="custom-modal-btn primary" onclick="sendVerificationLink()" style="width: 100%;">
               Enviar Link de Verificao
            </button>
          </div>

          <div class="custom-modal-buttons" style="margin-top: 16px;">
            <button class="custom-modal-btn secondary" onclick="closeEmailVerificationModal()">Aguardar Aprovao do ADM</button>
          </div>
        </div>
      `;
      document.getElementById('emailVerificationModal').classList.add('active');
    }

    async function sendVerificationLink() {
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user) {
        showCustomAlert('Erro: usurio no encontrado.');
        return;
      }

      const container = document.getElementById('emailVerificationContent');
      container.innerHTML = `
        <div style="text-align: center; padding: 20px 0;">
          <div style="font-size: 32px; margin-bottom: 16px;"></div>
          <p style="color: var(--text-secondary);">Enviando link de verificao...</p>
        </div>
      `;

      try {
        const { sendEmailVerification } = window.firebaseModules;
        await sendEmailVerification(user);

        showVerificationLinkSent(user.email);

      } catch (error) {
        console.error('Erro ao enviar email:', error);
        let errorMsg = 'Erro ao enviar email de verificao.';
        if (error.code === 'auth/too-many-requests') {
          errorMsg = 'Muitas tentativas. Aguarde alguns minutos e tente novamente.';
        }
        container.innerHTML = `
          <div style="text-align: center; padding: 20px 0;">
            <div style="font-size: 48px; margin-bottom: 16px;"></div>
            <p style="color: var(--text-primary); font-size: 15px; margin-bottom: 16px;">${errorMsg}</p>
            <div class="custom-modal-buttons">
              <button class="custom-modal-btn primary" onclick="sendVerificationLink()">Tentar Novamente</button>
              <button class="custom-modal-btn secondary" onclick="closeEmailVerificationModal()">Fechar</button>
            </div>
          </div>
        `;
      }
    }

    function showVerificationLinkSent(email) {
      const container = document.getElementById('emailVerificationContent');
      container.innerHTML = `
        <div style="text-align: center; padding: 16px 0;">
          <div style="font-size: 48px; margin-bottom: 16px;"></div>
          <p style="color: var(--text-primary); font-size: 16px; font-weight: 600; margin-bottom: 8px;">
            Email Enviado!
          </p>
          <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
            Enviamos um link de verificao para:<br>
            <strong style="color: var(--text-primary);">${email}</strong>
          </p>

          <div style="background: var(--bg-card); padding: 16px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 16px;">
            <p style="color: var(--text-primary); font-size: 14px; font-weight: 600; margin-bottom: 8px;">
               Instrues:
            </p>
            <ol style="color: var(--text-secondary); font-size: 13px; text-align: left; padding-left: 20px; margin: 0;">
              <li style="margin-bottom: 6px;">Abra seu email (verifique tambm a pasta de spam)</li>
              <li style="margin-bottom: 6px;">Clique no link de verificao do Firebase</li>
              <li style="margin-bottom: 6px;">Volte aqui e clique em "J Verifiquei"</li>
            </ol>
          </div>

          <button class="custom-modal-btn primary" onclick="checkEmailVerification()" style="width: 100%; margin-bottom: 12px;" id="verifyCheckBtn">
             J Verifiquei meu Email
          </button>

          <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 12px;">
            No recebeu o email?
          </p>
          <button class="custom-modal-btn secondary" onclick="resendVerificationLink()" id="resendEmailBtn" style="font-size: 13px;">
             Reenviar Email
          </button>

          <div style="margin-top: 16px; border-top: 1px solid var(--border-color); padding-top: 16px;">
            <button class="custom-modal-btn secondary" onclick="closeEmailVerificationModal()" style="font-size: 13px;">
              Verificar Depois
            </button>
          </div>
        </div>
      `;
    }

    async function resendVerificationLink() {
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user) {
        showCustomAlert('Erro: usurio no encontrado. Faa login novamente.');
        return;
      }

      const btn = document.getElementById('resendEmailBtn');
      if (btn) {
        btn.disabled = true;
        btn.textContent = 'Enviando...';
      }

      try {
        const { sendEmailVerification } = window.firebaseModules;
        await sendEmailVerification(user);
        showCustomAlert('Email de verificao reenviado! Verifique sua caixa de entrada.');
        if (btn) {
          btn.textContent = 'Email Reenviado ';
          setTimeout(() => {
            btn.disabled = false;
            btn.textContent = ' Reenviar Email';
          }, 30000);
        }
      } catch (error) {
        console.error('Erro ao reenviar email:', error);
        if (error.code === 'auth/too-many-requests') {
          showCustomAlert('Muitas tentativas. Aguarde alguns minutos.');
        } else {
          showCustomAlert('Erro ao reenviar email. Tente novamente.');
        }
        if (btn) {
          btn.disabled = false;
          btn.textContent = ' Reenviar Email';
        }
      }
    }

    async function checkEmailVerification() {
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user) {
        showCustomAlert('Erro: usurio no encontrado. Faa login novamente.');
        return;
      }

      const btn = document.getElementById('verifyCheckBtn');
      if (btn) {
        btn.disabled = true;
        btn.textContent = 'Verificando...';
      }

      try {
        await user.reload();

        if (user.emailVerified) {
          await approveAccountAfterEmailVerification();
        } else {
          showCustomAlert('Email ainda no verificado. Clique no link enviado para seu email e tente novamente.');
          if (btn) {
            btn.disabled = false;
            btn.textContent = ' J Verifiquei meu Email';
          }
        }
      } catch (error) {
        console.error('Erro ao verificar:', error);
        showCustomAlert('Erro ao verificar. Tente novamente.');
        if (btn) {
          btn.disabled = false;
          btn.textContent = ' J Verifiquei meu Email';
        }
      }
    }

    async function approveAccountAfterEmailVerification() {
      const auth = window.firebaseAuth;
      const user = auth.currentUser;
      const { ref, update, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        await user.getIdToken(true);

        const userRef = ref(database, `users/${user.uid}`);
        const snapshot = await get(userRef);
        const userData = snapshot.val() || {};
        const currentPoints = userData.points || 0;

        const bonusRef = ref(database, `emailVerificationBonus/${user.uid}`);
        const bonusSnapshot = await get(bonusRef);
        const bonusAlreadyClaimed = bonusSnapshot.exists();

        let bonusPoints = 0;
        const serverTime = await getServerTimestamp();

        if (!bonusAlreadyClaimed) {
          try {
            const newPointsTotal = currentPoints + 10;

            const updates = {};
            updates[`emailVerificationBonus/${user.uid}`] = {
              claimedAt: serverTime,
              pointsAwarded: 10,
              newPointsTotal: newPointsTotal
            };
            updates[`users/${user.uid}/points`] = newPointsTotal;
            updates[`users/${user.uid}/status`] = 'approved';
            updates[`users/${user.uid}/emailVerified`] = true;
            updates[`users/${user.uid}/verifiedAt`] = serverTime;
            updates[`users/${user.uid}/verifiedBy`] = 'email';

            await update(ref(database), updates);
            bonusPoints = 10;

          } catch (bonusError) {
            console.log('[SEGURANA] Bonus j foi reivindicado ou validao falhou:', bonusError);
            await update(ref(database, `users/${user.uid}`), {
              status: 'approved',
              emailVerified: true,
              verifiedAt: serverTime,
              verifiedBy: 'email'
            });
          }
        } else {
          await update(ref(database, `users/${user.uid}`), {
            status: 'approved',
            emailVerified: true,
            verifiedAt: serverTime,
            verifiedBy: 'email'
          });
        }

        userStatus = 'approved';
        _syncPointsDisplay(currentPoints + bonusPoints);

        updateUIForUser();
        updateUserInfoDisplay();

        const container = document.getElementById('emailVerificationContent');
        const bonusMessage = bonusPoints > 0
          ? `<div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(100, 181, 246, 0.15) 100%); padding: 12px; border-radius: 8px; margin-bottom: 20px;">
              <span style="font-size: 15px; color: #2196F3; font-weight: 600;"> Voc ganhou 10 pontos de bnus!</span>
            </div>`
          : '';

        container.innerHTML = `
          <div style="text-align: center; padding: 20px 0;">
            <div style="font-size: 64px; margin-bottom: 16px;"></div>
            <p style="color: var(--text-primary); font-size: 18px; font-weight: 600; margin-bottom: 8px;">
              Conta Verificada!
            </p>
            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">
              Seu email foi verificado e sua conta est ativa!
            </p>
            ${bonusMessage}
            <div class="custom-modal-buttons">
              <button class="custom-modal-btn primary" onclick="closeEmailVerificationModal()">Comear a Usar</button>
            </div>
          </div>
        `;

      } catch (error) {
        console.error('Erro ao aprovar conta:', error);
        showCustomAlert('Email verificado, mas houve um erro ao ativar sua conta. Entre em contato com o suporte.');
      }
    }

    function closeEmailVerificationModal() {
      document.getElementById('emailVerificationModal').classList.remove('active');
      if (verificationCheckInterval) {
        clearInterval(verificationCheckInterval);
        verificationCheckInterval = null;
      }
    }

    function showVerifyEmailOption() {
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user || user.isAnonymous || userStatus !== 'pending') {
        return;
      }

      if (user.emailVerified) {
        approveAccountAfterEmailVerification();
        return;
      }

      showEmailVerificationOptions(user.email);
    }

    async function handleRegister(e) {
      e.preventDefault();

      const name = document.getElementById('registerName').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

      if (!email.endsWith('@gmail.com')) {
        showCustomAlert('Por favor, use um email do Gmail (@gmail.com).');
        return;
      }

      if (password !== passwordConfirm) {
        showCustomAlert('As senhas no coincidem.');
        return;
      }

      showAuthLoading('A criar conta...', 'Preparando tudo para voc');

      try {
        const { createUserWithEmailAndPassword, updateProfile } = window.firebaseModules;
        const { ref, set } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const userCredential = await createUserWithEmailAndPassword(window.firebaseAuth, email, password);
        const user = userCredential.user;

        document.getElementById('authLoadingText').textContent = 'Configurando perfil...';
        document.getElementById('authLoadingSubtext').textContent = 'Quase pronto!';

        await updateProfile(user, { displayName: name });

        await set(ref(database, `users/${user.uid}`), {
          name: name,
          email: email,
          points: 0,
          status: 'pending',
          createdAt: Date.now()
        });

        userName = name;
        userStatus = 'pending';
        userPoints = 0;
        currentUser = user;
        isPublisher = PUBLISHER_EMAILS.includes(email);

        document.getElementById('authLoadingText').textContent = 'Conta criada!';
        document.getElementById('authLoadingSubtext').textContent = 'Bem-vindo, ' + name + '!';

        await new Promise(resolve => setTimeout(resolve, 1000));

        hideAuthLoading();
        closeRegisterModal();
        closeAuthOverlay();
        updateUIForUser();
        updateUserInfoDisplay();
        updatePointsDisplay();

        showEmailVerificationOptions(email);
      } catch (error) {
        hideAuthLoading();
        let errorMessage = 'Erro ao criar conta: ';
        switch (error.code) {
          case 'auth/email-already-in-use':
            errorMessage += 'Este email j est em uso.';
            break;
          case 'auth/weak-password':
            errorMessage += 'A senha deve ter pelo menos 6 caracteres.';
            break;
          case 'auth/invalid-email':
            errorMessage += 'Email invlido.';
            break;
          default:
            errorMessage += error.message;
        }
        showCustomAlert(errorMessage);
      }
    }

    let downloadLinksCount = 1;

    function openPublishModal() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem publicar jogos.');
        return;
      }
      document.getElementById('publishModalTitle').textContent = 'Publicar Jogo';
      document.getElementById('editGameId').value = '';
      resetDownloadLinks();
      document.getElementById('publishOverlay').classList.add('active');
    }

    function closePublishModal() {
      document.getElementById('publishOverlay').classList.remove('active');
      document.getElementById('publishForm').reset();
      document.getElementById('editGameId').value = '';
      resetDownloadLinks();
    }

    function resetDownloadLinks() {
      downloadLinksCount = 1;
      const container = document.getElementById('downloadLinksContainer');
      container.innerHTML = `
        <div class="download-link-group" data-link-index="1">
          <div class="download-link-header">
            <span class="download-link-number">Link 1</span>
            <button type="button" class="remove-link-btn" onclick="removeDownloadLink(1)" style="display: none;"></button>
          </div>
          <input type="text" class="form-input" placeholder="Descrio (ex: Jogo Principal, Emulador, ISO...)" id="linkDesc1" required>
          <div style="display: flex; gap: 8px; margin-top: 8px;">
            <input type="url" class="form-input" placeholder="Link G.A" id="linkGA1" required style="flex: 1;">
            <input type="url" class="form-input" placeholder="Link ADM" id="linkADM1" required style="flex: 1;">
          </div>
        </div>
      `;
    }

    function addDownloadLink() {
      downloadLinksCount++;
      const container = document.getElementById('downloadLinksContainer');

      const newLinkHTML = `
        <div class="download-link-group" data-link-index="${downloadLinksCount}">
          <div class="download-link-header">
            <span class="download-link-number">Link ${downloadLinksCount}</span>
            <button type="button" class="remove-link-btn" onclick="removeDownloadLink(${downloadLinksCount})"></button>
          </div>
          <input type="text" class="form-input" placeholder="Descrio (ex: Emulador, ISO, DLC...)" id="linkDesc${downloadLinksCount}" required>
          <div style="display: flex; gap: 8px; margin-top: 8px;">
            <input type="url" class="form-input" placeholder="Link G.A" id="linkGA${downloadLinksCount}" required style="flex: 1;">
            <input type="url" class="form-input" placeholder="Link ADM" id="linkADM${downloadLinksCount}" required style="flex: 1;">
          </div>
        </div>
      `;

      container.insertAdjacentHTML('beforeend', newLinkHTML);

      if (downloadLinksCount > 1) {
        const firstRemoveBtn = container.querySelector('[data-link-index="1"] .remove-link-btn');
        if (firstRemoveBtn) firstRemoveBtn.style.display = 'flex';
      }
    }

    function removeDownloadLink(index) {
      const container = document.getElementById('downloadLinksContainer');
      const linkGroup = container.querySelector(`[data-link-index="${index}"]`);

      if (linkGroup) {
        linkGroup.remove();

        const remainingLinks = container.querySelectorAll('.download-link-group');

        if (remainingLinks.length === 1) {
          const removeBtn = remainingLinks[0].querySelector('.remove-link-btn');
          if (removeBtn) removeBtn.style.display = 'none';
        }
      }
    }

    function getDownloadLinksData() {
      const container = document.getElementById('downloadLinksContainer');
      const linkGroups = container.querySelectorAll('.download-link-group');
      const links = [];

      linkGroups.forEach((group) => {
        const index = group.dataset.linkIndex;
        const desc = document.getElementById(`linkDesc${index}`)?.value || '';
        const linkGA = document.getElementById(`linkGA${index}`)?.value || '';
        const linkADM = document.getElementById(`linkADM${index}`)?.value || '';

        if (desc && linkGA && linkADM) {
          links.push({ desc, linkGA, linkADM });
        }
      });

      return links;
    }

    function setDownloadLinksData(links) {
      resetDownloadLinks();

      if (!links || links.length === 0) return;

      if (links[0]) {
        document.getElementById('linkDesc1').value = links[0].desc || '';
        document.getElementById('linkGA1').value = links[0].linkGA || '';
        document.getElementById('linkADM1').value = links[0].linkADM || '';
      }

      for (let i = 1; i < links.length; i++) {
        addDownloadLink();
        const index = i + 1;
        document.getElementById(`linkDesc${index}`).value = links[i].desc || '';
        document.getElementById(`linkGA${index}`).value = links[i].linkGA || '';
        document.getElementById(`linkADM${index}`).value = links[i].linkADM || '';
      }
    }

    function closeManageModal() {
      document.getElementById('manageOverlay').classList.remove('active');
    }

    function openGenerateCodeModal() {
      closeSidebar();
      document.getElementById('generatedCodeResult').classList.remove('active');
      document.getElementById('codePoints').value = '50';
      document.getElementById('generateCodeOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeGenerateCodeModal() {
      document.getElementById('generateCodeOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function copyGeneratedCode() {
      const code = document.getElementById('codeDisplay').textContent;
      if (navigator.clipboard && code) {
        navigator.clipboard.writeText(code).then(() => {
          showCustomAlert('Cdigo copiado!');
        }).catch(() => {
          showCustomAlert('No foi possvel copiar o cdigo.');
        });
      }
    }

    function openRedeemCodeModal() {
      closeSidebar();
      document.getElementById('redeemCodeInput').value = '';
      document.getElementById('redeemOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeRedeemCodeModal() {
      document.getElementById('redeemOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function openHistoryModal() {
      closeSidebar();
      renderHistoryList();
      document.getElementById('historyOverlay').classList.add('active');
    }

    function closeHistoryOverlay() {
      document.getElementById('historyOverlay').classList.remove('active');
    }

    function renderHistoryList() {
      const historyList = document.getElementById('historyList');
      const historyFooter = document.getElementById('historyFooter');

      if (historyData.length === 0) {
        historyList.innerHTML = `
          <div class="history-empty">
            <svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
            <p>Nenhum jogo visualizado ainda.</p>
          </div>
        `;
        historyFooter.style.display = 'none';
        return;
      }

      historyFooter.style.display = 'flex';
      historyList.innerHTML = historyData.map(item => `
        <div class="history-item" onclick="openGameFromHistory('${item.id}')">
          <img src="${item.poster}" alt="${item.titulo}">
          <div class="history-item-info">
            <h3 class="history-item-title">${item.titulo}</h3>
            <p class="history-item-time">Visualizado ${formatTimeAgo(item.timestamp)}</p>
          </div>
        </div>
      `).join('');
    }

    function openGameFromHistory(id) {
      closeHistoryOverlay();
      openGameDetail(id);
    }

    function clearHistory() {
      showCustomConfirm('Deseja realmente limpar todo o histrico?', () => {
        historyData = [];
        saveHistory();
        renderHistoryList();
        showCustomAlert('Histrico limpo com sucesso!');
      });
    }

    async function loadAds() {
      const { ref, onValue } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const adsRef = ref(database, 'ads');
      onValue(adsRef, (snapshot) => {
        allAds = snapshot.val() || {};
      });
    }

    function updateAdContentFields() {
      const contentType = document.getElementById('adContentType').value;
      const urlLabel = document.getElementById('adUrlLabel');
      const urlHint = document.getElementById('adUrlHint');

      switch (contentType) {
        case 'website':
          urlLabel.textContent = 'URL do Site (iframe)';
          urlHint.textContent = 'URL do site a ser exibido no iframe';
          break;
        case 'video':
          urlLabel.textContent = 'URL do Vdeo (iframe)';
          urlHint.textContent = 'URL do vdeo (YouTube, Vimeo, etc.) ou arquivo MP4';
          break;
        case 'image':
          urlLabel.textContent = 'URL da Imagem';
          urlHint.textContent = 'URL direta da imagem (JPG, PNG, GIF, etc.)';
          break;
        case 'audio':
          urlLabel.textContent = 'URL do udio';
          urlHint.textContent = 'URL direta do arquivo de udio (MP3, WAV, etc.)';
          break;
      }
    }

    async function handlePublishAd(e) {
      e.preventDefault();

      if (!isPublisher) {
        showCustomAlert('Apenas publicadores autorizados podem publicar anncios.');
        return;
      }

      const editId = document.getElementById('editAdId').value;
      const adData = {
        title: document.getElementById('adTitle').value,
        contentType: document.getElementById('adContentType').value,
        contentUrl: document.getElementById('adContentUrl').value,
        externalUrl: document.getElementById('adExternalUrl').value,
        duration: parseInt(document.getElementById('adDuration').value),
        points: parseInt(document.getElementById('adPoints').value),
        authorId: currentUser.uid,
        authorEmail: currentUser.email,
        createdAt: Date.now()
      };

      try {
        const { ref, set, push } = window.firebaseModules;
        const database = window.firebaseDatabase;

        if (editId) {
          await set(ref(database, `ads/${editId}`), adData);
          showCustomAlert('Anncio atualizado com sucesso!');
        } else {
          const newRef = push(ref(database, 'ads'));
          await set(newRef, adData);
          showCustomAlert('Anncio publicado com sucesso!');
        }

        closePublishAdModal();
        document.getElementById('publishAdForm').reset();
        document.getElementById('editAdId').value = '';
      } catch (error) {
        showCustomAlert('Erro ao publicar anncio: ' + error.message);
      }
    }

    async function openManageAdModal() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem gerenciar anncios.');
        return;
      }

      const manageList = document.getElementById('manageAdsList');
      manageList.innerHTML = '<div class="loading">Carregando...</div>';

      document.getElementById('manageAdModal').classList.add('active');

      const userAds = Object.entries(allAds).filter(([id, ad]) => ad.authorId === currentUser.uid);

      if (userAds.length === 0) {
        manageList.innerHTML = '<p style="color: var(--text-muted);">Voc ainda no publicou nenhum anncio.</p>';
        return;
      }

      manageList.innerHTML = userAds.map(([id, ad]) => `
        <div style="background: var(--bg-card); padding: 12px; border-radius: 8px; margin-bottom: 12px; border: 1px solid var(--border-color);">
          <h3 style="margin: 0 0 8px 0; font-size: 16px;">${ad.title}</h3>
          <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 12px;">
            ${ad.url}  ${ad.points} pontos
          </p>
          <div style="display: flex; gap: 8px;">
            <button class="custom-modal-btn primary" onclick="editAd('${id}')" style="font-size: 14px; padding: 8px 16px;">Editar</button>
            <button class="custom-modal-btn secondary" onclick="deleteAd('${id}')" style="font-size: 14px; padding: 8px 16px; color: #ff6b6b; border-color: #ff6b6b;">Apagar</button>
          </div>
        </div>
      `).join('');
    }

    function editAd(id) {
      const ad = allAds[id];
      if (!ad) return;

      closeManageAdModal();

      document.getElementById('publishAdModalTitle').textContent = 'Editar Anncio';
      document.getElementById('editAdId').value = id;
      document.getElementById('adTitle').value = ad.title;

      if (ad.contentType) {
        document.getElementById('adContentType').value = ad.contentType;
        document.getElementById('adContentUrl').value = ad.contentUrl;
        document.getElementById('adExternalUrl').value = ad.externalUrl;
        document.getElementById('adDuration').value = ad.duration;
      } else {
        document.getElementById('adContentType').value = 'website';
        document.getElementById('adContentUrl').value = ad.url;
        document.getElementById('adExternalUrl').value = ad.url;
        document.getElementById('adDuration').value = 30;
      }

      document.getElementById('adPoints').value = ad.points;
      updateAdContentFields();

      openPublishAdModal();
    }

    async function deleteAd(id) {
      showCustomConfirm('Deseja realmente apagar este anncio?', async () => {
        try {
          const { ref, remove } = window.firebaseModules;
          await remove(ref(window.firebaseDatabase, `ads/${id}`));
          showCustomAlert('Anncio apagado com sucesso!');
          openManageAdModal();
        } catch (error) {
          showCustomAlert('Erro ao apagar: ' + error.message);
        }
      });
    }

    async function openEarnPointsModal() {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login com uma conta para ganhar pontos.');
        return;
      }

      if (userStatus === 'pending') {
        showCustomAlert('Sua conta ainda est aguardando aprovao do administrador. Por favor, aguarde.');
        return;
      }

      const canWatch = await checkDailyAdLimit();
      if (!canWatch) {
        showCustomAlert('Voc atingiu o limite dirio de 5 anncios. Volte amanh para ganhar mais pontos!');
        return;
      }

      const adsArray = Object.entries(allAds);
      if (adsArray.length === 0) {
        showCustomAlert('No h anncios disponveis no momento. Tente novamente mais tarde.');
        return;
      }

      const randomIndex = Math.floor(Math.random() * adsArray.length);
      const [adId, ad] = adsArray[randomIndex];

      currentAd = { id: adId, ...ad };
      startAdInterstitial();
    }

    async function checkDailyAdLimit() {
      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
      const adsWatchedRef = ref(database, `users/${currentUser.uid}/adsWatched`);
      const snapshot = await get(adsWatchedRef);

      if (!snapshot.exists()) {
        return true; // No ads watched yet
      }

      const data = snapshot.val();
      if (data.date !== today) {
        return true; // Different day, reset count
      }

      return data.count < 5; // Check if under limit
    }

    async function incrementAdWatchCount() {
      const { ref, set } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
      const adsWatchedRef = ref(database, `users/${currentUser.uid}/adsWatched`);
      const { get } = window.firebaseModules;
      const snapshot = await get(adsWatchedRef);

      let count = 1;
      if (snapshot.exists()) {
        const data = snapshot.val();
        if (data.date === today) {
          count = data.count + 1;
        }
      }

      await set(adsWatchedRef, {
        date: today,
        count: count
      });
    }

    function startAdInterstitial() {
      if (!currentAd) return;

      adTimeRemaining = currentAd.duration || 30;

      document.getElementById('adDisplayTitle').textContent = currentAd.title;
      document.getElementById('adTimer').textContent = `${adTimeRemaining}s`;
      document.getElementById('adTimer').classList.remove('complete');

      const container = document.getElementById('adIframeContainer');
      const contentType = currentAd.contentType || 'website';
      const contentUrl = currentAd.contentUrl || currentAd.url; // Fallback to old 'url' field

      switch (contentType) {
        case 'website':
          container.innerHTML = `<iframe src="${contentUrl}" sandbox="allow-scripts allow-same-origin"></iframe>`;
          break;
        case 'video':
          if (contentUrl.includes('youtube.com') || contentUrl.includes('youtu.be')) {
            const videoId = extractYoutubeId(contentUrl);
            if (videoId) {
              container.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe>`;
            } else {
              container.innerHTML = `<iframe src="${contentUrl}" sandbox="allow-scripts allow-same-origin"></iframe>`;
            }
          } else if (contentUrl.includes('vimeo.com')) {
            container.innerHTML = `<iframe src="${contentUrl}" allowfullscreen></iframe>`;
          } else {
            container.innerHTML = `
              <video controls autoplay style="width: 100%; height: 100%; background: #000;">
                <source src="${contentUrl}" type="video/mp4">
                Seu navegador no suporta vdeo.
              </video>
            `;
          }
          break;
        case 'image':
          container.innerHTML = `
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--bg-secondary);">
              <img src="${contentUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
          `;
          break;
        case 'audio':
          container.innerHTML = `
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--bg-secondary); flex-direction: column; gap: 20px;">
              <svg viewBox="0 0 24 24" style="width: 80px; height: 80px; fill: var(--text-muted);">
                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
              </svg>
              <audio controls autoplay style="width: 80%; max-width: 500px;">
                <source src="${contentUrl}" type="audio/mpeg">
                Seu navegador no suporta udio.
              </audio>
            </div>
          `;
          break;
        default:
          container.innerHTML = `<iframe src="${contentUrl}" sandbox="allow-scripts allow-same-origin"></iframe>`;
      }

      const claimBtn = document.getElementById('claimPointsBtn');
      claimBtn.disabled = true;
      claimBtn.textContent = `Aguarde ${adTimeRemaining}s para receber pontos`;

      document.getElementById('adOverlay').classList.add('active');

      if (adTimer) clearInterval(adTimer);
      adTimer = setInterval(() => {
        adTimeRemaining--;
        document.getElementById('adTimer').textContent = `${adTimeRemaining}s`;
        claimBtn.textContent = `Aguarde ${adTimeRemaining}s para receber pontos`;

        if (adTimeRemaining <= 0) {
          clearInterval(adTimer);
          document.getElementById('adTimer').textContent = 'Completo!';
          document.getElementById('adTimer').classList.add('complete');
          claimBtn.disabled = false;
          claimBtn.textContent = `Ganhar +${currentAd.points} Pontos`;
        }
      }, 1000);
    }

    function openAdExternal() {
      if (currentAd) {
        const url = currentAd.externalUrl || currentAd.url; // Fallback to old 'url' field
        if (url) {
          window.open(url, '_blank');
        }
      }
    }

    async function claimAdPoints() {
      if (!currentAd || adTimeRemaining > 0) return;
      if (!currentUser || currentUser.isAnonymous) return;

      const { ref, get, update, push } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const adRef = ref(database, `ads/${currentAd.id}`);
        const adSnapshot = await get(adRef);

        if (!adSnapshot.exists()) {
          closeAdInterstitial();
          showCustomAlert('Este anncio foi removido. Tente outro anncio.');
          return;
        }

        const adData = adSnapshot.val();
        const adPoints = adData.points;

        const today = new Date().toISOString().split('T')[0];
        const adsWatchedRef = ref(database, `users/${currentUser.uid}/adsWatched`);
        const adsSnapshot = await get(adsWatchedRef);

        let currentCount = 0;
        if (adsSnapshot.exists()) {
          const adsData = adsSnapshot.val();
          if (adsData.date === today) {
            currentCount = adsData.count || 0;
          }
        }

        if (currentCount >= 5) {
          closeAdInterstitial();
          showCustomAlert('Voc atingiu o limite dirio de anncios.');
          return;
        }

        const userRef = ref(database, `users/${currentUser.uid}`);
        const userSnapshot = await get(userRef);
        const userData = userSnapshot.val() || {};
        const currentPoints = userData.points || 0;
        const newPointsTotal = currentPoints + adPoints;

        const serverTime = await getServerTimestamp();

        const claimId = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

        const updates = {};
        updates[`adViewClaims/${currentUser.uid}/${claimId}`] = {
          adId: currentAd.id,
          claimedAt: serverTime,
          pointsAwarded: adPoints,
          newPointsTotal: newPointsTotal
        };
        updates[`users/${currentUser.uid}/points`] = newPointsTotal;
        updates[`users/${currentUser.uid}/adsWatched`] = {
          date: today,
          count: currentCount + 1
        };

        await update(ref(database), updates);

        _syncPointsDisplay(newPointsTotal);

        const remaining = 5 - (currentCount + 1);

        closeAdInterstitial();
        updateEarnPointsButton();

        showCustomAlert(`Voc ganhou +${adPoints} pontos! Total: ${newPointsTotal} pontos.\n\nVoc pode assistir mais ${remaining} anncio(s) hoje.`);

      } catch (error) {
        console.error('[SEGURANA] Erro na transao de pontos de anncio:', error);
        closeAdInterstitial();
        showCustomAlert('Erro ao processar pontos. Tente novamente.');
      }
    }

    async function getAdWatchCountToday() {
      if (!currentUser || currentUser.isAnonymous) {
        return 0;
      }

      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const today = new Date().toISOString().split('T')[0];
      const adsWatchedRef = ref(database, `users/${currentUser.uid}/adsWatched`);
      const snapshot = await get(adsWatchedRef);

      if (!snapshot.exists()) {
        return 0;
      }

      const data = snapshot.val();
      if (data.date !== today) {
        return 0;
      }

      return data.count;
    }

    async function updateEarnPointsButton() {
      const btn = document.getElementById('earnPointsBtn');
      if (!btn || !currentUser || currentUser.isAnonymous) return;

      const count = await getAdWatchCountToday();
      const remaining = 5 - count;

      if (remaining <= 0) {
        btn.innerHTML = `
          <svg viewBox="0 0 24 24" style="fill: white;"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
          Limite Dirio Atingido (0/5)
        `;
        btn.style.opacity = '0.6';
      } else {
        btn.innerHTML = `
          <svg viewBox="0 0 24 24" style="fill: white;"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
          Ganhar + Pontos (${remaining}/5 hoje)
        `;
        btn.style.opacity = '1';
      }
    }

    function closeAdInterstitial() {
      if (adTimer) clearInterval(adTimer);
      document.getElementById('adOverlay').classList.remove('active');
      document.getElementById('adIframeContainer').innerHTML = '<p style="color: var(--text-muted);">Carregando...</p>';
      currentAd = null;
      adTimeRemaining = 30;
    }

    async function handleResetPassword(e) {
      e.preventDefault();

      const email = document.getElementById('resetEmail').value;

      try {
        const { sendPasswordResetEmail } = window.firebaseModules;
        await sendPasswordResetEmail(window.firebaseAuth, email);
        closeResetPasswordModal();
        showCustomAlert('Link de redefinio de senha enviado para ' + email + '. Verifique sua caixa de entrada.');
      } catch (error) {
        showCustomAlert('Erro ao enviar email: ' + error.message);
      }
    }

    function openPublishAdModal() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem publicar anncios.');
        return;
      }
      document.getElementById('publishAdModalTitle').textContent = 'Publicar Anncio';
      document.getElementById('editAdId').value = '';
      document.getElementById('publishAdModal').classList.add('active');
    }

    function closePublishAdModal() {
      document.getElementById('publishAdModal').classList.remove('active');
      document.getElementById('publishAdForm').reset();
      document.getElementById('editAdId').value = '';
    }

    function closeManageAdModal() {
      document.getElementById('manageAdModal').classList.remove('active');
    }

    let currentUserFilter = 'pending';
    let allUsers = {};

    let userNotifications = [];
    let dismissedNotifications = {};

    async function openManageUsersModal() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem gerenciar usurios.');
        return;
      }

      closeSidebar();
      document.getElementById('manageUsersOverlay').classList.add('active');
      await loadAllUsers();
    }

    function closeManageUsersModal() {
      document.getElementById('manageUsersOverlay').classList.remove('active');
    }

    async function loadAllUsers() {
      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const usersRef = ref(database, 'users');
      const snapshot = await get(usersRef);

      if (snapshot.exists()) {
        allUsers = snapshot.val();
      } else {
        allUsers = {};
      }

      renderUsersList();
    }

    function filterUsers(status) {
      currentUserFilter = status;

      const filterBtns = document.querySelectorAll('.manage-users-filter-btn');
      filterBtns.forEach(btn => btn.classList.remove('active'));
      document.getElementById('filter' + status.charAt(0).toUpperCase() + status.slice(1)).classList.add('active');

      renderUsersList();
    }

    function renderUsersList() {
      const usersList = document.getElementById('manageUsersList');

      const filteredUsers = Object.entries(allUsers).filter(([id, user]) => {
        const status = user.status || 'pending';
        return status === currentUserFilter;
      });

      if (filteredUsers.length === 0) {
        const statusLabels = {
          pending: 'pendentes',
          approved: 'aprovados',
          rejected: 'rejeitados'
        };
        const statusIcons = {
          pending: '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',
          approved: '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',
          rejected: '<svg viewBox="0 0 24 24"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>'
        };
        usersList.innerHTML = `
          <div class="manage-users-empty">
            ${statusIcons[currentUserFilter]}
            <p>Nenhum usurio ${statusLabels[currentUserFilter]}</p>
          </div>
        `;
        return;
      }

      usersList.innerHTML = filteredUsers.map(([id, user]) => {
        const createdDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString('pt-BR') : 'N/A';
        const statusLabels = {
          pending: 'Pendente',
          approved: 'Aprovado',
          rejected: 'Rejeitado'
        };
        const status = user.status || 'pending';

        let actionButtons = '';
        if (status === 'pending') {
          actionButtons = `
            <button class="manage-user-action-btn approve" onclick="approveUser('${id}')">
              <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
              Aprovar
            </button>
            <button class="manage-user-action-btn reject" onclick="rejectUser('${id}')">
              <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
              Rejeitar
            </button>
          `;
        } else if (status === 'approved') {
          actionButtons = `
            <button class="manage-user-action-btn reject" onclick="rejectUser('${id}')">
              <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
              Marcar como Fraude
            </button>
          `;
        } else if (status === 'rejected') {
          actionButtons = `
            <button class="manage-user-action-btn restore" onclick="approveUser('${id}')">
              <svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"/></svg>
              Restaurar Usurio
            </button>
          `;
        }

        return `
          <div class="manage-user-card">
            <div class="manage-user-header">
              <div class="manage-user-info">
                <span class="manage-user-name">${user.name || 'Sem nome'}</span>
                <span class="manage-user-email">${user.email || 'Email no disponvel'}</span>
              </div>
              <span class="manage-user-status-badge ${status}">${statusLabels[status]}</span>
            </div>
            <div class="manage-user-meta">
              <div class="manage-user-meta-item">
                <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
                <span>Registrado: ${createdDate}</span>
              </div>
              <div class="manage-user-meta-item">
                <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                <span>Pontos: ${user.points || 0}</span>
              </div>
            </div>
            <div class="manage-user-actions">
              ${actionButtons}
            </div>
          </div>
        `;
      }).join('');
    }

    async function approveUser(userId) {
      showCustomConfirm('Deseja aprovar este usurio? Ele receber 100 pontos de bnus.', async () => {
        try {
          const { ref, update, get } = window.firebaseModules;
          const database = window.firebaseDatabase;

          const userRef = ref(database, `users/${userId}`);
          const snapshot = await get(userRef);
          const userData = snapshot.val() || {};
          const currentPoints = userData.points || 0;

          await update(ref(database, `users/${userId}`), {
            status: 'approved',
            points: currentPoints + 100,
            approvedAt: Date.now(),
            approvedBy: 'admin'
          });

          allUsers[userId].status = 'approved';
          allUsers[userId].points = currentPoints + 100;
          renderUsersList();
          showCustomAlert('Usurio aprovado com sucesso! +100 pontos de bnus concedidos.');
        } catch (error) {
          showCustomAlert('Erro ao aprovar usurio: ' + error.message);
        }
      });
    }

    async function rejectUser(userId) {
      showCustomConfirm('Deseja rejeitar/bloquear este usurio? Ele ser deslogado automaticamente e no poder mais acessar a conta.', async () => {
        try {
          const { ref, update } = window.firebaseModules;
          const database = window.firebaseDatabase;

          await update(ref(database, `users/${userId}`), { status: 'rejected' });

          allUsers[userId].status = 'rejected';
          renderUsersList();
          showCustomAlert('Usurio marcado como fraude e bloqueado!');
        } catch (error) {
          showCustomAlert('Erro ao rejeitar usurio: ' + error.message);
        }
      });
    }

    function openResetPasswordModal() {
      const authOverlay = document.getElementById('authOverlay');
      if (authOverlay && authOverlay.classList.contains('active')) {
        showResetPasswordForm();
        return;
      }
      document.getElementById('resetPasswordModal').classList.add('active');
    }

    function closeResetPasswordModal() {
      document.getElementById('resetPasswordModal').classList.remove('active');
      document.getElementById('resetPasswordForm').reset();
    }

    function showCustomAlert(message) {
      const modal = document.createElement('div');
      modal.className = 'custom-modal active';
      modal.innerHTML = `
        <div class="custom-modal-content">
          <p style="margin: 0 0 16px 0;">${message}</p>
          <div class="custom-modal-buttons">
            <button class="custom-modal-btn primary" onclick="this.closest('.custom-modal').remove()">OK</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function showConfirmModal(title, message, onConfirm) {
      const modal = document.createElement('div');
      modal.className = 'custom-modal active';
      modal.innerHTML = `
        <div class="custom-modal-content" style="max-width: 450px;">
          <h2 style="margin: 0 0 16px 0; font-size: 18px; color: var(--text-primary);">${title}</h2>
          <div style="margin: 0 0 20px 0; color: var(--text-secondary); font-size: 14px; line-height: 1.6; white-space: pre-line;">${message}</div>
          <div class="custom-modal-buttons">
            <button class="custom-modal-btn secondary confirm-cancel-btn">Cancelar</button>
            <button class="custom-modal-btn primary confirm-ok-btn">Confirmar</button>
          </div>
        </div>
      `;

      const cancelBtn = modal.querySelector('.confirm-cancel-btn');
      const confirmBtn = modal.querySelector('.confirm-ok-btn');

      cancelBtn.addEventListener('click', () => {
        modal.remove();
      });

      confirmBtn.addEventListener('click', () => {
        modal.remove();
        if (typeof onConfirm === 'function') {
          onConfirm();
        }
      });

      document.body.appendChild(modal);
    }

    let readNotifications = {};
    let previousNotificationIds = [];
    let notificationsInitialized = false;

    async function loadNotifications() {
      if (!currentUser || currentUser.isAnonymous) return;

      const { ref, onValue, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      const dismissedRef = ref(database, `dismissedNotifications/${currentUser.uid}`);
      const dismissedSnapshot = await get(dismissedRef);
      dismissedNotifications = dismissedSnapshot.exists() ? dismissedSnapshot.val() : {};

      const readRef = ref(database, `readNotifications/${currentUser.uid}`);
      const readSnapshot = await get(readRef);
      readNotifications = readSnapshot.exists() ? readSnapshot.val() : {};

      const notificationsRef = ref(database, 'notifications');
      onValue(notificationsRef, (snapshot) => {
        const allNotifications = snapshot.val() || {};

        const filteredNotifications = Object.entries(allNotifications)
          .filter(([id, notif]) => {
            if (dismissedNotifications[id]) return false;

            if (!notif.targetUserId || notif.targetUserId === currentUser.uid) {
              return true;
            }

            return false;
          })
          .map(([id, notif]) => ({
            id,
            ...notif,
            isRead: !!readNotifications[id],
            isPersonal: !!notif.targetUserId
          }))
          .sort((a, b) => b.createdAt - a.createdAt);

        const currentIds = filteredNotifications.map(n => n.id);
        if (notificationsInitialized) {
          const newNotifications = filteredNotifications.filter(
            n => !previousNotificationIds.includes(n.id)
          );

          newNotifications.forEach(notif => {
            showNotificationToast(notif.title, notif.message);
          });
        }

        previousNotificationIds = currentIds;
        notificationsInitialized = true;
        userNotifications = filteredNotifications;

        updateNotificationBadge();

        checkUnreadNotifications();
      });
    }

    function checkUnreadNotifications() {
      const unreadCount = userNotifications.filter(n => !n.isRead).length;

      if (unreadCount > 0) {
        try {
          if (typeof Android !== 'undefined' && Android.showNotification) {
            Android.showNotification();
          }
        } catch (e) {
          console.log('Android bridge not available');
        }
      }
    }

    function showNotificationToast(title, message) {
      const existingToast = document.querySelector('.toast-notification');
      if (existingToast) {
        existingToast.remove();
      }

      const toast = document.createElement('div');
      toast.className = 'toast-notification';
      toast.innerHTML = `
        <div class="toast-title"> ${title}</div>
        <div class="toast-message">${message.length > 80 ? message.substring(0, 80) + '...' : message}</div>
      `;

      toast.onclick = () => {
        toast.remove();
        openNotificationsModal();
      };

      document.body.appendChild(toast);

      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 5000);
    }

    function updateNotificationBadge() {
      const badge = document.getElementById('notificationBadge');
      const unreadCount = userNotifications.filter(n => !n.isRead).length;

      if (unreadCount > 0) {
        badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
        badge.style.display = 'block';
      } else {
        badge.style.display = 'none';
      }
    }

    async function openSendNotificationModal() {
      if (!isPublisher) {
        showCustomAlert('Apenas publicadores podem enviar notificaes.');
        return;
      }
      document.getElementById('sendNotificationForm').reset();

      selectNotificationTarget('all');

      await loadUsersForNotification();

      document.getElementById('sendNotificationOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeSendNotificationModal() {
      closeSendNotificationOverlay();
    }

    function closeSendNotificationOverlay() {
      document.getElementById('sendNotificationOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function selectNotificationTarget(target) {
      const allBtn = document.getElementById('targetAllBtn');
      const individualBtn = document.getElementById('targetIndividualBtn');
      const container = document.getElementById('userSelectorContainer');
      const submitBtnText = document.getElementById('sendNotificationBtnText');
      const hiddenInput = document.getElementById('notificationTargetInput');

      if (target === 'individual') {
        allBtn.classList.remove('active');
        individualBtn.classList.add('active');
        container.classList.add('active');
        submitBtnText.textContent = 'Enviar para Usurio';
        hiddenInput.value = 'individual';
      } else {
        allBtn.classList.add('active');
        individualBtn.classList.remove('active');
        container.classList.remove('active');
        submitBtnText.textContent = 'Enviar para Todos';
        hiddenInput.value = 'all';
      }
    }

    function toggleUserSelector() {
      const target = document.getElementById('notificationTargetInput').value;
      selectNotificationTarget(target === 'individual' ? 'all' : 'individual');
    }

    async function loadUsersForNotification() {
      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const usersRef = ref(database, 'users');
        const snapshot = await get(usersRef);

        if (snapshot.exists()) {
          const users = snapshot.val();
          const select = document.getElementById('notificationTargetUser');

          const userList = Object.entries(users)
            .filter(([id, user]) => user.status === 'approved' || user.status === 'pending')
            .map(([id, user]) => ({
              id,
              name: user.name || 'Sem nome',
              email: user.email || '',
              status: user.status
            }))
            .sort((a, b) => a.name.localeCompare(b.name));

          select.innerHTML = '<option value="">Selecione um usurio...</option>' +
            userList.map(user => {
              const statusLabel = user.status === 'approved' ? '' : '';
              return `<option value="${user.id}">${user.name} (${user.email}) ${statusLabel}</option>`;
            }).join('');
        }
      } catch (error) {
        console.error('Erro ao carregar usurios:', error);
      }
    }

    async function handleSendNotification(e) {
      e.preventDefault();

      const title = document.getElementById('notificationTitle').value.trim();
      const message = document.getElementById('notificationMessage').value.trim();
      const targetType = document.getElementById('notificationTargetInput').value;
      const targetUserId = document.getElementById('notificationTargetUser').value;

      if (!title || !message) {
        showCustomAlert('Por favor, preencha todos os campos.');
        return;
      }

      if (targetType === 'individual' && !targetUserId) {
        showCustomAlert('Por favor, selecione um usurio.');
        return;
      }

      try {
        const { ref, push, set } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const notificationsRef = ref(database, 'notifications');
        const newNotificationRef = push(notificationsRef);

        const notificationData = {
          title: title,
          message: message,
          createdAt: Date.now(),
          createdBy: currentUser.email
        };

        if (targetType === 'individual') {
          notificationData.targetUserId = targetUserId;

          const targetUserSelect = document.getElementById('notificationTargetUser');
          const targetUserName = targetUserSelect.options[targetUserSelect.selectedIndex].text;
          notificationData.targetUserName = targetUserName.split(' (')[0]; // Extract just the name
        }

        await set(newNotificationRef, notificationData);

        closeSendNotificationModal();

        if (targetType === 'individual') {
          showCustomAlert('Notificao enviada com sucesso para o usurio selecionado!');
        } else {
          showCustomAlert('Notificao enviada com sucesso para todos os usurios!');
        }
      } catch (error) {
        showCustomAlert('Erro ao enviar notificao: ' + error.message);
      }
    }

    function openNotificationsModal() {
      openNotificationsOverlay();
    }

    function closeNotificationsModal() {
      closeNotificationsOverlay();
    }

    function openNotificationsOverlay() {
      document.getElementById('notificationsOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      renderNotifications();
    }

    function closeNotificationsOverlay() {
      document.getElementById('notificationsOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function openFaqModal() {
      openAboutOverlay();
    }

    function closeFaqModal() {
      closeAboutOverlay();
    }

    function openProfileOverlay() {
      closeSidebar();
      const container = document.getElementById('profileContainer');
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user || user.isAnonymous) {
        container.innerHTML = `
          <div class="profile-not-logged">
            <div class="profile-not-logged-icon">
              <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
            </div>
            <h3>Voc no est logado</h3>
            <p>Faa login para ver seu perfil completo e acessar todos os recursos do Portal Digital.</p>
            <button class="profile-login-btn" onclick="closeProfileOverlay(); openLoginModal();">
              <svg viewBox="0 0 24 24"><path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/></svg>
              Entrar
            </button>
          </div>
        `;
      } else {
        loadProfileData(user, container);
      }

      document.getElementById('profileOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function getDefaultAvatarSVG() {
      return `<svg viewBox="0 0 212 212" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="212" height="212" fill="#D8D8D8"/>
        <path d="M106 106C124.778 106 140 90.7777 140 72C140 53.2223 124.778 38 106 38C87.2223 38 72 53.2223 72 72C72 90.7777 87.2223 106 106 106Z" fill="#FFFFFF"/>
        <path d="M106 124C72.8 124 46 137.6 46 154V174H166V154C166 137.6 139.2 124 106 124Z" fill="#FFFFFF"/>
      </svg>`;
    }

    function getProfileSkeletonHTML() {
      return `
        <div class="profile-loading-skeleton">
          <div class="skeleton-header">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-name"></div>
            <div class="skeleton-email"></div>
            <div class="skeleton-badge"></div>
          </div>

          <div class="skeleton-stats">
            <div class="skeleton-stat">
              <div class="skeleton-stat-value"></div>
              <div class="skeleton-stat-label"></div>
            </div>
            <div class="skeleton-stat">
              <div class="skeleton-stat-value"></div>
              <div class="skeleton-stat-label"></div>
            </div>
          </div>

          <div class="skeleton-info-card">
            <div class="skeleton-info-item">
              <div class="skeleton-info-icon"></div>
              <div class="skeleton-info-content">
                <div class="skeleton-info-label"></div>
                <div class="skeleton-info-value"></div>
              </div>
            </div>
            <div class="skeleton-info-item">
              <div class="skeleton-info-icon"></div>
              <div class="skeleton-info-content">
                <div class="skeleton-info-label"></div>
                <div class="skeleton-info-value"></div>
              </div>
            </div>
            <div class="skeleton-info-item">
              <div class="skeleton-info-icon"></div>
              <div class="skeleton-info-content">
                <div class="skeleton-info-label"></div>
                <div class="skeleton-info-value"></div>
              </div>
            </div>
          </div>

          <div class="skeleton-button"></div>
        </div>
      `;
    }

    async function loadProfileData(user, container) {
      container.innerHTML = getProfileSkeletonHTML();

      try {
        const displayName = userName || user.displayName || user.email?.split('@')[0] || 'Usurio';
        const email = user.email || '';
        const points = userPoints || 0;
        const status = userStatus || 'pending';
        const role = isPublisher ? 'admin' : 'user';

        let createdAt = 'N/A';
        try {
          const { ref, get } = window.firebaseModules;
          const db = window.firebaseDatabase;
          const userRef = ref(db, 'users/' + user.uid + '/createdAt');
          const snapshot = await get(userRef);
          if (snapshot.exists()) {
            createdAt = new Date(snapshot.val()).toLocaleDateString('pt-BR');
          }
        } catch (e) {
          console.log('No foi possvel buscar data de criao');
        }

        let statusBadgeClass = 'pending';
        let statusBadgeText = ' Pendente';
        let avatarStatusClass = 'status-pending';
        if (role === 'admin') {
          statusBadgeClass = 'admin';
          statusBadgeText = ' Administrador';
          avatarStatusClass = 'status-admin';
        } else if (status === 'approved') {
          statusBadgeClass = 'verified';
          statusBadgeText = ' Verificado';
          avatarStatusClass = 'status-verified';
        } else if (status === 'rejected') {
          statusBadgeClass = 'pending';
          statusBadgeText = ' Rejeitado';
          avatarStatusClass = 'status-rejected';
        }

        document.getElementById('profileHeaderPointsValue').textContent = points;

        container.innerHTML = `
          <div class="profile-header-card">
            <div class="profile-avatar-svg ${avatarStatusClass}">${getDefaultAvatarSVG()}</div>
            <div class="profile-user-info-scroll">
              <h2 class="profile-name">${escapeHtml(displayName)}</h2>
              <p class="profile-email">${escapeHtml(email)}</p>
            </div>
            <span class="profile-status-badge ${statusBadgeClass}">${statusBadgeText}</span>
          </div>

          <div class="profile-info-card">
            <div class="profile-info-item">
              <div class="profile-info-icon">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
              </div>
              <div class="profile-info-content">
                <div class="profile-info-label">Nome</div>
                <div class="profile-info-value">${escapeHtml(displayName)}</div>
              </div>
            </div>

            <div class="profile-info-item">
              <div class="profile-info-icon">
                <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
              </div>
              <div class="profile-info-content">
                <div class="profile-info-label">Email</div>
                <div class="profile-info-value">${escapeHtml(email)}</div>
              </div>
            </div>

            <div class="profile-info-item">
              <div class="profile-info-icon">
                <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
              </div>
              <div class="profile-info-content">
                <div class="profile-info-label">Membro desde</div>
                <div class="profile-info-value">${createdAt}</div>
              </div>
            </div>
          </div>

          <button class="profile-logout-btn" onclick="closeProfileOverlay(); logout();">
            <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
            Sair da Conta
          </button>
        `;
      } catch (error) {
        console.error('Error loading profile:', error);
        const displayName = userName || user.displayName || user.email?.split('@')[0] || 'Usurio';
        const email = user.email || '';

        document.getElementById('profileHeaderPointsValue').textContent = userPoints || 0;

        container.innerHTML = `
          <div class="profile-header-card">
            <div class="profile-avatar-svg status-pending">${getDefaultAvatarSVG()}</div>
            <div class="profile-user-info-scroll">
              <h2 class="profile-name">${escapeHtml(displayName)}</h2>
              <p class="profile-email">${escapeHtml(email)}</p>
            </div>
          </div>

          <button class="profile-logout-btn" onclick="closeProfileOverlay(); logout();">
            <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
            Sair da Conta
          </button>
        `;
      }
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function closeProfileOverlay() {
      document.getElementById('profileOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function openAboutOverlay() {
      closeSidebar();
      document.getElementById('aboutOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeAboutOverlay() {
      document.getElementById('aboutOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function openAboutHelpModal() {
      document.getElementById('aboutHelpModal').classList.add('active');
    }

    function closeAboutHelpModal() {
      document.getElementById('aboutHelpModal').classList.remove('active');
    }

    function openCommentsHelpModal() {
      document.getElementById('commentsHelpModal').classList.add('active');
    }

    function closeCommentsHelpModal() {
      document.getElementById('commentsHelpModal').classList.remove('active');
    }

    let allReports = [];
    let currentReportFilter = 'all';

    function openReportProblemModal(prefillUrl = '') {
      closeSidebar();
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user || user.isAnonymous) {
        showCustomAlert('Voc precisa estar logado para reportar um problema.');
        return;
      }

      document.getElementById('reportLink').value = prefillUrl;
      document.getElementById('reportDescription').value = '';
      document.getElementById('reportCharCount').textContent = '0';
      document.getElementById('reportProblemOverlay').classList.add('active');

      document.getElementById('reportDescription').oninput = function() {
        document.getElementById('reportCharCount').textContent = this.value.length;
      };
    }

    function openReportFromGame() {
      if (!currentGameData) {
        showCustomAlert('Nenhum jogo selecionado.');
        return;
      }

      const gameUrl = window.location.origin + window.location.pathname + '?id=' + currentGameData.id;
      openReportProblemModal(gameUrl);
    }

    function closeReportProblemOverlay() {
      document.getElementById('reportProblemOverlay').classList.remove('active');
    }

    async function handleReportProblem(event) {
      event.preventDefault();

      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user || user.isAnonymous) {
        showCustomAlert('Voc precisa estar logado para reportar um problema.');
        return;
      }

      const link = document.getElementById('reportLink').value.trim();
      const description = document.getElementById('reportDescription').value.trim();

      if (!description) {
        showCustomAlert('Por favor, descreva o problema.');
        return;
      }

      const submitBtn = document.getElementById('submitReportBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';

      try {
        const { ref, push, set, get } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const userRef = ref(database, `users/${user.uid}`);
        const userSnapshot = await get(userRef);
        const userData = userSnapshot.val() || {};

        const reportData = {
          link: link,
          description: description,
          reporterId: user.uid,
          reporterEmail: user.email,
          reporterName: userData.name || 'Usurio',
          status: 'pending',
          createdAt: Date.now(),
          resolvedAt: null,
          resolvedBy: null
        };

        const reportsRef = ref(database, 'problemReports');
        const newReportRef = push(reportsRef);
        await set(newReportRef, reportData);

        closeReportProblemOverlay();
        showCustomAlert(' Report enviado com sucesso! Os administradores iro analisar o problema.');
      } catch (error) {
        console.error('Error submitting report:', error);
        showCustomAlert('Erro ao enviar report. Tente novamente.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Enviar Report';
      }
    }

    async function openViewReportsModal() {
      closeSidebar();
      document.getElementById('reportsOverlay').classList.add('active');
      await loadReports();
    }

    function closeViewReportsModal() {
      document.getElementById('reportsOverlay').classList.remove('active');
    }

    async function updateReportsBadge() {
      if (!isPublisher && userStatus !== 'approved') return;

      const badge = document.getElementById('reportsBadge');
      if (!badge) return;

      try {
        const { ref, get } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const reportsRef = ref(database, 'problemReports');
        const snapshot = await get(reportsRef);

        if (!snapshot.exists()) {
          badge.style.display = 'none';
          return;
        }

        let pendingCount = 0;
        snapshot.forEach(child => {
          const report = child.val();
          if (report.status === 'pending') {
            pendingCount++;
          }
        });

        if (pendingCount > 0) {
          badge.textContent = pendingCount > 99 ? '99+' : pendingCount;
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      } catch (error) {
        console.error('Error updating reports badge:', error);
        badge.style.display = 'none';
      }
    }

    async function loadReports() {
      const reportsList = document.getElementById('reportsList');
      reportsList.innerHTML = `
        <div class="reports-empty">
          <svg viewBox="0 0 24 24"><path d="M12 4V2C6.48 2 2 6.48 2 12h2c0-4.41 3.59-8 8-8zm0 16c-4.41 0-8-3.59-8-8H2c0 5.52 4.48 10 10 10v-2zm0-2c3.31 0 6-2.69 6-6h-2c0 2.21-1.79 4-4 4v2zm0-16c5.52 0 10 4.48 10 10h-2c0-4.41-3.59-8-8-8V2z"/></svg>
          <span class="reports-empty-text">Carregando reports...</span>
        </div>
      `;

      try {
        const { ref, get } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const reportsRef = ref(database, 'problemReports');
        const snapshot = await get(reportsRef);

        if (!snapshot.exists()) {
          reportsList.innerHTML = `
            <div class="reports-empty">
              <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H6v-2h6v2zm3-4H6v-2h9v2zm0-4H6V7h9v2z"/></svg>
              <span class="reports-empty-text">Nenhum report encontrado</span>
            </div>
          `;
          allReports = [];
          return;
        }

        allReports = [];
        snapshot.forEach(child => {
          allReports.push({ id: child.key, ...child.val() });
        });

        allReports.sort((a, b) => b.createdAt - a.createdAt);

        renderReports();
      } catch (error) {
        console.error('Error loading reports:', error);
        reportsList.innerHTML = `
          <div class="reports-empty">
            <svg viewBox="0 0 24 24" style="fill: #f44336;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
            <span class="reports-empty-text" style="color: #f44336;">Erro ao carregar reports</span>
          </div>
        `;
      }
    }

    function filterReports(filter) {
      currentReportFilter = filter;

      document.getElementById('reportFilterAll').classList.remove('active');
      document.getElementById('reportFilterPending').classList.remove('active');
      document.getElementById('reportFilterResolved').classList.remove('active');

      if (filter === 'all') document.getElementById('reportFilterAll').classList.add('active');
      else if (filter === 'pending') document.getElementById('reportFilterPending').classList.add('active');
      else if (filter === 'resolved') document.getElementById('reportFilterResolved').classList.add('active');

      renderReports();
    }

    function renderReports() {
      const reportsList = document.getElementById('reportsList');

      let filteredReports = allReports;
      if (currentReportFilter !== 'all') {
        filteredReports = allReports.filter(r => r.status === currentReportFilter);
      }

      if (filteredReports.length === 0) {
        reportsList.innerHTML = `
          <div class="reports-empty">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H6v-2h6v2zm3-4H6v-2h9v2zm0-4H6V7h9v2z"/></svg>
            <span class="reports-empty-text">Nenhum report encontrado</span>
          </div>
        `;
        return;
      }

      reportsList.innerHTML = filteredReports.map(report => {
        const date = new Date(report.createdAt).toLocaleDateString('pt-BR', {
          day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit'
        });

        const statusClass = report.status === 'pending' ? 'pending' : 'resolved';
        const statusText = report.status === 'pending' ? 'Pendente' : 'Resolvido';
        const statusIcon = report.status === 'pending' ? '' : '';

        return `
          <div class="report-card">
            <div class="report-card-header">
              <div class="report-card-info">
                <span class="report-card-date">${date}</span>
                <div class="report-card-name">${report.reporterName}</div>
                <div class="report-card-email">${report.reporterEmail}</div>
              </div>
              <span class="report-status-badge ${statusClass}">
                ${statusIcon} ${statusText}
              </span>
            </div>
            <div class="report-card-section">
              <span class="report-card-label">Link do problema:</span>
              <a href="${report.link}" target="_blank" rel="noopener" class="report-card-link">${report.link}</a>
            </div>
            <div class="report-card-section">
              <span class="report-card-label">Descrio:</span>
              <p class="report-card-description">${report.description}</p>
            </div>
            ${report.status === 'pending' ? `
              ${isPublisher ? `
              <div class="report-card-actions">
                <button onclick="markReportResolved('${report.id}')" class="report-resolve-btn">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                  Resolver
                </button>
                <button onclick="confirmDeleteReport('${report.id}')" class="report-delete-btn">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                  Excluir
                </button>
              </div>
              ` : ''}
            ` : `
              <div class="report-resolved-info">
                 Resolvido em ${report.resolvedAt ? new Date(report.resolvedAt).toLocaleDateString('pt-BR') : 'N/A'}
              </div>
              ${isPublisher ? `
              <button onclick="confirmDeleteReport('${report.id}')" class="report-delete-btn full-width">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                Excluir Report
              </button>
              ` : ''}
            `}
          </div>
        `;
      }).join('');
    }

    async function markReportResolved(reportId) {
      try {
        const { ref, update } = window.firebaseModules;
        const database = window.firebaseDatabase;
        const auth = window.firebaseAuth;
        const user = auth.currentUser;

        const reportRef = ref(database, `problemReports/${reportId}`);
        await update(reportRef, {
          status: 'resolved',
          resolvedAt: Date.now(),
          resolvedBy: user.email
        });

        const report = allReports.find(r => r.id === reportId);
        if (report) {
          report.status = 'resolved';
          report.resolvedAt = Date.now();
          report.resolvedBy = user.email;
        }
        renderReports();
        updateReportsBadge();
        showCustomAlert(' Report marcado como resolvido!');
      } catch (error) {
        console.error('Error resolving report:', error);
        showCustomAlert('Erro ao atualizar report.');
      }
    }

    function confirmDeleteReport(reportId) {
      showCustomConfirm('Tem certeza que deseja excluir este report? Esta ao no pode ser desfeita.', () => {
        deleteReport(reportId);
      });
    }

    async function deleteReport(reportId) {
      try {
        const { ref, remove } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const reportRef = ref(database, `problemReports/${reportId}`);
        await remove(reportRef);

        allReports = allReports.filter(r => r.id !== reportId);
        renderReports();
        updateReportsBadge();
        showCustomAlert('Report excludo com sucesso!');
      } catch (error) {
        console.error('Error deleting report:', error);
        showCustomAlert('Erro ao excluir report.');
      }
    }

    let selectedRating = 0;
    let totalAppStars = 0;
    let userHasRated = false;
    let userPreviousRating = 0;

    async function loadAppRatingData() {
      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      try {
        const ratingsRef = ref(database, 'appRatings/totalStars');
        const snapshot = await get(ratingsRef);
        totalAppStars = snapshot.val() || 0;
      } catch (e) {
        totalAppStars = 0;
      }

      if (user && !user.isAnonymous) {
        try {
          const userRatingRef = ref(database, `appRatings/users/${user.uid}`);
          const userSnapshot = await get(userRatingRef);
          if (userSnapshot.exists()) {
            userHasRated = true;
            userPreviousRating = userSnapshot.val().stars || 0;
          } else {
            userHasRated = false;
            userPreviousRating = 0;
          }
        } catch (e) {
          userHasRated = false;
        }
      }
    }

    async function openRatingModal() {
      closeSidebar();
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user || user.isAnonymous) {
        showCustomAlert('Voc precisa ter uma conta verificada para avaliar o aplicativo.');
        return;
      }

      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const userRef = ref(database, `users/${user.uid}`);
        const snapshot = await get(userRef);
        const userData = snapshot.val();

        if (!userData || userData.status !== 'approved') {
          showCustomAlert('Sua conta precisa estar verificada para avaliar o aplicativo.');
          return;
        }
      } catch (e) {
        showCustomAlert('Erro ao verificar sua conta. Tente novamente.');
        return;
      }

      await loadAppRatingData();
      renderRatingOverlay();
      document.getElementById('ratingOverlay').classList.add('active');
    }

    function renderRatingOverlay() {
      const container = document.getElementById('ratingContent');
      const overlayContent = document.querySelector('.rating-overlay-content');

      const existingActions = overlayContent.querySelector('.rating-action-buttons');
      if (existingActions) existingActions.remove();

      const headerStars = document.getElementById('ratingHeaderStars');
      if (headerStars) {
        headerStars.textContent = ` ${totalAppStars}`;
      }

      if (userHasRated) {
        const starsDisplay = ''.repeat(userPreviousRating);
        container.innerHTML = `
          <div class="rating-already-rated">
            <span class="check-icon"></span>
            <div class="message">Voc j avaliou o aplicativo!</div>
            <div class="your-rating">Sua avaliao: ${starsDisplay}</div>
          </div>
        `;
      } else {
        selectedRating = 0;
        container.innerHTML = `
          <p class="rating-instruction-text">Clique nas estrelas para avaliar:</p>
          <div class="rating-stars-container">
            <span class="rating-star" data-star="1" onclick="selectStar(1)" onmouseover="hoverStar(1)" onmouseout="resetStarHover()"></span>
            <span class="rating-star" data-star="2" onclick="selectStar(2)" onmouseover="hoverStar(2)" onmouseout="resetStarHover()"></span>
            <span class="rating-star" data-star="3" onclick="selectStar(3)" onmouseover="hoverStar(3)" onmouseout="resetStarHover()"></span>
            <span class="rating-star" data-star="4" onclick="selectStar(4)" onmouseover="hoverStar(4)" onmouseout="resetStarHover()"></span>
            <span class="rating-star" data-star="5" onclick="selectStar(5)" onmouseover="hoverStar(5)" onmouseout="resetStarHover()"></span>
          </div>
          <div style="text-align: center; padding: 16px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-color);">
            <p style="color: var(--text-muted); font-size: 14px; margin: 0;">
               <strong>Dica:</strong> Avaliaes de 4 = +5 pontos | 5 = +10 pontos
            </p>
          </div>
        `;

        const actionsHtml = `
          <div class="rating-action-buttons">
            <button class="rating-action-btn primary" id="submitRatingBtn" onclick="submitRating()" disabled>Enviar Avaliao</button>
          </div>
        `;
        overlayContent.insertAdjacentHTML('beforeend', actionsHtml);
      }
    }

    function hoverStar(star) {
      const stars = document.querySelectorAll('.rating-star');
      stars.forEach((s, index) => {
        if (index < star) {
          s.classList.add('hover');
          s.textContent = '';
        } else {
          s.classList.remove('hover');
          if (!s.classList.contains('active')) {
            s.textContent = '';
          }
        }
      });
    }

    function resetStarHover() {
      const stars = document.querySelectorAll('.rating-star');
      stars.forEach((s, index) => {
        s.classList.remove('hover');
        if (index < selectedRating) {
          s.textContent = '';
        } else {
          s.textContent = '';
        }
      });
    }

    function selectStar(star) {
      selectedRating = star;
      const stars = document.querySelectorAll('.rating-star');
      stars.forEach((s, index) => {
        if (index < star) {
          s.classList.add('active');
          s.textContent = '';
        } else {
          s.classList.remove('active');
          s.textContent = '';
        }
      });

      const btn = document.getElementById('submitRatingBtn');
      if (btn) {
        btn.disabled = false;
        btn.style.opacity = '1';
      }
    }

    function submitRating() {
      if (selectedRating === 0) {
        showCustomAlert('Por favor, selecione uma avaliao de 1 a 5 estrelas.');
        return;
      }

      const starsText = selectedRating === 1 ? '1 estrela' : `${selectedRating} estrelas`;
      document.getElementById('confirmStarsText').textContent = starsText;

      const bonusInfo = document.getElementById('bonusPointsInfo');
      const bonusAmount = document.getElementById('bonusPointsAmount');

      if (selectedRating === 4) {
        bonusInfo.style.display = 'block';
        bonusAmount.textContent = '5';
      } else if (selectedRating === 5) {
        bonusInfo.style.display = 'block';
        bonusAmount.textContent = '10';
      } else {
        bonusInfo.style.display = 'none';
      }

      document.getElementById('ratingConfirmModal').classList.add('active');
    }

    function cancelRatingConfirm() {
      document.getElementById('ratingConfirmModal').classList.remove('active');
    }

    async function confirmRating() {
      const { ref, get, update } = window.firebaseModules;
      const database = window.firebaseDatabase;
      const auth = window.firebaseAuth;
      const user = auth.currentUser;

      if (!user) {
        showCustomAlert('Erro: usurio no encontrado.');
        return;
      }

      try {
        let bonusPoints = 0;
        if (selectedRating === 4) {
          bonusPoints = 5;
        } else if (selectedRating === 5) {
          bonusPoints = 10;
        }

        const totalRef = ref(database, 'appRatings/totalStars');
        const totalSnapshot = await get(totalRef);
        const currentTotal = totalSnapshot.val() || 0;
        const newTotal = currentTotal + selectedRating;

        const userRef = ref(database, `users/${user.uid}`);
        const userSnapshot = await get(userRef);
        const userData = userSnapshot.val() || {};
        const currentPoints = userData.points || 0;

        const updates = {};
        updates[`appRatings/totalStars`] = newTotal;
        updates[`appRatings/users/${user.uid}`] = {
          stars: selectedRating,
          timestamp: Date.now()
        };

        if (bonusPoints > 0) {
          updates[`users/${user.uid}/points`] = currentPoints + bonusPoints;
        }

        await update(ref(database), updates);

        totalAppStars = newTotal;
        userHasRated = true;
        userPreviousRating = selectedRating;

        if (bonusPoints > 0) {
          userPoints = currentPoints + bonusPoints;
          updatePointsDisplay();
        }

        document.getElementById('ratingConfirmModal').classList.remove('active');

        const starsDisplay = ''.repeat(selectedRating);
        let successMsg = `Obrigado pela sua avaliao! ${starsDisplay}`;
        if (bonusPoints > 0) {
          successMsg += `\n\n Voc ganhou ${bonusPoints} pontos de bnus!`;
        }
        showCustomAlert(successMsg);

        renderRatingOverlay();

      } catch (e) {
        console.error('Erro ao enviar avaliao:', e);
        showCustomAlert('Erro ao enviar avaliao. Tente novamente.');
      }
    }

    function closeRatingOverlay() {
      document.getElementById('ratingOverlay').classList.remove('active');
      document.getElementById('ratingConfirmModal').classList.remove('active');
      selectedRating = 0;
    }

    function renderNotifications() {
      const notificationsList = document.getElementById('notificationsList');
      const notificationsFooter = document.getElementById('notificationsFooter');

      if (userNotifications.length === 0) {
        notificationsList.innerHTML = `
          <div class="overlay-empty-state">
            <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
            <h3>Nenhuma notificao</h3>
            <p>Voc no tem notificaes no momento. Quando houver novidades, elas aparecero aqui.</p>
          </div>
        `;
        notificationsFooter.style.display = 'none';
        return;
      }

      const hasUnread = userNotifications.some(n => !n.isRead);
      notificationsFooter.style.display = hasUnread ? 'block' : 'none';

      notificationsList.innerHTML = userNotifications.map(notif => {
        const timeAgo = formatTimeAgo(notif.createdAt);
        const isUnread = !notif.isRead;
        const itemClass = isUnread ? 'notification-item unread' : 'notification-item read';
        const unreadIndicator = isUnread ? '<span class="notification-unread-indicator"></span>' : '';

        const personalBadge = notif.isPersonal
          ? '<span style="background: #9c27b0; color: white; font-size: 11px; padding: 3px 8px; border-radius: 6px; margin-left: 8px;">Para voc</span>'
          : '';

        const markReadBtn = isUnread
          ? `<button class="notification-action-btn mark-read" onclick="markNotificationAsRead('${notif.id}')">
                Marcar como lida
             </button>`
          : '';

        return `
          <div class="${itemClass}">
            <div class="notification-header">
              <div>
                <div class="notification-title">${unreadIndicator}${notif.title}${personalBadge}</div>
                <div class="notification-time">${timeAgo}</div>
              </div>
            </div>
            <div class="notification-message">${notif.message}</div>
            <div class="notification-actions">
              ${markReadBtn}
              <button class="notification-action-btn delete" onclick="dismissNotification('${notif.id}')">
                 Apagar
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function markNotificationAsRead(notificationId) {
      try {
        const { ref, set } = window.firebaseModules;
        const database = window.firebaseDatabase;

        await set(ref(database, `readNotifications/${currentUser.uid}/${notificationId}`), true);

        readNotifications[notificationId] = true;
        const notifIndex = userNotifications.findIndex(n => n.id === notificationId);
        if (notifIndex !== -1) {
          userNotifications[notifIndex].isRead = true;
        }

        updateNotificationBadge();
        renderNotifications();
      } catch (error) {
        showCustomAlert('Erro ao marcar notificao: ' + error.message);
      }
    }

    async function markAllNotificationsAsRead() {
      try {
        const { ref, set } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const unreadNotifications = userNotifications.filter(n => !n.isRead);

        for (const notif of unreadNotifications) {
          await set(ref(database, `readNotifications/${currentUser.uid}/${notif.id}`), true);
          readNotifications[notif.id] = true;
          notif.isRead = true;
        }

        updateNotificationBadge();
        renderNotifications();
      } catch (error) {
        showCustomAlert('Erro ao marcar notificaes: ' + error.message);
      }
    }

    async function dismissNotification(notificationId) {
      try {
        const { ref, set } = window.firebaseModules;
        const database = window.firebaseDatabase;

        await set(ref(database, `dismissedNotifications/${currentUser.uid}/${notificationId}`), true);

        dismissedNotifications[notificationId] = true;
        userNotifications = userNotifications.filter(n => n.id !== notificationId);

        updateNotificationBadge();
        renderNotifications();
      } catch (error) {
        showCustomAlert('Erro ao apagar notificao: ' + error.message);
      }
    }

    let userFavorites = {};
    let userLikes = {};
    let currentGameLikes = 0;
    let dailyRewardClaimed = false;

    async function loadUserFavorites() {
      if (!currentUser || currentUser.isAnonymous) return;

      const { doc, getDoc } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        const favDoc = await getDoc(doc(firestore, 'favorites', currentUser.uid));
        if (favDoc.exists()) {
          userFavorites = favDoc.data().games || {};
        } else {
          userFavorites = {};
        }
      } catch (e) {
        console.error('Erro ao carregar favoritos:', e);
        userFavorites = {};
      }
    }

    async function loadUserLikes() {
      if (!currentUser || currentUser.isAnonymous) return;

      const { doc, getDoc } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        const likesDoc = await getDoc(doc(firestore, 'userLikes', currentUser.uid));
        if (likesDoc.exists()) {
          userLikes = likesDoc.data().games || {};
        } else {
          userLikes = {};
        }
      } catch (e) {
        console.error('Erro ao carregar likes:', e);
        userLikes = {};
      }
    }

    async function toggleFavorite() {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login para adicionar favoritos.');
        return;
      }

      if (!currentGameData) return;

      const gameId = currentGameData.id;
      const { doc, setDoc, getDoc } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        const favRef = doc(firestore, 'favorites', currentUser.uid);
        const isFavorite = userFavorites[gameId];

        if (isFavorite) {
          delete userFavorites[gameId];
        } else {
          userFavorites[gameId] = {
            addedAt: Date.now(),
            titulo: currentGameData.titulo,
            poster: currentGameData.poster,
            type: currentGameData.type
          };
        }

        await setDoc(favRef, { games: userFavorites }, { merge: true });
        updateFavoriteButton();

        if (isFavorite) {
          showCustomAlert('Removido dos favoritos!');
        } else {
          showCustomAlert('Adicionado aos favoritos!');
        }
      } catch (e) {
        console.error('Erro ao atualizar favorito:', e);
        showCustomAlert('Erro ao atualizar favorito.');
      }
    }

    function updateFavoriteButton() {
      if (!currentGameData) return;

      const btn = document.getElementById('favoriteBtn');
      const icon = document.getElementById('favoriteIcon');
      if (!btn || !icon) return;

      const isFavorite = userFavorites[currentGameData.id];

      if (isFavorite) {
        icon.style.fill = '#e91e63';
        btn.classList.add('active');
      } else {
        icon.style.fill = '#9e9e9e';
        btn.classList.remove('active');
      }
    }

    async function toggleLike() {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login para curtir.');
        return;
      }

      if (userStatus === 'pending') {
        showCustomAlert('Sua conta precisa estar verificada para curtir.');
        return;
      }

      if (!currentGameData) return;

      const gameId = currentGameData.id;
      const { doc, setDoc, getDoc, updateDoc } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        const userLikesRef = doc(firestore, 'userLikes', currentUser.uid);
        const gameLikesRef = doc(firestore, 'gameLikes', gameId);
        const isLiked = userLikes[gameId];

        let currentLikes = 0;
        try {
          const gameLikesDoc = await getDoc(gameLikesRef);
          if (gameLikesDoc.exists()) {
            currentLikes = gameLikesDoc.data().count || 0;
          }
        } catch (e) {}

        if (isLiked) {
          delete userLikes[gameId];
          currentLikes = Math.max(0, currentLikes - 1);
        } else {
          userLikes[gameId] = Date.now();
          currentLikes += 1;
        }

        await setDoc(userLikesRef, { games: userLikes }, { merge: true });

        await setDoc(gameLikesRef, { count: currentLikes }, { merge: true });

        currentGameLikes = currentLikes;
        updateLikeButton();
      } catch (e) {
        console.error('Erro ao atualizar like:', e);
        showCustomAlert('Erro ao curtir.');
      }
    }

    async function loadGameLikes(gameId) {
      const { doc, getDoc } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        const gameLikesDoc = await getDoc(doc(firestore, 'gameLikes', gameId));
        if (gameLikesDoc.exists()) {
          currentGameLikes = gameLikesDoc.data().count || 0;
        } else {
          currentGameLikes = 0;
        }
      } catch (e) {
        currentGameLikes = 0;
      }
    }

    function updateLikeButton() {
      if (!currentGameData) return;

      const btn = document.getElementById('likeBtn');
      const icon = document.getElementById('likeIcon');
      const countMeta = document.getElementById('likeCountMeta');
      const footerBtn = document.getElementById('footerLikeBtn');
      const footerIcon = document.getElementById('footerLikeIcon');

      const isLiked = userLikes[currentGameData.id];

      if (countMeta) {
        countMeta.textContent = currentGameLikes;
      }

      if (btn && icon) {
        if (isLiked) {
          icon.style.fill = '#e91e63';
          btn.classList.add('liked');
        } else {
          icon.style.fill = 'currentColor';
          btn.classList.remove('liked');
        }
      }

      if (footerBtn && footerIcon) {
        if (isLiked) {
          footerBtn.classList.add('like-active');
          footerIcon.style.fill = '#e91e63';
        } else {
          footerBtn.classList.remove('like-active');
          footerIcon.style.fill = '';
        }
      }
    }

    function updateFooterActive(section) {
      const infoBtn = document.getElementById('footerInfoBtn');
      const commentsBtn = document.getElementById('footerCommentsBtn');
      const downloadsBtn = document.getElementById('footerDownloadsBtn');

      infoBtn.classList.remove('active');
      commentsBtn.classList.remove('active');
      downloadsBtn.classList.remove('active');

      if (section === 'info') {
        infoBtn.classList.add('active');
      } else if (section === 'comments') {
        commentsBtn.classList.add('active');
      } else if (section === 'downloads') {
        downloadsBtn.classList.add('active');
      }
    }

    function openFavoritesModal() {
      openFavoritesOverlay();
    }

    function closeFavoritesModal() {
      closeFavoritesOverlay();
    }

    function openFavoritesOverlay() {
      closeSidebar();
      document.getElementById('favoritesOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      renderFavoritesList();
    }

    function closeFavoritesOverlay() {
      document.getElementById('favoritesOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function renderFavoritesList() {
      const container = document.getElementById('favoritesList');
      const favoritesArray = Object.entries(userFavorites);

      if (favoritesArray.length === 0) {
        container.innerHTML = `
          <div class="overlay-empty-state">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            <h3>Nenhum favorito</h3>
            <p>Voc ainda no tem favoritos. Toque no corao nos contedos para adicionar!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = favoritesArray.map(([gameId, fav]) => {
        const typeLabels = {
          aplicativos: 'Aplicativo',
          jogos: 'Jogo',
          tutoriais: 'Tutorial',
          pc: 'PC',
          outros: 'Outro'
        };
        return `
          <div class="favorites-item" onclick="openGameFromFavorites('${gameId}')">
            <img src="${fav.poster}" alt="${fav.titulo}">
            <div class="favorites-item-info">
              <div class="favorites-item-title">${fav.titulo}</div>
              <div class="favorites-item-meta">${typeLabels[fav.type] || fav.type}</div>
            </div>
            <button class="favorites-item-remove" onclick="event.stopPropagation(); removeFavorite('${gameId}')" title="Remover"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
  <path fill="#808080" d="M9 3h6v2h5v2H4V5h5V3zm-3 6h12l-1.2 10.2c-.1.9-.8 1.8-1.8 1.8H8c-1 0-1.7-.9-1.8-1.8L6 9zm3 2v8h2v-8H9zm4 0v8h2v-8h-2z"/>
</svg></button>
          </div>
        `;
      }).join('');
    }

    function openGameFromFavorites(gameId) {
      closeFavoritesModal();
      if (allGames[gameId]) {
        openGameDetail(gameId);
      } else {
        showCustomAlert('Este contedo no est mais disponvel.');
        removeFavorite(gameId);
      }
    }

    async function removeFavorite(gameId) {
      const { doc, setDoc } = window.firebaseModules;
      const firestore = window.firebaseFirestore;

      try {
        delete userFavorites[gameId];
        const favRef = doc(firestore, 'favorites', currentUser.uid);
        await setDoc(favRef, { games: userFavorites }, { merge: true });
        renderFavoritesList();
        updateFavoriteButton();
      } catch (e) {
        console.error('Erro ao remover favorito:', e);
      }
    }

    let allUsersForTransfer = [];

    function toggleTransferType() {
      const transferType = document.querySelector('input[name="transferType"]:checked').value;
      const emailGroup = document.getElementById('transferEmailGroup');
      const allInfoGroup = document.getElementById('transferAllInfo');
      const perUserLabel = document.getElementById('perUserLabel');
      const submitBtn = document.getElementById('transferSubmitBtn');

      if (transferType === 'individual') {
        emailGroup.style.display = 'flex';
        allInfoGroup.style.display = 'none';
        perUserLabel.style.display = 'none';
        submitBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/></svg> Transferir';
        document.getElementById('transferEmail').required = true;
      } else {
        emailGroup.style.display = 'none';
        allInfoGroup.style.display = 'flex';
        perUserLabel.style.display = 'inline';
        submitBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg> Transferir para Todos';
        document.getElementById('transferEmail').required = false;
        updateTransferUsersCount();
      }
    }

    async function updateTransferUsersCount() {
      try {
        const { ref, get } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const usersRef = ref(database, 'users');
        const usersSnapshot = await get(usersRef);

        if (usersSnapshot.exists()) {
          allUsersForTransfer = [];
          usersSnapshot.forEach((child) => {
            const userData = child.val();
            if (child.key !== currentUser.uid) {
              allUsersForTransfer.push({
                uid: child.key,
                email: userData.email || '',
                points: userData.points || 0,
                name: userData.name || userData.email?.split('@')[0] || 'Usurio'
              });
            }
          });
          document.getElementById('totalUsersCount').textContent = `${allUsersForTransfer.length} usurios`;
        }
      } catch (e) {
        console.error('Erro ao contar usurios:', e);
      }
    }

    function openTransferModal() {
      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa estar logado para transferir pontos.');
        return;
      }

      if (!isPublisher) {
        showCustomAlert('Apenas administradores podem transferir pontos.');
        return;
      }

      closeSidebar();

      document.getElementById('transferCurrentPoints').textContent = userPoints;

      document.getElementById('transferEmail').value = '';
      document.getElementById('transferAmount').value = '';

      selectTransferType('individual');

      document.getElementById('transferOverlay').classList.add('active');
    }

    function closeTransferModal() {
      document.getElementById('transferOverlay').classList.remove('active');
      document.getElementById('transferForm').reset();
    }

    function selectTransferType(type) {
      const individualOption = document.getElementById('transferTypeIndividual');
      const allOption = document.getElementById('transferTypeAll');
      const individualRadio = document.querySelector('input[name="transferType"][value="individual"]');
      const allRadio = document.querySelector('input[name="transferType"][value="all"]');

      if (type === 'individual') {
        individualOption.classList.add('active');
        allOption.classList.remove('active');
        individualRadio.checked = true;
      } else {
        individualOption.classList.remove('active');
        allOption.classList.add('active');
        allRadio.checked = true;
      }

      toggleTransferType();
    }

    async function handleTransfer(e) {
      e.preventDefault();

      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa estar logado para transferir pontos.');
        return;
      }

      if (!isPublisher) {
        showCustomAlert('Apenas administradores podem transferir pontos.');
        return;
      }

      const transferType = document.querySelector('input[name="transferType"]:checked').value;
      const amount = parseInt(document.getElementById('transferAmount').value);

      if (!amount || amount <= 0) {
        showCustomAlert('A quantidade de pontos deve ser maior que zero.');
        return;
      }

      if (transferType === 'all') {
        await handleTransferToAll(amount);
      } else {
        await handleTransferToIndividual(amount);
      }
    }

    async function handleTransferToIndividual(amount) {
      const recipientEmail = document.getElementById('transferEmail').value.trim().toLowerCase();

      if (!recipientEmail) {
        showCustomAlert('Por favor, preencha o email do destinatrio.');
        return;
      }

      if (recipientEmail === currentUser.email.toLowerCase()) {
        showCustomAlert('Voc no pode transferir pontos para si mesmo.');
        return;
      }

      try {
        const { ref, get, update, push, set } = window.firebaseModules;
        const database = window.firebaseDatabase;

        const usersRef = ref(database, 'users');
        const usersSnapshot = await get(usersRef);

        if (!usersSnapshot.exists()) {
          showCustomAlert('Usurio destinatrio no encontrado.');
          return;
        }

        let recipientUid = null;
        let recipientData = null;

        usersSnapshot.forEach((child) => {
          const userData = child.val();
          if (userData.email && userData.email.toLowerCase() === recipientEmail) {
            recipientUid = child.key;
            recipientData = userData;
          }
        });

        if (!recipientUid) {
          showCustomAlert('Usurio com esse email no encontrado no sistema.');
          return;
        }

        const recipientCurrentPoints = recipientData.points || 0;

        const recipientNewPoints = recipientCurrentPoints + amount;

        const serverTime = await getServerTimestamp();

        const recipientPointsRef = ref(database, `users/${recipientUid}/points`);
        await set(recipientPointsRef, recipientNewPoints);

        const senderName = currentUser.displayName || currentUser.email.split('@')[0];
        const notificationData = {
          title: ' Voc recebeu pontos!',
          message: `${senderName} transferiu ${amount} pontos para voc. Novo saldo: ${recipientNewPoints} pontos.`,
          targetType: 'individual',
          targetUserId: recipientUid,
          targetUserName: recipientEmail.split('@')[0],
          createdAt: serverTime,
          createdBy: currentUser.uid,
          type: 'transfer'
        };

        const notificationsRef = ref(database, 'notifications');
        const newNotificationRef = push(notificationsRef);
        await set(newNotificationRef, notificationData);

        updateUserInfoDisplay();

        showCustomAlert(`Transferncia realizada com sucesso!\n${amount} pontos enviados para ${recipientEmail}.\nNovo saldo do destinatrio: ${recipientNewPoints} pontos.`);
        closeTransferModal();

      } catch (error) {
        console.error('[SEGURANA] Erro na transferncia:', error);
        showCustomAlert('Erro ao realizar transferncia: ' + error.message);
      }
    }

    async function handleTransferToAll(amount) {
      showConfirmModal(
        ` Confirmar Transferncia em Massa`,
        `Voc est prestes a transferir <strong>${amount} pontos</strong> para <strong>${allUsersForTransfer.length} usurios</strong>.\n\nTotal de pontos a serem distribudos: <strong>${amount * allUsersForTransfer.length}</strong>\n\nDeseja continuar?`,
        async () => {
          await executeMassTransfer(amount);
        }
      );
    }

    async function executeMassTransfer(amount) {
      const submitBtn = document.getElementById('transferSubmitBtn');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Transferindo...';

      try {
        const { ref, get, set, push } = window.firebaseModules;
        const database = window.firebaseDatabase;

        await updateTransferUsersCount();

        if (allUsersForTransfer.length === 0) {
          showCustomAlert('Nenhum usurio encontrado para transferncia.');
          return;
        }

        const serverTime = await getServerTimestamp();
        const senderName = currentUser.displayName || currentUser.email.split('@')[0];

        let successCount = 0;
        let errorCount = 0;

        for (const user of allUsersForTransfer) {
          try {
            const newPoints = user.points + amount;
            const userPointsRef = ref(database, `users/${user.uid}/points`);
            await set(userPointsRef, newPoints);

            const notificationData = {
              title: ' Voc recebeu pontos!',
              message: `${senderName} distribuiu ${amount} pontos para todos os usurios. Novo saldo: ${newPoints} pontos.`,
              targetType: 'individual',
              targetUserId: user.uid,
              targetUserName: user.name,
              createdAt: serverTime,
              createdBy: currentUser.uid,
              type: 'transfer'
            };

            const notificationsRef = ref(database, 'notifications');
            const newNotificationRef = push(notificationsRef);
            await set(newNotificationRef, notificationData);

            successCount++;

            submitBtn.textContent = `Transferindo... (${successCount}/${allUsersForTransfer.length})`;
          } catch (err) {
            console.error(`Erro ao transferir para ${user.email}:`, err);
            errorCount++;
          }
        }

        updateUserInfoDisplay();

        if (errorCount === 0) {
          showCustomAlert(`Transferncia em massa concluda com sucesso!\n\n${amount} pontos enviados para ${successCount} usurios.\nTotal distribudo: ${amount * successCount} pontos.`);
        } else {
          showCustomAlert(`Transferncia parcialmente concluda.\n\nSucesso: ${successCount} usurios\nErros: ${errorCount} usurios`);
        }

        closeTransferModal();

      } catch (error) {
        console.error('[SEGURANA] Erro na transferncia em massa:', error);
        showCustomAlert('Erro ao realizar transferncia: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    }

    const DAILY_REWARD_COOLDOWN = 24 * 60 * 60 * 1000; // 24 hours in milliseconds
    let nextRewardTime = 0; // When the next reward becomes available

    async function checkDailyReward() {
      if (!currentUser || currentUser.isAnonymous) return;

      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const rewardRef = ref(database, `dailyRewardClaims/${currentUser.uid}`);
        const snapshot = await get(rewardRef);

        if (snapshot.exists()) {
          const data = snapshot.val();
          const lastClaimedAt = data.lastClaimedAt || 0;

          const serverTime = await getServerTimestamp();
          const timeSinceClaim = serverTime - lastClaimedAt;

          if (timeSinceClaim < DAILY_REWARD_COOLDOWN) {
            dailyRewardClaimed = true;
            nextRewardTime = lastClaimedAt + DAILY_REWARD_COOLDOWN;
          } else {
            dailyRewardClaimed = false;
            nextRewardTime = 0;
          }
        } else {
          dailyRewardClaimed = false;
          nextRewardTime = 0;
        }

        updateDailyRewardButton();
        startRewardCountdown();
      } catch (e) {
        console.error('Erro ao verificar recompensa diria:', e);
      }
    }

    async function getServerTimestamp() {
      const { ref, get } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const offsetRef = ref(database, '.info/serverTimeOffset');
        const snapshot = await get(offsetRef);
        const offset = snapshot.val() || 0;
        return Date.now() + offset;
      } catch (e) {
        console.error('Erro ao obter timestamp do servidor:', e);
        return Date.now(); // Fallback to local time
      }
    }

    function formatTimeRemaining(ms) {
      if (ms <= 0) return '';
      const hours = Math.floor(ms / 3600000);
      const minutes = Math.floor((ms % 3600000) / 60000);
      const seconds = Math.floor((ms % 60000) / 1000);
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    let rewardCountdownInterval = null;

    function startRewardCountdown() {
      if (rewardCountdownInterval) {
        clearInterval(rewardCountdownInterval);
        rewardCountdownInterval = null;
      }

      if (!dailyRewardClaimed || nextRewardTime <= 0) return;

      rewardCountdownInterval = setInterval(async () => {
        const serverTime = await getServerTimestamp();
        const remaining = nextRewardTime - serverTime;

        if (remaining <= 0) {
          clearInterval(rewardCountdownInterval);
          rewardCountdownInterval = null;
          dailyRewardClaimed = false;
          nextRewardTime = 0;
          updateDailyRewardButton();
        } else {
          updateDailyRewardButton(remaining);
        }
      }, 1000);
    }

    function updateDailyRewardButton(remainingMs = null) {
      const btn = document.getElementById('dailyRewardBtn');
      const text = document.getElementById('dailyRewardText');
      if (!btn || !text) return;

      if (dailyRewardClaimed) {
        btn.classList.add('claimed');
        if (remainingMs && remainingMs > 0) {
          text.textContent = `Volte em ${formatTimeRemaining(remainingMs)}`;
        } else {
          text.textContent = 'J resgatado ';
        }
      } else {
        btn.classList.remove('claimed');
        text.textContent = 'Recompensa Diria (+20)';
      }
    }

    async function claimDailyReward() {
      closeSidebar();

      if (!currentUser || currentUser.isAnonymous) {
        showCustomAlert('Voc precisa fazer login para resgatar a recompensa diria.');
        return;
      }

      if (userStatus === 'pending') {
        showCustomAlert('Sua conta precisa estar verificada para resgatar recompensas.');
        return;
      }

      if (dailyRewardClaimed) {
        const serverTime = await getServerTimestamp();
        const remaining = nextRewardTime - serverTime;
        if (remaining > 0) {
          showCustomAlert(`Voc j resgatou sua recompensa!\n\nVolte em ${formatTimeRemaining(remaining)} `);
        } else {
          showCustomAlert('Voc j resgatou sua recompensa! Volte mais tarde. ');
        }
        return;
      }

      const { ref, get, update } = window.firebaseModules;
      const database = window.firebaseDatabase;

      try {
        const serverTime = await getServerTimestamp();
        const claimRef = ref(database, `dailyRewardClaims/${currentUser.uid}`);

        const currentSnapshot = await get(claimRef);
        if (currentSnapshot.exists()) {
          const data = currentSnapshot.val();
          const lastClaimedAt = data.lastClaimedAt || 0;
          const timeSinceClaim = serverTime - lastClaimedAt;

          if (timeSinceClaim < DAILY_REWARD_COOLDOWN) {
            dailyRewardClaimed = true;
            nextRewardTime = lastClaimedAt + DAILY_REWARD_COOLDOWN;
            updateDailyRewardButton();
            startRewardCountdown();
            showCustomAlert(`Voc precisa esperar 24 horas entre resgates!\n\nVolte em ${formatTimeRemaining(nextRewardTime - serverTime)} `);
            return;
          }
        }

        const userRef = ref(database, `users/${currentUser.uid}`);
        const userSnapshot = await get(userRef);
        const userData = userSnapshot.val() || {};
        const currentPoints = userData.points || 0;
        const newPointsTotal = currentPoints + 20;

        const updates = {};
        updates[`dailyRewardClaims/${currentUser.uid}`] = {
          lastClaimedAt: serverTime,
          pointsAwarded: 20,
          newPointsTotal: newPointsTotal
        };
        updates[`users/${currentUser.uid}/points`] = newPointsTotal;
        updates[`users/${currentUser.uid}/dailyReward`] = {
          lastClaimedAt: serverTime
        };

        try {
          await update(ref(database), updates);
        } catch (claimError) {
          console.log('[SEGURANA] Recompensa bloqueada pelo servidor:', claimError);
          dailyRewardClaimed = true;
          await checkDailyReward();
          showCustomAlert('Voc precisa esperar 24 horas entre resgates! ');
          return;
        }

        _syncPointsDisplay(newPointsTotal);
        dailyRewardClaimed = true;
        nextRewardTime = serverTime + DAILY_REWARD_COOLDOWN;

        updateDailyRewardButton();
        startRewardCountdown();

        showCustomAlert(' Recompensa diria resgatada!\n\n+20 pontos adicionados  sua conta!');
      } catch (e) {
        console.error('[SEGURANA] Erro ao resgatar recompensa:', e);
        showCustomAlert('Erro ao resgatar recompensa. Tente novamente.');
      }
    }

    function showCustomConfirm(message, onConfirm) {
      const modal = document.createElement('div');
      modal.className = 'custom-modal active';
      modal.innerHTML = `
        <div class="custom-modal-content">
          <p style="margin: 0 0 16px 0;">${message}</p>
          <div class="custom-modal-buttons">
            <button class="custom-modal-btn secondary" onclick="this.closest('.custom-modal').remove()">Cancelar</button>
            <button class="custom-modal-btn primary" id="confirmBtn">Confirmar</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      modal.querySelector('#confirmBtn').addEventListener('click', () => {
        modal.remove();
        onConfirm();
      });
    }

    document.addEventListener('click', (e) => {
      if (e.target.id === 'overlay') {
        closeOverlay();
      }
    });

    const sidebar = document.getElementById('sidebar');
    let startX = 0;
    let endX = 0;

    sidebar.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    sidebar.addEventListener('touchmove', (e) => {
      endX = e.touches[0].clientX;
    });

    sidebar.addEventListener('touchend', () => {
      const diffX = endX - startX;
      if (diffX < -50) {
        sidebar.classList.remove('open');
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const authOverlay = document.getElementById('authOverlay');
        const historyOverlay = document.getElementById('historyOverlay');
        const reportOverlay = document.getElementById('reportProblemOverlay');
        const notificationsOverlay = document.getElementById('notificationsOverlay');
        const favoritesOverlay = document.getElementById('favoritesOverlay');
        const commentsOverlay = document.getElementById('commentsOverlay');
        const downloadsOverlay = document.getElementById('downloadsOverlay');
        const redeemOverlay = document.getElementById('redeemOverlay');
        const publishOverlay = document.getElementById('publishOverlay');
        const manageOverlay = document.getElementById('manageOverlay');

        if (authOverlay && authOverlay.classList.contains('active')) {
          const welcomeScreen = document.getElementById('authWelcomeScreen');
          if (!welcomeScreen.classList.contains('active')) {
            authGoBack();
          } else if (currentUser) {
            closeAuthOverlay();
          }
          return;
        }

        if (publishOverlay && publishOverlay.classList.contains('active')) {
          closePublishModal();
        } else if (manageOverlay && manageOverlay.classList.contains('active')) {
          closeManageModal();
        } else if (redeemOverlay && redeemOverlay.classList.contains('active')) {
          closeRedeemCodeModal();
        } else if (historyOverlay && historyOverlay.classList.contains('active')) {
          closeHistoryOverlay();
        } else if (reportOverlay && reportOverlay.classList.contains('active')) {
          closeReportProblemOverlay();
        } else if (notificationsOverlay && notificationsOverlay.classList.contains('active')) {
          closeNotificationsOverlay();
        } else if (favoritesOverlay && favoritesOverlay.classList.contains('active')) {
          closeFavoritesOverlay();
        } else if (document.getElementById('generateCodeOverlay') && document.getElementById('generateCodeOverlay').classList.contains('active')) {
          closeGenerateCodeModal();
        } else if (commentsOverlay && commentsOverlay.classList.contains('active')) {
          closeCommentsOverlay();
        } else if (downloadsOverlay && downloadsOverlay.classList.contains('active')) {
          closeDownloadsOverlay();
        }
      }
    });
  </script>
</body>
</html>


